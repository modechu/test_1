<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=big5">
   <title>===:::::::::: SCM 樣本輔助系統 [ 製造令 資料 ] ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">

</head>
{literal}
<script language="javascript" src="./js/open_detial.js"></script>

<script language="javascript" src="./js/jquery.min.js"></script>
<script language="javascript">
function schd_qtychk()
{
	//alert("myalert");
	alert(document.getElementByName("PHP_ord_total"));
}
function mask(){
	$('body').mask('Waiting...');
}
$(document).ready(function () {
                 
                 var speed = 500;
				 var clickevent=0;
				 $("#btnInput").show();
				 //$("#btnSave").hide();
                 $("#btnCancle").hide();
				 
                 $("#btnInput").click(function (event) {
                     
                     //event.stopPropagation();
                     
                     var offset = $(event.target).offset();
                     
                     var inID = $(this).get(0).getAttribute("inputid");
					 
					 $("#btnInput").hide();
					 //$("#btnSave").show();
                     $("#btnCancle").show();
					 
                     $("#divPop")[0].style.width = ($("#" + inID).width() + $(this).width() + 200) + "px";
                     
                    // $(document).click(function (event) { $("#divPop").hide(speed) });
                    
                     $("#divPop").css({ top: offset.top + $(event.target).height() + 200 + "px", left: offset.right });
                     
                     $("#divPop").toggle(speed);
                 });
				 
				  $("#btnSubmit").click(function (event) {
                     
					 

					 //var new_order_qty = Number($("#PHP_ord_total_qty").val()) - Number($("#partial_qty").val()) + Number($("#new_partial_qty").val());
					 //$("#ord_schd_total")[0].value
					 if(Number($("#PHP_ord_total_qty").val()) < Number($("#ord_schd_total").val()))
					 {
						//訂單只能大於排產，不能小於排產
						$("#ord_qty_allow")[0].value = 'no';
						alert("訂單總量不可低於此訂單的排產總量\r\n無法修改!!");
						
					 }
					 else
					 {
						//執行修改
						$("#ord_qty_allow")[0].value = 'yes';
					 }
                     
                 });
				 $("#btnCancle").click(function (event) {
                     
					 
                     //event.stopPropagation();
                     
                     var offset = $(event.target).offset();
                     
                     var inID = $(this).get(0).getAttribute("cancel_id");
					 alert(inID);
					 //for(i=0;i<txtQty.length;i++)
					 //{
						//&A=$(".txtQty")[i].value
						//$(".txtQty")[i].value="";
						//alert($(".txtQty")[i].value);
					 //}
					 $("#btnInput").show();
					 //$("#btnSave").hide();
					 $("#btnCancle").hide();
                     
                     $("#divPop")[0].style.width = ($("#" + inID).width() + $(this).width() + 10) + "px";
                                      
                     $("#divPop").css({ top: offset.top + $(event.target).height() + 10 + "px", left: offset.right });
                     
                     $("#divPop").toggle(speed);
                 });
             });
</script>
{/literal}
<body>
<br>
<table cellspacing=1 cellpadding=4 cols=2 width=700 bgcolor=#333333>
	<tr><td class="des" align=center height=28 width=320>[ <b><span class=ylw10>SUBMIT</span> Order W/I</b> : <b>{$wi.wi_num}</b>]</td>
	<td class="ylw10" align=center height=28 width=100>{if $wi.status == 1}<b>[ {literal}SUBMIT{/literal} ]{else}[{literal} UN SUBMIT{/literal} ]{/if}</span></b></td>
	<td class="des" align=center height=28 width=100>Version :<span class=ylw10><b>{$wi.revise}</b></span></td>
	</tr>
</table>
{if $msg_YES}
     <table border=1 cellpadding=4 cellspacing=0 cols=1 width=700>
      <tr bgcolor=#ffffff> 
        <td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
        <td class=bgdy>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</td>
      </tr>
     </table>
{/if}
<table border=0 cellspacing=0 cellpadding=1 width=700 bgcolor=#FFFFFF>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
    <td class=snvy align=right nowrap>Customer :</td>
    <td class=bgdy align=left><b>&nbsp;{$smpl.cust_iname}</b></td>
    <td class=snvy align=right nowrap>Department :</td>
    <td class=bgdy align=left><b>&nbsp;{$wi.dept}</b></td>
    <td class=snvy align=right nowrap><b>ETD :</b></td>
    <td class=bgdy align=left><b>&nbsp;{$wi.etd}</b></td>
    <td nowrap width=10 align=center class=back>
    {if $wi.status >= 1}
    <a href="index2.php?PHP_action=wi_print&PHP_id={$wi.wi_num}" target="_blank">
			<img src="./images/print9.gif" border=0 alt="PDF: SAVE/PRINT"></a>
			{else}&nbsp;{/if}
	</td>
  </tr>
  </tr>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
</table>
<table border cellspacing=0 cellpadding=3 width=700 bgcolor=#ffffff align=center>
  <tr bgcolor="#003333" height=28> 
	<td nowrap width=100 align=center class=back><b>Picture</b></td>
	<td nowrap width=100 align=center class=back><b>Order #</b></td>
	<td nowrap width=100 align=center class=back><b>style</b></td>
	<td nowrap width=150 align=center class=back><b>SIZE RANGE</b></td>
	<td nowrap width=200 align=center class=back><b>Q'ty / Unit</b></td>
  </tr>
  <tr bgcolor=#DDDDDD height=28>
	<td class=g10 align=center rowspan=2>&nbsp;
		<input type="image" src="{$wi.pic_url}" name="pic" width=100 border="0" onclick='window.open2("{$wi.pic_url}","","resizable=yes,height=480,width=640")'>
	</td>
	<td class=grn9 align=center>
	  <a href="javascript:Show_ord('{$wi.smpl_id}','{$wi.style_code}')" value='ord_out' style='cursor:pointer'>
	<b>&nbsp;{$smpl.order_num}</b></a></td>
    <td class=grn9 align=center><b>&nbsp;{$smpl.style}</b></td>
    <td class=grn9 align=center><b>&nbsp;{$smpl.size_scale}</b></td>
    <td class=grn9 align=center><b><span class=bgdy9><b>{$total}</b></span>&nbsp;{if $wi.unit}{$wi.unit}{else}<span class=bgdy9><UnInput></span>{/if} (Order : {$smpl.qty}{$wi.unit})</b>
	
	
	<br/>
    <!-- <input name="txtKey" type="text" maxlength="30" size="30" id="txtKey" style="Padding:2px;" /> -->
	{if $total <> $smpl.qty}
	<button id="btnInput" inputid="txtKey" >Revise</button>
	<button id="btnCancle" cancel_id="txtQty" >Cancle</button>
	{/if}
	<div id="divPop"  style="background-color: #DDFFDD; display:none">
			<!--改成動態存取次數,改作成Form-->
			<form METHOD="get" name="update_qty" action="wi.php">
			<table border=1 cellpadding=3 cellspacing=1>
			<tr>
			<td align=center>交期</td>
			<td align=center>代號</td>
			<td align=center>數量</td>
			</tr>
			{section name=SEC_qty loop=$partial_qty} 
			<tr>
			<td align=center>{$partial_qty[SEC_qty].p_etd}</td>
			<td align=center>{$partial_qty[SEC_qty].mks}</td>
			<td align=center><input name="qty" id="new_partial_qty" align="middle" type="text" class="txtQty"   style='width:80px' id="{$partial_qty[SEC_qty].mks}" value="{$total}" readonly='readonly' /></td>
			<input type="hidden" id="partial_qty" name="PHP_this_partial_qty" value="{$total}">
			</tr>
			{/section}
			<input type="hidden" name="PHP_partial_id" value="{$wi.partial_id}">
			<input type="hidden" name="PHP_ord_id" value="{$smpl.id}">
			
			<input type="hidden" name="PHP_action" value="Revise_partial_qty">
			<input type="hidden" name="PHP_ord_num" value="{$smpl.order_num}">
			<input type="hidden" name="PHP_ord_total_qty" value="{$order_total_qty}">
			<input type="hidden" name="PHP_ord_ie" value="{$smpl.ie1}">
			<input type="hidden" id="this_partial_total" name="PHP_this_partial_total" value="{$total}">
			<input type="hidden" id="ord_schd_total" name="PHP_ord_schd_total" value="{$order_schedule_qty}">
			<input type="hidden" id="ord_qty_allow" name="PHP_ord_qty_allow" value="no">
			
			<tr>
			<td colspan='3'><input type="submit" id="btnSubmit" value="update" class=select style="width:230;height:30;cursor:pointer" onClick="return schd_qtychk();"></td>
			</tr>
			</table>
			</form>
			<!-- <input name="txtQty" type="text" maxlength="30" size="30" class="txtQty" id="name" style="Padding:2px;" />
			<input name="txtQty" type="text" maxlength="30" size="30" class="txtQty" id="other" style="Padding:2px;" /> -->
		</div>
	
	
	
	</td>
  </tr>
  <tr>
	<td colspan=5 >
		<table border cellspacing=0 cellpadding=2 width=470 bgcolor=#ffffff align=center>
			{section name=USE loop=$show_breakdown}
				{$show_breakdown[USE]}
			{/section}
		</table>
	</td>
  </tr>
</table>
<br>
<!-------------  material range ------------->

    <table width=700 border=0 cellspacing=1 cellpadding=2>
     <tr bgcolor=#333333 height=28>
	  <td width=90 class=ylw9 align=center><b>Fabirc #</b></td>
	  <td width=150 class=ylw9 align=center><b>Fabric Name</b></td>
	  <td width=170 class=ylw9 align=center><b>Placement</b></td>
<!--	  <td width=70 class=ylw9 align=center><b>consump.</b></td>	-->
	  <td width=50 class=ylw9 align=center><b>Unit</b></td>
	  <td width=70 class=ylw9 align=center><b>Remark</b></td>
     </tr>

	{if $lots_NONE}  
	  <tr>
		<td colspan=6 align=center class=ssign><br>NO Fabric data!<br><br>
	  </tr>
	{/if}

	{section name=USE loop=$lots_use} 
     <tr bgcolor=#eeeeee height=28>
	  <td width=90 class=snvy align=center><a href="javascript:Show_fab('{$lots_use[USE].lots_code}')" value='ord_out' style='cursor:pointer'>{$lots_use[USE].lots_code}&nbsp;</a></td>
	  <td class=snvy >{$lots_use[USE].lots_name}&nbsp;</td>
	  <td class=snvy >{$lots_use[USE].use_for}&nbsp;</td>
<!--	  <td class=snvy align=center>{$lots_use[USE].est_1}&nbsp;</td>		-->
	  <td class=snvy align=center>{$lots_use[USE].unit}&nbsp;</td>
	  <td class=snvy align=center>{$lots_use[USE].use_method}&nbsp;</td>
	 </tr>
	{/section} 
	 
<!------------------------------------------------>
<!-------------  accessories range ------------->
     <tr bgcolor=#333333 height=28>
	  <td width=90 class=ylw9 align=center><b>Accessory #</b></td>
	  <td width=150 class=ylw9 align=center><b>ACC. Name</b></td>
	  <td width=170 class=ylw9 align=center><b>Placement</b></td>
<!--	  <td width=70 class=ylw9 align=center><b>consump.</b></td>	-->
	  <td width=50 class=ylw9 align=center><b>Unit</b></td>
	  <td width=70 class=ylw9 align=center><b>Remark</b></td>
     </tr>

	{if $acc_NONE}  
	  <tr>
		<td colspan=6 align=center class=ssign><br>NO Accessory data!<br><br>
		<input type="hidden" name="PHP_acc_est" value="">
	  </tr>
	{/if}

	{section name=USE loop=$acc_use} 
     <tr bgcolor=#eeeeee height=28>
	  <td width=90 class=snvy align=center><a href="javascript:Show_acc('{$acc_use[USE].acc_code}')" value='ord_out' style='cursor:pointer'>{$acc_use[USE].acc_code}&nbsp;</a></td>
	  <td class=snvy >{$acc_use[USE].acc_name}&nbsp;</td>
	  <td class=snvy >{$acc_use[USE].use_for}&nbsp;</td>
<!--	  <td class=snvy align=center>{$acc_use[USE].est_1}&nbsp;</td>	-->
	  <td class=snvy align=center>{$acc_use[USE].unit}&nbsp;</td>
	  <td class=snvy align=center>{$acc_use[USE].use_method}&nbsp;</td>
	 </tr>
	{/section} 
  <tr>
    <td colspan=6 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
 </table>
    <table width=700 border=0 cellspacing=1 cellpadding=2>
      <tr bgcolor=#ffffff>
        <td class=gry9 align=center>
        <font color=black>Open: </font>
				<a href="javascript:message_out('{$wi.creator_id}')" style="cursor:pointer"><u>{$wi.creator}</u></a>					        	
        	&nbsp;&nbsp;<u>{$wi.open_date}</u>&nbsp;&nbsp;&nbsp;&nbsp;
        <font color=black>Last Update : </font>
        {if $wi.updator}<a href="javascript:message_out('{$wi.updator_id}')" style="cursor:pointer"><u>{$wi.updator}</u></a>
        &nbsp;&nbsp;<u>{$wi.last_update}</u>&nbsp;&nbsp;&nbsp;&nbsp;{else}[ None ]{/if}
        <font color=black>{literal}Submit: {/literal}</font>
        {if $wi.confirmer}<a href="javascript:message_out('{$wi.confirmer_id}')" style="cursor:pointer"><u>{$wi.confirmer}</u></a>
        &nbsp;&nbsp;<u>{$wi.cfm_date}</u>{else}[ None ]{/if}
        </td>
      </tr>
    </table>
    <!--------- wi data end ---------->
<table border=0 cellspacing=0 cellpadding=2 width=690 bgcolor=#ffffff align=center>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
	<td colspan=2><form method=POST name=back>
{if $back_str}
		<input type=button onClick="window.location.href='{$PHP_SELF}?PHP_action=wi_uncfm{$back_str}'" value=" << go back " class=select_e style="cursor:pointer; width=99%">
{else}&nbsp;
{/if}</form>
	</td>

	<td width=390><form method=POST name=edit action=wi.php>
{if $add_flag}
 		{if $smpl.size_scale == ''}<input type="hidden" name="PHP_msg" value="add SIZE RECORD first!">{/if}
 		{if $total <> $smpl.qty}<input type="hidden" name="PHP_msg" value="ERROR! Please  check Order Q'TY and Order WI Q'TY first!">{/if}
		{if $acc_NONE}
			<input type="hidden" name="PHP_msg" value="ERROR! Please  add Accessory data first!">
		{/if}
		{if $lots_NONE}
			<input type="hidden" name="PHP_msg" value="ERROR! Please add Accessory data first!">
		{/if}
		<input type="hidden" name="PHP_action" value="do_wi_cfm">
		<input type="hidden" name="PHP_id" value="{$wi.id}">
		<input type="hidden" name="PHP_partial_mks" value="{$wi.partial_mks}">
		<input type="hidden" name="PHP_smpl_id" value="{$smpl.id}">
		<input type="hidden" name="PHP_smpl_status" value="{$smpl.status}">
		<input type="hidden" name="PHP_wi" value="{$wi.wi_num}">
		<input type="hidden" name="PHP_revise" value="{$wi.revise}">
		<input type="hidden" name="PHP_order_num" value="{$wi.wi_num}">
		<input type="hidden" name="PHP_sr_startno" value="{$now_pp}">
		<input type="hidden" name="PHP_fty" value="{$smpl.factory}">
		<input type="hidden" name="PHP_back_str" value="{$back_str}">
		<input type="hidden" name="PHP_back_str2" value="{$back_str2}">
		
		<input type="hidden" name="back_PHP_id" value="{$back_PHP_id}">
		
		
		<input type=submit value="[  SUBMIT  ]" class=select_e style="cursor:pointer; width=99%">

{else}&nbsp;
{/if}</form>
	</td>
  </tr>

</table>
{include file="footer.html"}
