<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>===:::::::::: 積物料輔助系統 [ 驗收 資料 ] ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<style type="text/css">@import url(js/calendar/skins/aqua/theme.css);.outline {
	border :1px solid #CCCCCC;
	padding:3px 7px 3px 7px;
	background-color:#FFFFFF;
	color:#000000;
	margin:3px  !important;
	cursor:pointer;
}</style>
<script type="text/javascript" src="./js/calendar/calendar.js"></script>
<script type="text/javascript" src="./js/calendar/lang/calendar-en.js"></script>
<script type="text/javascript" src="./js/calendar/calendar-setup.js"></script>
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script language="javascript" src="./js/open_detial.js"></script>
<script type="text/javascript" src="./js/jquery.blockUI.js"></script>
<Script language="javascript">
var dm_way = {/literal} '{$dm_way}' {literal}
var apb_count = {/literal} {$rcv|@count} {literal}
var all_po = new Array();
$(document).ready(function() {
	rate = function (rcv_num,i,p){
		$.ajax({
			url: 'apb.php?PHP_action=check_rate',
			type: 'GET',
			data: {
				PHP_rcv_date: $("#date").val(),
				PHP_cury: $("#PHP_currency"+rcv_num+i).val()
			},
			error: function(xhr) {
				alert('Ajax request 發生錯誤'+xhr);
			},
			success: function(response) {
				if ( response != 0 ) {
					$('#currency'+rcv_num+i ).html(response);
					tmp_rate = $("#PHP_uprices"+rcv_num+i ).val() * response;
					/*divi = $("#PHP_uprice"+rcv_num+i ).val() / $("#PHP_ORI_price"+rcv_num+i ).val();
					old_price = roundAmount($("#price"+rcv_num+i).text());
					$("#PHP_uprice"+rcv_num+i).val( tmp_rate=roundAmount5(tmp_rate) );
					$("#PHP_ORI_price"+rcv_num+i).val( $("#PHP_uprice"+rcv_num+i).val() / divi );*/
					if(dm_way == 'T/T after shipment' || dm_way == 'L/C at sight'){
						var price=0;
						//判斷驗收數量是否大於tolerance數量
						if ( Number($("#apb_qty"+rcv_num+i).val()) > Number($("#toler_qty"+rcv_num+i).val()) ){
							new_price = roundAmount($("#PHP_ORI_price"+rcv_num+i).val() * ($("#toler_qty"+rcv_num+i).val() * 100 / 100));
						}else{
							new_price = roundAmount(Number($("#PHP_ORI_price"+rcv_num+i).val()) * Number($("#apb_qty"+rcv_num+i).val()));
						}
						$("#price"+rcv_num+i).text( roundAmount(new_price) );
						
						$("span[id^=price"+rcv_num+"]").each(function(i,elm) {
							price += Number($("#price"+rcv_num+i).text());
						});
						
						$("#PHP_uprice"+rcv_num+i).val( tmp_rate=roundAmount5(tmp_rate) );
						//tmp_price = $("#amount"+rcv_num).val() * 100 / 100;
						$("#amount"+rcv_num).val(roundAmount(price));
					}else if(dm_way == 'L/C'){
					
					}else{ //30% 70%
						var price=0;
						new_price = roundAmount($("#PHP_NTD_uprice"+rcv_num+i).val() * ($("#PHP_rcv_qty"+rcv_num+i).val() * 100 / 100));
						$("#price"+p+i).text( roundAmount(new_price) );
						
						$("span[id^=price"+p+"]").each(function(i,elm) {
							price += Number($("#price"+p+i).text());
						});
						
						$("#uprice"+rcv_num+i).val( tmp_rate=roundAmount5(tmp_rate) );
						tmp_price = $("#amount"+rcv_num).val() * 100 / 100;
						$("#amount"+rcv_num).val(roundAmount(price));
					}
				} else {
					if ( $("#PHP_currency"+i).val() == 'NTD' ) {
						$("#currency" + rcv_num + i).html('1');
					} else {
						$("#currency" + rcv_num + i).html('沒有此匯率！');
					}
				}
				if($("#PHP_checkbox"+rcv_num).attr("checked")) invoice();
			}
		});
	};
    
    select_checkbox = function(status){
        if ( status == 'Select' ) {
            $("input[id^=PHP_checkbox]").each(function(i, elm) {
                $(elm).attr("checked",true);
            });
            invoice();
        } else {
            $("input[id^=PHP_checkbox]").each(function(i, elm) {
                $(elm).attr("checked",false);
            });
            invoice();
        }
    }
});

function invoice(){

	var price = Number(0);
	var price_num = {/literal}{$rcv|@count}{literal}
	
	$("input[id^=oth_cost_id]").each(function(i,elm) {
		if($(elm).attr("checked")){
			price += Number($("#po_cost" + $(elm).val() ).val());
		}
	});
	
	$("input[id^=PHP_checkbox]").each(function(i,elm) {
		if($(elm).attr("checked")){
			$("#amount" + $(elm).val() ).parent().parent().css("background-color","#f5d226");
			price += Number($("#amount" + $(elm).val() ).val());
		}else{
			$("#amount"+ $(elm).val() ).parent().parent().css("background","#DBC9F2");
		}
	});
	
	$("input[id^=apb_oth_cost]").each(function(i,elm) {
		price += Number(roundAmount($(elm).val()));
	});
	
	if ( $("#inv_num").val() != "" ) {
		$("#vat").val( Math.round(price*.05) );
	}
	
	if($("#PHP_select_currency").val()=="NTD")
		Number($("#inv_amt").val( Math.round(price)));
	else
		Number($("#inv_amt").val(price));
	
	price = price + Number($("#vat").val()) - Number($("#discount").val()) - Number($("#off_duty").val());
	
	if($("#PHP_select_currency").val()=="NTD")
		Number($("#inv_price").val( Math.round(price)));
	else
		Number($("#inv_price").val(price));
}

function rcv(rcv_num,idx,re_cal_flag){
	var apb=price= Number(0);
	$("input[id^=apb_qty" + rcv_num + "]").each(function(i,elm) {
		str = $(elm).attr("id").split("apb_qty");
		
		if($("#PHP_mark"+str[1]).attr("checked")){
			if( Number($(elm).val()) > Number($("#toler_qty"+str[1]).val()) ){
				alert("APB數量超過 Tolerance數量 " + Number($("#toler_qty"+str[1]).val()) + " ，將用 " + Number($("#toler_qty"+str[1]).val()) + " 計算");
				$(elm).val($("#toler_qty"+str[1]).val());
				$("#price"+str[1]).text( roundAmount($("#toler_qty"+str[1]).val() * $("#PHP_uprice"+str[1]).val()));
			}else{
				$("#price"+str[1]).text( roundAmount($(elm).val() * $("#PHP_uprice"+str[1]).val()));
			}
		}else{
			$("#price"+str[1]).text( 0 );
		}
		
		if(str[1].indexOf(rcv_num) != -1){
			price += Number($("#price"+str[1]).text());
		}
		if(i == idx && re_cal_flag){
			avg_qty(rcv_num,i,Number($("#ttl_po_qty"+str[1]).val()));
		}
	});
	$("#amount"+rcv_num).val( roundAmount(price) );
	invoice();
}

function avg_qty(rcv_num,i,po_qty){
	var tmp_qty = sum_tmp_qty = percent = count = k = 0;
	var apb_qty = Number($("#apb_qty"+rcv_num+i).val());
	
	percent = apb_qty / po_qty;
	percent = roundAmount5(percent);
	
	$("input[id^=PHP_link_qty"+rcv_num+i+"_]").each(function(j, elm) {
		count++;
	});
	
	$("input[id^=PHP_po_qty"+rcv_num+i+"_]").each(function(j, elm) {
		k++;
		str = $(elm).attr("id").split("PHP_po_qty");
		if( k != count ){
			tmp_qty = roundAmount( Number($(elm).val()) * percent );
			sum_tmp_qty += Number(tmp_qty);
			$("#PHP_link_qty"+rcv_num+i+"_"+j).val(tmp_qty);
			
		}else{
			sum_tmp_qty = roundAmount(sum_tmp_qty);
			$("#PHP_link_qty"+rcv_num+i+"_"+j).val(roundAmount(apb_qty - sum_tmp_qty));
		}
	});
}

var pre_rcv_num_i;
function chk_qty(r,rcv_num,i){
	var sum_avg_qty = 0;
	var apb_qty = Number($("#apb_qty"+rcv_num+i).val());
	
	$("input[id^=PHP_link_qty"+rcv_num+i+"_]").each(function(j, elm) {
		sum_avg_qty += Number(roundAmount($(elm).val()));
	});
	
	if(pre_rcv_num_i == rcv_num+i)
		document.getElementById('descript').innerHTML = "";
	
	if(sum_avg_qty != apb_qty){
		$("#append_apb").attr("disabled",true);
		$("#descript").css("display","");
		document.getElementById('descript').innerHTML += "=====訂單數量=====&nbsp;&nbsp;<br>";
		$("input[id^=PHP_link_qty"+rcv_num+i+"_]").each(function(j, elm) {
			document.getElementById('descript').innerHTML += $(elm).val() + "&nbsp;" + "<BR>";
		});
		document.getElementById('descript').innerHTML += "<hr>";
		document.getElementById('descript').innerHTML += "總和 " + sum_avg_qty + "<br>";
		document.getElementById('descript').innerHTML += "不等於apb qty " + apb_qty + "<br>";
		var pos = $(r).offset();  
		var x = pos.left;  
		var y = pos.top;  
		$("#descript").css("top",y+"px");
		$("#descript").css("left",x+70+"px");
	}else{
		document.getElementById('descript').innerHTML = "";
		$("#descript").css("display","none");
		$("#append_apb").attr("disabled",false);
	}
	pre_rcv_num_i = rcv_num+i;
}

function roundAmount(n) {   
	var s = "" + Math.round( n * 100 ) / 100   
	var i = s.indexOf('.')   
	if ( i < 0 ) return s + ".00"
	var t = s.substring( 0 , i + 1 ) +     
	s.substring( i + 1 , i + 3 )   
	if (i + 2 == s.length) t += "0"   
		return t   
}

function roundAmount5(n) {   
	var s = "" + Math.round( n * 100000 ) / 100000   
	var i = s.indexOf('.')  
	
	if ( i < 0 ) return s + ".00000"
	var t = s.substring( 0 , i + 1 ) +     
	s.substring( i + 1 , i + 6 )   
	if (i + 5 == s.length) t += "0"   
		return t   
}

function roundAmount2(n) {   
	var s = "" + Math.round( n * 100 ) / 100   
	var i = s.indexOf('.')   
	if ( i < 0 ) return s
	var t = s.substring( 0 , i )
		return t   
}



function show_rcvd_qty(qty,id,unit,table)
{
	var url ="receive.php?PHP_action=recv_qty_show&PHP_qty="+qty+"&PHP_id="+id+"&PHP_unit="+unit+"&PHP_table="+table;
	var nm = 'rcvd';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=500,height=500 top=50, left=100');
}

function apb_append(){
	if ( $("#inv_amt").val() == 0 ) {
		alert("請勾選付款金額");
		return false;
	}
	
	var mod = 0;
	$("input[id^=no]").each(function(i,elm) {
		if( Number($("#PHP_uprices"+$(elm).val()).val()) == 0 ) mod ++
	});
	
	if ( mod != 0 ){
		alert('請輸入原幣單價！');
		return false;
	}
	
	$.blockUI({ message: '<div><h3>Appending...</h3></div>'});
	
}

function mask(msg){
	$.blockUI({ message: '<div><h4>' + msg + '</h4></div>'});
}

function oth_cost(r,id,value){
	if(r.checked)
		$("#inv_amt").val( Number($("#inv_amt").val()) + Number($("#oth_cost"+id).val()) );
	else
		$("#inv_amt").val( Number($("#inv_amt").val()) - Number($("#oth_cost"+id).val()) );
	
	invoice();
}

var tmp_i=0;
function add_oth_cost(t){
	
	document.getElementById('add_oth_cost_tbl').style.display = '';
	scroll(0,document.body.scrollHeight);
	r = add_oth_cost_tbl.insertRow();
	r.insertCell().innerHTML = "<tr bgcolor=#eeeeee><td class=gry9 align=left><input type='text' size='10' name='PHP_ap_num[" + t.value + "][]' class=select value='" + t.value + "'></td>";
	r.insertCell().innerHTML = "<td class=gry9 align=left><input type='text' size='100' name='PHP_des[" + t.value + "][]' class=select></td>";
	r.insertCell().innerHTML = "<td class=ylw9 align=center><input type='text' size='10' id='apb_oth_cost" + tmp_i +"' name='PHP_cost[" + t.value + "][]' class=select onkeyup=\"" + "this.value.replace(/[^\d\.]/g,'');invoice()" + "\"" + ";></td>";
	r.insertCell().innerHTML = "<td class=ylw9 align=center>&nbsp;<image src='images/del.png' onClick=del_cost(this); style='cursor: pointer;'>&nbsp;</td>";
	r.insertCell().innerHTML = "</tr>";
}

function del_cost(r){
	if(confirm("確定要刪除?"))
		document.getElementById('add_oth_cost_tbl').deleteRow(r.parentNode.parentNode.rowIndex);
}

function change_currency(NTD){
	if(NTD==undefined){
		var currency = $("#PHP_select_currency").val();
	}else{
		$("#PHP_select_currency").val("NTD");
		var currency = "NTD";
	}
	
	$("span[id^=cury]").each(function(i,elm) {
		$(elm).text(currency);
	});

	$("select[id^=PHP_currency]").each(function(i,elm) {
		$(elm).val(currency).change()
	});
	invoice();
}

function cal_amt(rcv_num){
	var currency = $("#PHP_select_currency").val();
	var price = 0;
	$("input[id^=apb_qty" + rcv_num + "]").each(function(i,elm) {
		str = $(elm).attr("id").split("apb_qty");
		
		if($("#PHP_mark"+str[1]).attr("checked")){
			if(currency=="NTD"){
				$("#PHP_uprice"+str[1]).val( roundAmount($("#PHP_uprices"+str[1]).val() * $("#PHP_rate"+str[1]).val()) );
				$("#price"+str[1]).text( roundAmount($(elm).val() * $("#PHP_uprice"+str[1]).val()));
			}else{
				$("#PHP_uprice"+str[1]).val( roundAmount5($("#PHP_uprices"+str[1]).val() * $("#PHP_rate"+str[1]).val()) )
				$("#price"+str[1]).text( roundAmount($(elm).val() * $("#PHP_uprices"+str[1]).val()));
			}
			price += Number($("#price"+str[1]).text());
		}
	});
	
	$("#amount" + rcv_num).val(roundAmount(price));
	invoice();
}

function input_qty(rcv_num,i){
	$("#span_text_"+rcv_num+i).html("");
	$("#span_"+rcv_num+i).css("display","");
}
</script>
{/literal}
<body topmargin="10" onLoad="" >
<div id="descript" style="position:absolute;width:150px;background-color:#f5e700;text-align:right;display:none"></div>
<form METHOD="POST" name="rcvd_add" action="{$PHP_SELF}">
<br>
<table cellspacing=1 cellpadding=4 cols=1 width=900 bgcolor=#003300>
	<tr><td class="des" align=center height=28>[<b> 驗收付款單&nbsp; <span class=ylw10>Append&nbsp;</span> </b> ] </td></tr>
</table>

{if $msg_YES}
<table border=1 cellpadding=4 cellspacing=0 cols=1 width=900>
	<tr bgcolor=#ffffff> 
		<td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
		<td class=bgdy>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</td>
	</tr>
</table>
{/if}

<table border=0 cellspacing=2 cellpadding=2 width=900 bgcolor=#FFFFFF>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
		<td class=snvy align=right bgcolor=#E9F7E8><b>驗收單號 :</b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$rcv_num}</b></td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>&nbsp;付款方式 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b><input type="hidden" name="PHP_payment" value="{$dm_way}">{$dm_way}</b></td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>付款幣別 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$currency}</b></td>
		<td class=snvy align=right bgcolor=#E9F7E8><b>合計金額 : </b></td>
		<td align=left class=des ><input type=text id="inv_amt" size=15 class=select value="" readonly="readonly" style="text-align:right"></td>
	</tr>
  <tr>
		<td class=snvy align=right bgcolor=#E9F7E8 nowrap><b>供應商代號 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$supl.vndr_no}</b>
		  <input type="hidden" name="PHP_sup_no" value="{$supl.vndr_no}"></td>
		<td  align=right nowrap bgcolor=#E9F7E8 class=snvy><b>請款單位 : </b></td>
		<td align=left bgcolor="#EEEEEE">
			<b>&nbsp;{$dept}
				<input type="hidden" name="PHP_dept" value="{$dept}">
				<input type="hidden" name="PHP_ship" value="{$ap.ship}">
			</b>
		</td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>請款日期 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$date}</b></td>
		<td class=snvy align=right bgcolor=#E9F7E8><b>營業稅 : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="vat" name="PHP_vat" size=15 class=select value="{$vat}" style="text-align:right" onkeyup="invoice('');this.value=this.value.replace(/[^\d]/g,'');"></td>
	</tr>
	<tr>
		
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>供應商名稱 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$supl.supl_s_name}</b></td>
		
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>統一發票 : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="inv_num" name="PHP_inv_num" size=15 class=select value="{$inv_num}" onchange="change_currency('NTD');"></td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>發票日期 : </b></td>
		<td align=left bgcolor="#EEEEEE">
			<input name="PHP_inv_date" type="text" class="select" style="width:72px;" id="inv_date" value="" readonly="readonly" />
			{literal}
			<script type="text/javascript">Calendar.setup({inputField:"inv_date",button:"f_trigger_c",ifFormat:"%Y-%m-%d"});</script>
			{/literal}
		</td>
		<td class=snvy align=right bgcolor=#E9F7E8><b>折讓 : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="discount" name="PHP_discount" size=15 class=select style="text-align:right" value="{$discount}" onkeyup="invoice('');this.value=this.value.replace(/[^\d]/g,'');"></td>
	</tr>
  <tr>
		<td class=snvy align=right bgcolor=#E9F7E8><b>供應商統編 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$supl.uni_no}</b><input type="hidden" name="PHP_uni_no" value="{$supl.uni_no}">	</td>
		
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>INVOICE # : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text name="PHP_foreign_inv_num" size=15 class=select value=""></td>
		<td></td>
		<td></td>
		<td class=snvy align=right bgcolor=#E9F7E8><b>折稅 : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="off_duty" name="PHP_off_duty" size=15 class=select style="text-align:right" value="{$off_duty}" onkeyup="invoice('');this.value=this.value.replace(/[^\d]/g,'');"></td>
  </tr>
  <tr>
	<td align=right nowrap bgcolor=#E9F7E8 class=snvy colspan=7><b>總合計金額 : </b></td>
	<td align=left bgcolor="#FF0000" class=des><input type=text id="inv_price" name="PHP_inv_price" size=15 class=select style="text-align:right" value="{$inv_price}" readonly="readonly"></td>
  </tr>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
</table>
<input name="radio" type="radio" value="" Onclick="select_checkbox('Select');"/> Select All 
<input name="radio" type="radio" value="" Onclick="select_checkbox('Clear');"/> Clear All
{section name=PUR loop=$rcv}
	<table border=0 cellspacing=0 cellpadding=2 width="900" id="table">
		<tr class=snvy bgcolor=#DBC9F2>
			<td align=left nowrap>
				<input type="checkbox" id="PHP_checkbox{$rcv[PUR].rcv_num}" name="PHP_checkbox[{$rcv[PUR].rcv_num}]" onclick="invoice()" value="{$rcv[PUR].rcv_num}" {if $rcv[PUR].amount <=0} disabled {/if}>
				<input type="text" size=10 id="amount{$rcv[PUR].rcv_num}" value="{$rcv[PUR].amount}">
			</td>
			<td align=right nowrap><b>Ship num # : </b></td>
			<td align=left nowrap><b>{$rcv[PUR].rcv_num}</b>
				<input type="hidden" size=10 name="PHP_ship_num[{$rcv[PUR].rcv_num}]" value="{$rcv[PUR].rcv_num}">
			</td>
            <!-- 		
			<td align=right nowrap><b>Rcv num # : </b></td>
			<td align=left nowrap><b>{$rcv[PUR].rcv_num}</b>
				<input type="hidden" size=10 name="PHP_rcv_num[{$rcv[PUR].rcv_num}]" value="{$rcv[PUR].rcv_num}">
			</td>
            -->
			<td align=right nowrap><b>Ship date : </b></td>
			<td align=left nowrap><b>{$rcv[PUR].rcv_date}</b></td>
		</tr>
	</table>
	
	<table border="2" width="900" cellspacing=0 cellpadding=5 id="table{$smarty.section.PUR.index}">	
		<tr bgcolor="#584E5C" height=30>
			<td class=back align="center" nowrap><b>Invoice#</b></td>
			<td class=back align="center" nowrap><b>Order #</b></td>
			<td class=back align="center" nowrap><b>Material #</b></td>		
			<td class=back align="center" nowrap><b>color/cat</b></td>
			<td class=back align="center" nowrap><b>P / O #</b></td>
			<td class=back align="center" nowrap><b> % </b></td>
			<td class=back align="center" nowrap><b>PO<br>Q'ty</b></td>
			<td class=back align="center" nowrap><b>SHIP.<br>Q'ty</b></td>
			<td class=back align="center" nowrap><b>APB.<br>Q'ty</b></td>
			<td class=back align="center" nowrap style="display:none"><b>ord / qty</b></td>
			<td class=back align="center" nowrap><b>FOC</b></td>
			<td class=back align="center" nowrap><b>原幣單價</td>
			<td class=back align="center" nowrap><b><span id="cury">{$rcv.0.rcv_det.0.currency}</span>單價</b></td>
			<td class=back align="center" nowrap><b>匯率</b></td>
			<td class=back align="center" nowrap><b>小計</b></td>
		</tr>
		{section name=RCV_D loop=$rcv[PUR].rcv_det}
        <tr id="tr_po{$smarty.section.PUR.index}{$rcv[PUR].rcv_det[RCV_D].po.i}" value="{$rcv[PUR].rcv_det[RCV_D].po_num}" onmouseover="bgColor='#FCF4A4'" onmouseout="bgColor='#ffffff'" onDblclick="add_oth_cost(this)">
            <td align="left" nowrap>
                <input type="checkbox" id="PHP_mark{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" name="PHP_mark[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" value="{$rcv[PUR].rcv_det[RCV_D].mark}" checked onclick="rcv('{$rcv[PUR].rcv_num}',{$rcv[PUR].rcv_det[RCV_D].po.i},0)">
                <input type="text" name="PHP_rcv_inv[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size="10" value="{$rcv[PUR].rcv_det[RCV_D].inv_num}" readonly>
            </td>
            <td align="left" nowrap>
            {section name=ords loop=$rcv[PUR].rcv_det[RCV_D].link_qty}
                <a href="javascript:po_bom_view('{$rcv[PUR].rcv_det[RCV_D].link_qty[ords].ord_num}','{$rcv[PUR].rcv_det[RCV_D].po.ap_num}')" style='cursor:pointer'>{$rcv[PUR].rcv_det[RCV_D].link_qty[ords].ord_num}</a>&nbsp;<br>
            {/section}
            </td>
            <td align="center" nowrap>
                <a href="javascript:{if $rcv[PUR].rcv_det[RCV_D].mat_code|substr:0:1 == 'F'}Show_fab{else}Show_acc{/if}('{$rcv[PUR].rcv_det[RCV_D].mat_code}')" value='ord_out' style='cursor:pointer'>{$rcv[PUR].rcv_det[RCV_D].mat_code}</a>
                <input type="hidden" name="PHP_mat_code[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size="10" value="{$rcv[PUR].rcv_det[RCV_D].mat_code}">
            </td>
            <td align="left" nowrap><small>{$rcv[PUR].rcv_det[RCV_D].color}</small>&nbsp;
                <input type="hidden" name="PHP_color[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size="20" value="{$rcv[PUR].rcv_det[RCV_D].color}">
            </td>
            <td align="center" nowrap>
                <a href="javascript:po_show('{$rcv[PUR].rcv_det[RCV_D].ap_num}','')" value='ord_out' style='cursor:pointer'><b>{$rcv[PUR].rcv_det[RCV_D].po_num}</b></a>
            </td>
            <td align="center" nowrap>{if $rcv[PUR].rcv_det[RCV_D].po.toler == '0|0'}0{else}+{$rcv[PUR].rcv_det[RCV_D].po.toleri}%{if $rcv[PUR].rcv_det[RCV_D].po.tolern != '0'} ~ -{$rcv[PUR].rcv_det[RCV_D].po.tolern}%{/if}{/if}</td>
            <td align="center" nowrap>
                {$rcv[PUR].rcv_det[RCV_D].po.po_qty} {$rcv[PUR].rcv_det[RCV_D].po.po_unit}
                <input type="hidden" id="ttl_po_qty{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" name="PHP_po_qty[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size="2" value="{$rcv[PUR].rcv_det[RCV_D].po.po_qty}">
                <input type="hidden" name="PHP_po_unit[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size="2" value="{$rcv[PUR].rcv_det[RCV_D].po.po_unit}">
                <input type="hidden" name="PHP_prc_unit[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size="2" value="{$rcv[PUR].rcv_det[RCV_D].po.prc_unit}">
            </td>
            <td align="right" nowrap>
                <input type="text" id="rcvd_qty{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" name="PHP_rcv_qty[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size="5" value="{$rcv[PUR].rcv_det[RCV_D].qty}" readonly>
                <BR><input type="hidden" id="toler_qty{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" size="5" value="{$rcv[PUR].rcv_det[RCV_D].toler_qty}">
            </td>
            <td align="right" nowrap>
                <input type="text" id="apb_qty{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" name="PHP_apb_qty[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size="5" class="select" value="{$rcv[PUR].rcv_det[RCV_D].apb_qty}" onchange="rcv('{$rcv[PUR].rcv_num}',{$rcv[PUR].rcv_det[RCV_D].po.i},1);">
                <input type="hidden" id="ori_apb_qty{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" value="{$rcv[PUR].rcv_det[RCV_D].apb_qty}">
            </td>
            <td align="left" nowrap  style="display:none">
                <span id="span_text_{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" onclick="javascript:input_qty('{$rcv[PUR].rcv_num}',{$rcv[PUR].rcv_det[RCV_D].po.i});" style="cursor:pointer">re-input Qty</span>
                <span id="span_{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" style="display:none">
                {section name=ords loop=$rcv[PUR].rcv_det[RCV_D].link_qty}
                    {if $smarty.section.ords.index > 0}<br>{/if}
                    <input type="text" id="PHP_link_qty{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}_{$smarty.section.ords.index}" name="PHP_link_qty[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}][{$rcv[PUR].rcv_det[RCV_D].link_qty[ords].ord_num}]" class="select" size="5" value="{$rcv[PUR].rcv_det[RCV_D].link_qty[ords].qty}" onchange="chk_qty(this,'{$rcv[PUR].rcv_num}',{$rcv[PUR].rcv_det[RCV_D].po.i})">
                    <input type="hidden" id="PHP_po_ship_qty{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}_{$smarty.section.ords.index}" value="{$rcv[PUR].rcv_det[RCV_D].link_qty[ords].apb_qty}">
                    <input type="hidde" id="PHP_po_qty{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}_{$smarty.section.ords.index}" value="{$rcv[PUR].rcv_det[RCV_D].link_qty[ords].po_qty}">
                    <input type="hidden" name="PHP_po_id[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}][{$rcv[PUR].rcv_det[RCV_D].link_qty[ords].ord_num}]" value="{$rcv[PUR].rcv_det[RCV_D].link_qty[ords].po_id}">
                {/section}
                </span>
            </td>
            <td align="center" nowrap>
                <input type=text id="foc{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" name="PHP_foc[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size=5 class=select style="text-align:center">
            </td>
            <td align="center" nowrap>
                <input type="text" id="PHP_uprices{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" name="PHP_uprices[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size=5 value="{$rcv[PUR].rcv_det[RCV_D].po.prics}" readonly>
            </td>
            <td align="center" nowrap>	
                <input type="text" id="PHP_uprice{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" name="PHP_uprice[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size=5 value="{$rcv[PUR].rcv_det[RCV_D].po.prics}" onChange="this.value=roundAmount5(this.value.replace(/[^\d\.]/g,''));rcv('{$rcv[PUR].rcv_num}',{$rcv[PUR].rcv_det[RCV_D].po.i},0);" class="select">
            </td>
            <td align="center" nowrap>
                <input type=text id="PHP_rate{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}" name="PHP_rate[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" size=5 class=select value="{$rcv[PUR].rcv_det[RCV_D].po.rate}" onchange="cal_amt('{$rcv[PUR].rcv_num}')" style="text-align:center">
                <small><span id="currency{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}"></span></small>
            </td>
            <td align="center" nowrap bgcolor="#FFCECD">
                <span id="price{$rcv[PUR].rcv_num}{$rcv[PUR].rcv_det[RCV_D].po.i}">{$rcv[PUR].rcv_det[RCV_D].po.price}</span>
            </td>
            <input type="hidden" name="PHP_ap_num[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" value="{$rcv[PUR].rcv_det[RCV_D].ap_num}">
            <input type="hidden" name="PHP_mat_id[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" value="{$rcv[PUR].rcv_det[RCV_D].mat_id}">
            <input type="hidden" name="PHP_size[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" value="{$rcv[PUR].rcv_det[RCV_D].size}">
            <input type="hidden" name="PHP_toler[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" value="{$rcv[PUR].rcv_det[RCV_D].po.toler}">
            <input type="hidden" name="PHP_rcv_det_id[{$rcv[PUR].rcv_num}][{$rcv[PUR].rcv_det[RCV_D].po.i}]" value="{$rcv[PUR].rcv_det[RCV_D].id}">
        </tr>
        <tr>
            <td colspan="10"><span id="reasons{$rcv[PUR].rcv_det[RCV_D].po.rate}" ></span></td>
        </tr>
		{/section}
			<!--<tr>
				<td colspan=7 align="center">合計</td>	
				<td cellpadding=2 align="right"><b><span id="po_sum">po_sum</span></b></td>
				<td cellpadding=2 align="right"><b><span id="rcvd_sum">rcvd_sum</span></b></td>
				<td cellpadding=2 align="center"><b><span id="foc_sum">FOC</span></td>
				<td cellpadding=2 align="center">&nbsp;</td>
				<td cellpadding=2 align="center">&nbsp;</td>
			</tr>-->
	</table>
	<br>
{/section}


{if $rcv_log}  
<table border=1 cellspacing=0 cellpadding=0 width=900 align=center>
	<tr bgcolor=#bbbbbb height=25>
		<td colspan=5 align=center class=nvy9><b>Remark Records</b></td>
	</tr>
	<tr bgcolor=#666666 height=25>
		<td width=100 class=w10 align=center>Date</td>
		<td width=80 class=w10 align=center>Item</td>
		<td width=300 class=w10 align=center>History records</td>
		<td width=80 class=w10 align=center>by</td>
	</tr>
	{section name=SEC loop=$rcv_log}
	<tr bgcolor=#eeeeee >
		<td class=gry9 align=center><small>{$rcv_log[SEC].k_date}</small></td>
		<td class=gry9 align=left>{$rcv_log[SEC].item}</td>
		<td class=gry9 align=left>{$rcv_log[SEC].des}</td>
		<td class=gry9 align=center>{$rcv_log[SEC].user}</td>
	</tr>
	{/section}
</table>
{/if} 

<br>
{if $ap_oth_cost}
<table border=1 cellspacing=0 cellpadding=0 width=750 align=center>
	<tr bgcolor=#A49587 height=25>
		<td colspan=5 align=center class=nvy9><b>Other cost</b></td>
	</tr>
	<tr bgcolor=#54473B height=25>
		<td width=20></td>
		<td width=150 class=w10 align=center>P/O #</td>
		<td width=400 class=w10 align=center>History records</td>
		<td width=150 class=w10 align=center>Cost</td>
	</tr>
	{section name=SEC loop=$ap_oth_cost}
		<tr bgcolor=#E2D9D1 >
			<td width=20><input type="checkbox" id="oth_cost_id{$ap_oth_cost[SEC].id}" name="oth_cost_id[]" onclick="oth_cost(this,{$ap_oth_cost[SEC].id},this.value)" value='{$ap_oth_cost[SEC].id}'></td>
			<td class=gry9 align=center>{$ap_oth_cost[SEC].ap_num}</td>
			<td class=gry9 align=left>{$ap_oth_cost[SEC].item}</td>
			<td class=gry9 align=left>{$ap_oth_cost[SEC].cost}<input type="hidden" id="po_cost{$ap_oth_cost[SEC].id}" value="{$ap_oth_cost[SEC].cost}"></td>
			<!--<input type="hidden" id="apb_oth_cost{$ap_oth_cost[SEC].id}" value='{$ap_oth_cost[SEC].cost}'>-->
		</tr>
	{/section}
</table>
{/if}
<BR>

<table border=1 cellspacing=0 cellpadding=0 width=600 align=center id="add_oth_cost_tbl" style="display:none;">
		<tr bgcolor=#bbbbbb height=25>
			<td colspan=4 align=center class=nvy9><b>ADD Other Cost</b></td>
		</tr>
		<tr bgcolor=#666666 height=25>
			<td width=100 class=w10 align=center>P/O #</td>
			<td width=400 class=w10 align=center>Remark</td>
			<td width=80 class=w10 align=center>Cost</td>
			<td width=20 class=w10 align=center></td>
		</tr>
</table>
<br>

<input type="hidden" name="PHP_chkacc_user" value={$user}>
<table width="900" border="0" cellspacing="6" cellpadding="6">
  <tr>
    <td>&nbsp;</td>
    <td width="10%" align="right" nowrap>日期：<b>{$date}</b><input type="hidden" id="date" value="{$date}"></td>
    <td width="10%" align="right" nowrap>經辦：<font color="#0000FF"><b>{$user}</b></font></td>
  </tr>
</table>

<table border=0 cellspacing=0 cellpadding=0 cols=2 width=700>
 <tr> 
 	<td>
	{if $back_str}
		<input type=button onClick="window.location.href='{$PHP_SELF}?PHP_action=rcvd_add_search{$back_str}'" value=" << go back " class=select_e style="cursor:pointer; width=99%">
	{else}&nbsp;
	{/if}
	</td>
  <td align=center>
  	<input type="hidden" name="PHP_back_str" value="{$back_str}">
    <input type="hidden" name="PHP_action" value="do_apb_month_tw_add">
	<input type="hidden" name="PHP_b_a" value="{$b_a_flag}">
		<input type=submit id="append_apb" value="[ Append above record ]" class=select_e style="cursor:pointer; width=95%" onClick="return apb_append();">
   </td>
 </tr>
</table>
</form>
<!--------- footer ---------->
{include file="footer.html"}