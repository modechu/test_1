<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>===:::::::::: SCM SYSTEM ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script language="javascript" src="./js/open_detial.js"></script>
<script type="text/javascript" src="./js/jquery.blockUI.js"></script>

<script type="text/javascript" src="./js/build/yahoo/yahoo-min.js"></script>
<script type="text/javascript" src="./js/build/connection/connection-min.js"></script>
<script language="javascript" src="./js/col.js"></script>
<Script language="javascript">

function search_ord(dept,cust,cat,pa_num,po_num,ap_supl) {
	var url ='po.php?PHP_action=po_pp_add_search&PHP_dept='+dept+'&PHP_cust='+cust+"&PHP_item="+cat+"&PHP_pa_num="+pa_num+"&ap_supl="+ap_supl; 	
	var nm = 'ordsearchpp';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=800,height=700 top=50, left=100');
}

function writeToAPAdd(ap_num,order,mat_cat,used_id,color,qty,unit,vendor,back_str){
	//alert(ap_num+','+order+','+mat_cat+','+used_id+','+color+','+qty+','+unit+','+vendor+','+back_str);
	$.blockUI({ message: '<div><br><h4>Waiting...</h4></div>'});
	
	var rev = window.document.forms['apply_add'].elements['PHP_rev'].value;
	//var supl = window.document.forms['apply_add'].elements['ap_supl'].value;
	var supl = '{/literal}{$ap.sup_code}{literal}';
	if ( supl != vendor ) {
		if ( !confirm("Are you sure to change supplier for this Material")) {
			$.unblockUI();
			return;
		} 
	}	

	window.location='po.php?PHP_action=do_apply_pp_edit&PHP_ap_num='+ap_num+'&PHP_wi_num='+order+'&PHP_used_id='+used_id+'&PHP_mat_cat='+mat_cat+"&PHP_qty="+qty+'&PHP_vendor='+vendor+"&PHP_color="+color+"&PHP_unit="+unit+"&ap_supl="+supl+"&PHP_rev="+rev;
}

(function($){
	$(document).ready(function(){
	
		del_mat = function (ap_id,ap_num,mat_code,mat_cat,color,r){
		
			if ( confirm("Are you sure to delete Material : [ "+mat_code+" ] Color/cat : ["+color+"] ?") ) {
			
				$.blockUI({ message: '<div><br><h4>Waiting...</h4></div>'});

				$.ajax({
					url: 'index2.php?PHP_action=del_ap_det_ajax',
					type: 'GET',
					data: {
						PHP_id: ap_id ,
						PHP_ap_num: ap_num ,
						PHP_mat_code: mat_code 
					},
					error: function(xhr) {
						alert('Ajax request µo¥Í¿ù»~'+xhr);
					},
					success: function(o) {
						var i=r.parentNode.parentNode.rowIndex;
						document.getElementById('mat_table').deleteRow(i);
						document.getElementById("tbl_msg").style.display='block';
						msg1.innerText  = o;
						setTimeout(function(){ $.unblockUI(); }, 600);
					}
				});
			} 
		};

	});
})(jQuery);



function add_check(id,ap_num,back_str,revise,sup_id,old_des) {
	var new_spec = window.document.forms['apply_add'].elements['PHP_special'].value;
	var tab = document.getElementById("mat_table");
	var rows = tab.rows.length ;
	//alert(rows);
	if(rows == 1) {
		alert("NO Purchase Item!! \r\r This Purchase will be deleted !");
		window.location="po.php?PHP_action=do_apply_del&PHP_ap_num="+ap_num+"&PHP_back="+back_str;
	} else {
		window.location='po.php?PHP_action=po_pp_revise&PHP_id='+id+'&PHP_new_special='+new_spec+'&PHP_ap_num='+ap_num+"&PHP_cgi="+back_str+"&PHP_sup_id="+sup_id+"&PHP_revise={/literal}{$revise}{literal}"; 	
	}
}


</script>
{/literal}
</head>
<body>
<br>
<form METHOD="POST" name="apply_add" action="{$PHP_SELF}">
<table cellspacing=1 cellpadding=4 cols=1 width=700 bgcolor=#003300>
	<tr>
		<td class="ylw10" align=right width=200 height=28><b>Pre-Purchase Order</b> -- STEP 1.</td>

		<td class="des" align=center width=500 height=28> P / O # <span class=ylw10><b>{$ap.po_num}</b></span>   -- for {if $revise} REVISE {elseif $back_str} EDIT {else}Append{/if}</td>
	</tr>
</table>
<table border=1 cellpadding=4 cellspacing=0 cols=1 width=700 id='tbl_msg' {if $msg_YES} style="display : block" {else}style="display : none"{/if}>
	<tr bgcolor=#ffffff> 
		<td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
		<td class=bgdy><div id='msg1'>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</div></td>
	</tr>
</table>
<hr SIZE=2 WIDTH=690>
<input type=hidden name="PHP_special" value="{$ap.special}">
<input type=hidden id="PHP_rev" name="PHP_rev" value="{$revise}">
<table border=1 cellspacing=0 cellpadding=0 width="700" bgcolor=#FFFFFF>
	<tr>
		<td>
			<table border=0 cellspacing=1 cellpadding=3 width="700" bgcolor=#FFFFFF>
				<tr>
					<td class=snvy width=140 align=right><b>Supplier :</b> </td>
					<td class=frnt width=140 align=left bgcolor=#E7E6E6><b>&nbsp;{$ap.s_name}</b></td>
					<td class=snvy width=70 align=right><b>Dept :</b> </td>			
					<td class=frnt width=70 align=left bgcolor=#E7E6E6><b>&nbsp;{$ap.dept}</b></td>
					<td class=snvy align=right nowrap><b>Source area : </b></td>			
					<td class=frnt align=left bgcolor=#E7E6E6><b>&nbsp;{$ap.country}</b></td>
				</tr>
			</table>
		</td>
	</tr>
</table>
<hr SIZE=2 WIDTH=690>

<table border="1" cellspacing=0 cellpadding=2 width=700 id="mat_table">	
	<tr bgcolor="#003333" height=28>
		<td width="70" class=back align="center"><b>Order#</b></td>
		<!-- <td width="60" class=back align="center"><small>BOM Q'ty</small></td> -->
		<td width="50" class=back align="center"><small>Purchase</small></td>
		<td width="120" class=back align="center"><b>Material #</b></td>		
		<td width="100" class=back align="center"><b>Color/Cat.</b></td>
		<!-- <td width="60" class=back align="center"><b>Size</b></td> -->
		<td width="120" class=back align="center"><b>PO Q'ty</b></td>
		<td width="30"  class=back align="center"><b>DEL</b></td>
	</tr>
	{section name=SEC loop=$ap_det2} 
	<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
		<td  align="left" nowrap><small>&nbsp;{$ap_det2[SEC].ord_num}</small></td>
		<!-- <td  align="right" nowrap><small>&nbsp;{$ap_det2[SEC].bom_qty|number_format:"2f"}</small></td> -->
		<td  align="right" nowrap><small>&nbsp;{$ap_det2[SEC].sum_po|number_format:"2f"}</small></td>
		<td  align="left" nowrap><small>&nbsp;{$ap_det2[SEC].mat_code}</small></td>
		<td  align="left"><small>&nbsp;{$ap_det2[SEC].color}</small></td>
		<!-- <td  align="center"><small>&nbsp;{$ap_det2[SEC].size}</small></td> -->
		<td  align="right">{$ap_det2[SEC].ap_qty|number_format:"2f"}&nbsp;{$ap_det2[SEC].unit}</td>
		<input type=hidden name="PHP_qty_{$ap_det2[SEC].id}" value="{$ap_det2[SEC].ap_qty}">
		<input type=hidden name="PHP_eta_{$ap_det2[SEC].id}" value="{$ap_det2[SEC].eta}">
	  <td   align="center" bgcolor=#E7E7E7>				
  	<img src="images/del.png" onClick="del_mat('{$ap_det2[SEC].id_comp}','{$ap_det2[SEC].ap_num}','{$ap_det2[SEC].mat_code}','{$ap_det2[SEC].mat_cat}','{$ap_det2[SEC].color}',this);" style="cursor:pointer">	
		</td>
	</tr>	
	{/section}
</table>

<hr SIZE=2 WIDTH=690>
<table border=0 cellspacing=0 cellpadding=0 cols=2 width=700>
	<tr>
		{if $back_str}	
		<td width=100>
			<input type=button onClick="window.location.href='po.php{$back_str}'" value=" << back " class=select_e style="cursor:pointer; width=99">
		</td>
		{/if}
		<td>
			<input type ='button'  value ="ADD another Item (Same Supplier)" class=select_e2 onClick="search_ord('{$ap.dept}','{$ap.cust}','{$ap_det.0.mat_cat}','{$ap.ap_num}','{$ap.po_num}','{$ap.sup_code}');" style="cursor:pointer; width=99%">
		</td>
		<td width=350>
			<input type=button value="[ Update Above Records ]" class=select_e style="cursor:pointer; width=95%" onClick="add_check('{$ap.id}','{$ap.ap_num}','po.php{$back_str}','{$revise}','{$ap.supl_id}','')"; >
		</td>
	</tr>
</table>
</form>
<!--------- footer ---------->
{include file="footer.html"}