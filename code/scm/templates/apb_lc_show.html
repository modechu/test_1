apb_lc_show.html<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>===::::::::::SCM SYSTEM -- RECEIVING ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script language="javascript" src="./js/open_detial.js"></script>
<Script language="javascript">
function aply_revise(id,rcv_num,back_str,version,ckdate) {
	if ( ckdate == 0 ) {
		alert("APB 已超過關帳日期！ 無法 Revise！");
	}else {
		if ( confirm("are you sure to REVISE Receive:#[ "+rcv_num+" ] ?\r\rEvery Revise event will cancel entire process had done !\rAnd restart the apply procedure from beginning Again !\r\rBe sure this is OK for you!")) {
			location.href="apb.php?PHP_action=apb_lc_revise&PHP_apb_num="+rcv_num+back_str+"&PHP_id="+id+"&PHP_ver="+version;
		}
	}
}

function Show_batch_cost(id)
{
	var url ='index2.php?PHP_action=ord_batch_cost&PHP_bom_num='+id; 	
	var nm = 'Sworking';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=800,height=600 top=50, left=100');
}

function file_del(table,id,rcv_num,file_name,back_str)
{
	if ( confirm("Are you shure to delete this file  ??")) {
		location.href="apb.php?PHP_action=do_file_del&PHP_id="+id+"&PHP_talbe="+table+"&PHP_rcv_num="+rcv_num+"&PHP_file_name="+file_name+back_str;
	} 
}

function show_apb_qty(qty,id,unit,ap_num)
{
	var url ="apb.php?PHP_action=apb_qty_show&PHP_qty="+qty+"&PHP_id="+id+"&PHP_unit="+unit+"&PHP_ap_num="+ap_num;
	var nm = 'rcvd';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=500,height=500 top=50, left=100');
}

function show_rcvd_qty(qty,id,unit,ap_num)
{
	var url ="apb.php?PHP_action=recv_qty_show&PHP_qty="+qty+"&PHP_id="+id+"&PHP_unit="+unit+"&PHP_ap_num="+ap_num;
	var nm = 'rcvd';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=500,height=500 top=50, left=100');
}

function roundAmount(n) {   
	var s = "" + Math.round( n * 100 ) / 100   
	var i = s.indexOf('.')   
	if ( i < 0 ) return s + ".00"
	var t = s.substring( 0 , i + 1 ) +     
	s.substring( i + 1 , i + 3 )   
	if (i + 2 == s.length) t += "0"   
		return t   
}

function chksmt(){
	var ckdate = {/literal}{$submit_ckdate}{literal};
	if ( ckdate == '0' ) $('#smt').attr({disabled:"disabled"});
}

function cal_final_price(){
	$("#final_price").text( Number($("#PHP_inv_price").val()) + Number($("#PHP_adjust").val()) );
}

function adjust_edit(apb_num)
{
	$.ajax({
			url: 'apb.php?PHP_action=adjust_edit',
			type: 'GET',
			data: {
				PHP_apb_num: apb_num,
				PHP_adjust: $("#PHP_adjust").val()
			},
			error: function(xhr) {
				alert('Ajax request 發生錯誤'+xhr);
			},
			success: function(response) {
				$('#adjust_div').css('display','none');
				$('#add_img').css('display','');
				$('#adjust_span').css('display','');
				$('#adjust_span').text($('#PHP_adjust').val());
				cal_final_price();
			}
		});
}
</script>
{/literal}
</head>
<body topmargin="10" bgcolor="#003C77" onload="chksmt();cal_final_price();">
<br>
<table cellspacing=1 cellpadding=4 id="tblShow">
	<tr>
		<td>
<table cellspacing=1 cellpadding=4 cols=1 width=900 bgcolor=#003300>
	<tr>
		<td class="des" align=center width=150>{if $apb.status ==7}<b>Waiting for submit</b>{/if}{if $apb.status ==8}<b>Submitted</b>{/if}</td>
		<td class="des" align=center width=300><span class=sign_b>驗收付款單&nbsp;</span> # <span class=ylw10><b>{$apb.rcv_num}</b></span>  Record </td>
		<td class="des" align=center>
		 {if $apb.status == 8 && $edit_flag && $revise_ckdate}
			<a href="javascript:aply_revise('{$apb.id}','{$apb.rcv_num}','{$back_str}','{$apb.version}','{$revise_ckdate}')" value='revise' style='cursor:pointer'>
				<img src='./images/revise21.jpg' border=0 ALT="REVISE">
			</a>
		 {/if}
		</td>
		<td class="ylw10" align=center height=28> {if $apb.version <> 0}<span class=sign_b>Version</span> <b>{$apb.version}</b>{else}&nbsp;{/if} </td>
		<td>
			{if $apb.status == 8}
				<a href="apb.php?PHP_action=apb_lc_print&PHP_rcv_num={$apb.rcv_num}">
					<img src="./images/print9.jpg" border=0 alt="APB : PDF: SAVE/PRINT"></a>
			{/if}
		</td>
	</tr>
</table>

{if $msg_YES}
<table border=1 cellpadding=4 cellspacing=0 cols=1 width=900>
	<tr bgcolor=#ffffff> 
		<td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
		<td class=bgdy>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</td>
	</tr>
</table>
{/if}

{if !$submit_ckdate AND $apb.status == 7}
<table border=1 cellpadding=4 cellspacing=0 cols=1 width=900>
	<tr bgcolor=#ffffff> 
		<td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
		<td class=bgdy>APB 已超過關帳日期！ 無法 Submit！</td>
	</tr>
</table>
{/if}

<hr SIZE=2 WIDTH=900>

<table border=0 cellspacing=1 cellpadding=4 width=900 bgcolor=#FFFFFF>
  <input type="hidden" name="PHP_chkacc_no" value="{$apb.rcv_num}">
  <tr>
    <td class=snvy align=right bgcolor=#E9F7E8><b>驗收單號 :</b></td>
    <td align=left bgcolor="#EEEEEE"  class=b9><b>&nbsp;{$apb.rcv_num}</b></td>
	<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>付款方式 : </b></td>
    <td align=left bgcolor="#EEEEEE" class=b9><b>{$apb.payment}</b></td>
	<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>付款幣別 : </b></td>
    <td align=left bgcolor="#EEEEEE" class=b9><b>{$apb.currency}</b></td>
	<td class=snvy align=right bgcolor=#E9F7E8><b>調整金額 :</b></td>
    <td align=left class=b9>
		<span id="adjust_span">{$apb.adjust_amt}</span>
		<span id="add_img" style="cursor:hand" onClick="adjust_div.style.display='block';this.style.display='none';adjust_span.style.display='none'">
			&nbsp;&nbsp;<img src="images/Add.gif" alt="Edit" border=0 valign="bottom">
		</span>
		<div id="adjust_div" style="display:none;">
			<input type="text" size="6" id="PHP_adjust" class="select" value="{$apb.adjust_amt}">
			<input type=button onClick="adjust_edit('{$apb.rcv_num}')" value="update " class=select_e style="cursor:pointer; width=30%">&nbsp;
		</div>
		
	</td>
  </tr>
  <tr>
    <td class=snvy align=right bgcolor=#E9F7E8 nowrap><b>供應商代號 : </b></td>
    <td align=left bgcolor="#EEEEEE"  class=b9><b>&nbsp;{$apb.sup_no}</b></td>
    <td  align=right nowrap bgcolor=#E9F7E8 class=snvy><b>請購單位 : </b></td>
    <td align=left bgcolor="#EEEEEE"><b>&nbsp;{$apb.dept}
      <input type="hidden" name="PHP_dept" value="{$dept}">
          <input type="hidden" name="PHP_ship" value="{$ship}">
		</b>
	</td>
	<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>請款日期 : </b></td>
    <td align=left bgcolor="#EEEEEE" class=b9 ><b>&nbsp;{$apb.rcv_date}</b></td>
	<td class=snvy align=right bgcolor=#E9F7E8><b>營業稅 : </b></td>
    <td align=left bgcolor="#EEEEEE">&nbsp;{if $apb.vat != '0.00'}{$apb.vat}{/if}</td>
  </tr>
  <tr>
    <td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>供應商名稱 : </b></td>
    <td align=left bgcolor="#EEEEEE"  class=b9><b>&nbsp;{$apb.s_name}</b></td>
    <td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>統一發票 : </b></td>
    <td align=left bgcolor="#EEEEEE"  class=b9><b>&nbsp;{$apb.inv_num}</b></td>
    <td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>發票日期 : </b></td>
    <td align=left bgcolor="#EEEEEE"><b>&nbsp;{if $apb.inv_date != '0000-00-00'}{$apb.inv_date}{/if}</b></td>
	<td class=snvy align=right bgcolor=#E9F7E8><b>折讓 : </b></td>
    <td align=left bgcolor="#EEEEEE">&nbsp;{if $apb.discount != '0.00'}{$apb.discount}{/if}</td>
  </tr>
  <tr>
    <td class=snvy align=right bgcolor=#E9F7E8><b>供應商統編 : </b></td>
	<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$apb.uni_no}</b></td>
	<td class=snvy align=right bgcolor=#E9F7E8><b>INVOICE # : </b></td>
	<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$apb.foreign_inv_num}</b></td>
    <td></td>
	<td></td>
    <td class=snvy align=right bgcolor=#E9F7E8><b>折稅 : </b></td>
    <td align=left bgcolor="#EEEEEE">&nbsp;{if $apb.off_duty != '0.00'}{$apb.off_duty}{/if}</td>
  </tr>
  <tr>
	<td class=snvy  align=right bgcolor=#E9F7E8 colspan=7><b>總合計金額 : </b></td>
    <td align=left bgcolor="#FF0000" class=des >
		<b>&nbsp;{if $apb.inv_price != '0.00'}{$apb.inv_price}{/if}</b>
		<input type="hidden" id="PHP_inv_price" value="{$apb.inv_price}">
	</td>
  </tr>
  <tr>
	<td class=snvy  align=right bgcolor=#E9F7E8 colspan=7><b>調整後金額 : </b></td>
    <td align=left bgcolor="#FF0000" class=des ><b>&nbsp;<span id="final_price"></span></b></td>
  </tr>
</table>
<hr SIZE=2 WIDTH=900>

{section name=CHK_D loop=$apb_det}
	<table width="900" border=0 cellpadding=6 cellspacing=0>
	  <tr>
		<td align=right nowrap  bgcolor=#DBC9F2 class=snvy><b>Ship advice# :</b></td>
		<td align=left nowrap bgcolor=#DBC9F2><b>S{$apb_det[CHK_D].ship_num}&nbsp;</b></td>
		<td align=right nowrap  bgcolor=#DBC9F2 class=snvy><b>&nbsp;</b></td>
		<td align=left nowrap bgcolor=#DBC9F2><b>&nbsp;</b></td>
		<td align=right nowrap bgcolor=#DBC9F2><b></b></td>
		<td align=left nowrap bgcolor=#DBC9F2><b>&nbsp;</b></td>
	  </tr>
	</table>
	<table border="1" cellspacing=0 cellpadding=3 width="900">	
		<tr bgcolor="#584E5C" height=30>
			<td cellpadding=2 class=back align="center" nowrap><b>Invoice #</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>Order #</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>Material #</b></td>	
			<td cellpadding=2 class=back align="center" nowrap><b>Color/cat</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>P / O #</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>%</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>P / O<br>Q'ty</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>Rcv.<br>Q'ty</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>APB.<br>Q'ty</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>FOC</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>原幣單價</b></td>
			<td cellpadding=2 class=back align="center" nowrap><b>{$apb.currency}單價</b></td>
		</tr>

		{section name=DET_D loop=$apb_det[CHK_D].det}
			
			<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
				<td align="left" nowrap>{$apb_det[CHK_D].det[DET_D].inv_num}&nbsp;</td>
				<td align="center" nowrap>
				{section name=AP loop=$apb_det[CHK_D].det[DET_D].order}
					<a href="javascript:po_bom_view('{$apb_det[CHK_D].det[DET_D].order[AP]}','{$apb.po_num}')" style='cursor:pointer'>{$apb_det[CHK_D].det[DET_D].order[AP]}</a>&nbsp;<br>
				{/section}
				</td>
				<td align="center" nowrap>
					<a href="javascript:{if $apb_det[CHK_D].det[DET_D].mat_code|substr:0:1 == 'F'}Show_fab{else}Show_acc{/if}('{$apb_det[CHK_D].det[DET_D].mat_code}')" value='ord_out' style='cursor:pointer'>{$apb_det[CHK_D].det[DET_D].mat_code}</a>
				</td>
				<td align="left" nowrap>{$apb_det[CHK_D].det[DET_D].color}&nbsp;</td>
				<td align="center" nowrap>
					<a href="javascript:po_show('{$apb_det[CHK_D].det[DET_D].ap_num}','')" style='cursor:pointer'>{$apb_det[CHK_D].det[DET_D].po_num}</a>&nbsp;
				</td>
				<td align="center" nowrap>{if $apb_det[CHK_D].det[DET_D].toler == '0|0'}0{else} +{$apb_det[CHK_D].det[DET_D].toleri}%{if $apb_det[CHK_D].det[DET_D].tolern != '0'}~ -{$apb_det[CHK_D].det[DET_D].tolern} % {/if}{/if}</td>
				<td cellpadding=2 align="right" nowrap>{$apb_det[CHK_D].det[DET_D].po.po_qty|number_format:"2f"} {$apb_det[CHK_D].det[DET_D].po.po_unit}</td>
				<td cellpadding=2 align="right" nowrap>{$apb_det[CHK_D].det[DET_D].rcv_qty|number_format:"2f"} {$apb_det[CHK_D].det[DET_D].po.po_unit}</td>
				<td align="right" nowrap>
					<a href="javascript:show_apb_qty('','{$apb_det[CHK_D].det[DET_D].po_id}','','{$apb_det[CHK_D].det[DET_D].po.ap_num}')" value='order' style='cursor:pointer'>
						{$apb_det[CHK_D].det[DET_D].qty|number_format:"2f"}
					</a>
				</td>	
				<td cellpadding=2 align="right" nowrap>{$apb_det[CHK_D].det[DET_D].foc}</td>
				<td align="right" nowrap>{$apb_det[CHK_D].det[DET_D].uprices}</td>
				<td align="right" nowrap>{$apb_det[CHK_D].det[DET_D].uprice}</td>			
			</tr>
		{/section}
	</table>
<br>
{/section}
<br>

{if $ap_oth_cost or $apb_oth_cost}
<table border=1 cellspacing=0 cellpadding=0 width=750 align=center>
	<tr bgcolor=#A49587 height=25>
		<td colspan=5 align=center class=nvy9><b>Other cost</b></td>
	</tr>
	<tr bgcolor=#54473B height=25>
		<td width=150 class=w10 align=center>P/O #</td>
		<td width=400 class=w10 align=center>History records</td>
		<td width=150 class=w10 align=center>Cost</td>
	</tr>
	{section name=SEC loop=$ap_oth_cost}
		<tr bgcolor=#E2D9D1 >
			<td class=gry9 align=center>{$ap_oth_cost[SEC].ap_num}</td>
			<td class=gry9 align=left>{$ap_oth_cost[SEC].item}</td>
			<td class=gry9 align=left>{$ap_oth_cost[SEC].cost}</td>
		</tr>
	{/section}
	{section name=SEC loop=$apb_oth_cost}
		<tr bgcolor=#E2D9D1 >
			<td class=gry9 align=center>{$apb_oth_cost[SEC].ap_num}</td>
			<td class=gry9 align=left>{$apb_oth_cost[SEC].item}</td>
			<td class=gry9 align=left>{$apb_oth_cost[SEC].cost}</td>
		</tr>
	{/section}
</table>
{/if}

<hr SIZE=2 WIDTH=900>

<table width=900 border=1 cellspacing=1 cellpadding=1>
	<tr bgcolor=#EACEBE height=25>
		<td width=70 align=center><b>Download</b></td>
		<td width=250 align=center><b>File name</b></td>
		<td width=300 align=center><b>Descript</b></td>
	</tr>
	{if $done[0].id}
	{section name=SEC loop=$done}
	<tr>
		<td align=center valign=top>
			<a href="download.php?fname={$done[SEC].file_name}&fdir=apb_file" title="{$done[SEC].file_name}" >
				<img src='./images/file2.gif' border=0 ALT="download pattern">
			</a>
		</td>
		<td class=snvy >{$done[SEC].file_name}</td>
		<td class=snvy>{$done[SEC].file_des}</td>
	</tr>
  {/section}
  {/if}
  <tr>
   	<td colspan=4>
   		<form method=POST name=pattn enctype="multipart/form-data">
  		<input type="hidden" name="PHP_action" value="upload_file">
			<input type="hidden" name="PHP_num" value="{$apb.rcv_num}">
			<input type="hidden" name="PHP_back_str" value="{$back_str}">
			<input type="hidden" name="max_size" value="100000">
			<input type="hidden" name="PHP_id" value="{$apb.id}">&nbsp;
			<input type='file' name='PHP_pttn' size=20 class=select>&nbsp;&nbsp;
			Descript : &nbsp;
			<input type='text' name='PHP_desp' size=40 class=select >&nbsp;&nbsp;
			<input type='submit' value='upload'>
			</form>
		</td>
	</tr>
</table>
<br>

{if $rcv_log}  
<table border=1 cellspacing=0 cellpadding=0 width=900 align=center>
	<tr bgcolor=#bbbbbb height=25>
		<td colspan=5 align=center class=nvy9><b>Remark Records</b></td>
	</tr>
	<tr bgcolor=#666666 height=25>
		<td width=100 class=w10 align=center>Date</td>
		<td width=80 class=w10 align=center>Item</td>
		<td width=300 class=w10 align=center>History records</td>
		<td width=80 class=w10 align=center>by</td>
	</tr>
	{section name=SEC loop=$rcv_log}
	<tr bgcolor=#eeeeee >
		<td class=gry9 align=center><small>{$rcv_log[SEC].k_date}</small></td>
		<td class=gry9 align=left>{$rcv_log[SEC].item}</td>
		<td class=gry9 align=left>{$rcv_log[SEC].des}</td>
		<td class=gry9 align=center>{$rcv_log[SEC].user}</td>
	</tr>
	{/section}
</table>
{/if}


<table border=0 cellspacing=0 cellpadding=2 width=900>
<tr>
<td WIDTH=360 align=right><font size=1 >Submit : </font> </td>
<td WIDTH=120 align=left>{if $apb.rcv_sub_user}<font size=1 ><a href="javascript:message_out('{$apb.rcv_sub_user_id}')" style="cursor:pointer">{$apb.rcv_sub_user}</a> / {$apb.rcv_sub_date}&nbsp;</font>{/if}</td>
<td WIDTH=100 align=right><font size=1 >create</font></td>
<td WIDTH=120 align=left><font size=1 ><a href="javascript:message_out('{$apb.rcv_user_id}')" style="cursor:pointer">{$apb.rcv_user}</a> / {$apb.rcv_date}&nbsp;</font></td>
</tr>
</table>
<br>
{if $add_flag && $apb.status == 0}
<!---------- sample logs form   -->
<table border=1 cellspacing=0 cellpadding=0 width=900 align=center>
<form method=POST name=smpl_logs>
	<tr bgcolor=#bbbbbb height=25>
		<td colspan=2 align=center class=nvy9><b>ADD Remark</b></td>
	</tr>
	<tr bgcolor=#666666 height=25>
		<td width=520 class=w10 align=center>Remark</td>
		<td width=70 class=w10 align=center>&nbsp;</td>
	</tr>
	<tr bgcolor=#eeeeee >
		<td class=gry9 align=left>
		<textarea name="PHP_des" rows=2 cols=120 class=select>{$smpl_log.des}</textarea></td>
		<td class=ylw9 align=center valign=center>
		<input type=submit value="save" class=select_e style="cursor:pointer; width=55; height=35" onClick=this.width=0;></td>
		<input type="hidden" name="PHP_action" value="rcvd_log_add">
		<input type="hidden" name="PHP_back_str" value="{$back_str}">
		<input type="hidden" name="PHP_rcv_num" value="{$apb.rcv_num}">
		<input type="hidden" name="PHP_id" value="{$apb.id}">
	<!--		<input type="hidden" name="PHP_back_str" value="{$back_str2}">    -->
	</tr>
</form>
</table>
<br>
{/if} 
<form method=POST name=smpl_logs>
<table border=0 cellspacing=0 cellpadding=0 cols=2 width=700>
 <tr>       
 {if $back_str}
	{if $ck}
	<td width=100>			
			<input type="button" onClick="window.location.href='{$PHP_SELF}?PHP_action=apb'" value=" << back apb" class=select_e  style="cursor:pointer; width:95%" >
	</td>
	{else}
	<td width=100>			
			<input type="button" onClick="window.location.href='{$PHP_SELF}?PHP_action=rcvd_search{$back_str}'" value=" << back " class=select_e  style="cursor:pointer; width:95%" >
	</td>
	{/if}
	{/if}
			  <td align=center width=208>	
				{if $edit_flag && $apb.status == 7}				
				<input type="submit" id="smt" value=" [ Submit ] " class=select_e  style="cursor:pointer; width:95%" >
				<input type="hidden" name="PHP_action" value="apb_lc_submit">
				<input type="hidden" name="PHP_id" value="{$apb.id}">
				<input type="hidden" name="PHP_apb_num" value="{$apb.rcv_num}">
				<input type="hidden" name="PHP_ver" value="{$apb.version}">
				<input type="hidden" name="PHP_back_str" value="{$back_str}">
				{/if}				
              </td>
   <td align=center width=208>	
		{if $apb.status == 7 && $edit_flag}				
		<input type="button" onClick="window.location.href='{$PHP_SELF}?PHP_action=apb_lc_edit&PHP_rcv_num={$apb.rcv_num}{$back_str}'" value=" [ EDIT ] " class=select_e  style="cursor:pointer; width:95%" >
		{/if}				
   </td>
	</tr>
</table>
		</td>
	</tr>
</table>
</form>
<!--------- footer ---------->
{include file="footer.html"}