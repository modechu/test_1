<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>===:::::::::: SCM System ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<style type="text/css">@import url(js/calendar/skins/aqua/theme.css);.outline {
	border :1px solid #CCCCCC;
	padding:3px 7px 3px 7px;
	background-color:#FFFFFF;
	color:#000000;
	margin:3px  !important;
	cursor:pointer;
}</style>
<script language="javascript" src="./js/open_detial.js"></script>
<script type="text/javascript"
        src="./js/build/yahoo/yahoo-min.js"></script>
<script type="text/javascript"
        src="./js/build/connection/connection-min.js"></script>
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script type="text/javascript" src="./js/jquery.blockUI.js"></script>
<script type="text/javascript" src="./js/calendar/calendar.js"></script>
<script type="text/javascript" src="./js/calendar/lang/calendar-en.js"></script>
<script type="text/javascript" src="./js/calendar/calendar-setup.js"></script>
<Script language="javascript">
	var transaction;
  var sUrl;	
/*	
function aply_revise(aply_num,bakc_str,special,id,rev) {

	if ( confirm("are you sure to REVISE P/O :#[ "+aply_num+" ] ?\r\rEvery Revise event will cancel entire process had done !\rAnd restart the apply procedure from beginning Again !\r\rBe sure this is OK for you!")) {
		// cgiget="{/literal} {$cgistr_get}{literal}&cgino={/literal}{$start_no}{literal}&cgi_1={/literal}{$cgi.dept}{literal}&cgi_2={/literal}{$cgi.order_num}{literal}&cgi_3={/literal}{$cgi.cust}{literal}&cgi_4={/literal}{$cgi.ref}{literal}&cgi_5={/literal}{$cgi.factory}{literal}";
		location.href="po.php?PHP_action=po_revise&PHP_aply_num="+aply_num+"&PHP_back="+bakc_str+"&PHP_revise=1&PHP_id="+id+"&PHP_rev_time="+rev;
	} 
}
*/
function aply_revise(aply_num,bakc_str,special,id,rev,po_num) {
	var loc;

	loc='apply_revise';
	if ( confirm("are you sure to REVISE P/O :#[ "+po_num+" ] ?\r\rEvery Revise event will cancel entire process had done !\rAnd restart the apply procedure from beginning Again !\r\rBe sure this is OK for you!")) {
		// cgiget="{/literal} {$cgistr_get}{literal}&cgino={/literal}{$start_no}{literal}&cgi_1={/literal}{$cgi.dept}{literal}&cgi_2={/literal}{$cgi.order_num}{literal}&cgi_3={/literal}{$cgi.cust}{literal}&cgi_4={/literal}{$cgi.ref}{literal}&cgi_5={/literal}{$cgi.factory}{literal}";
		location.href="po.php?PHP_action="+loc+"&PHP_aply_num="+aply_num+"&PHP_back="+bakc_str+"&PHP_revise=1&PHP_id="+id+"&PHP_rev_time="+rev;
	} 
}

function del_po(ap_num,back_str,po_num) {
	var loc;

	loc='apply_revise';
	if ( confirm("are you sure to DELETE P/O :#[ "+po_num+" ] ?")) {
		window.location="po.php?PHP_action=do_apply_del&PHP_ap_num="+ap_num+"&PHP_back="+back_str;
	} 
}


function del_po_apv(ap_num,back_str,po_num) {
	var loc;

	loc='apply_revise';
	if ( confirm("Deleting "+po_num+"  must write Exceptional report. \r\r Are you sure to DELETE P/O :#[ "+po_num+" ] ?")) {
		window.location="po.php?PHP_action=do_po_apv_del&PHP_status=12&PHP_ap_num="+ap_num+"&PHP_back="+back_str;
	} 
}

function cfm_ajx(id,r){
	  var i=r.parentNode.parentNode.rowIndex;
	  document.getElementById('mater_table').deleteRow(i);	  

 	  sUrl = "po.php?PHP_action=log_del_ajx&PHP_id="+id;
    transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, delback, null);
 

}

  var delback = {
    success: function(o) {
    
        	document.getElementById("tbl_msg").style.display='block';    
    	var response = o.responseText.split("|");
    	var divrep=response[0];
    	msg1.innerText  = divrep;

    },
    failure: function(o) {
      alert("Error：Can't get data");
    }
  }; 
  
  
function check(obj){
var obj;
var max=127;
obj.value=obj.value.substring(0,max);
}  

function special_chk(spec){
	if(spec == 1)alert('採購單將併異常報告一起列印')
}
function tblresize() {
	var dh = 110;
	var dw = 60;
	var hh = tblShow.offsetHeight + dh;
	if ( hh > screen.height - dh )
		hh = screen.height - dh ;
  if (tblShow.offsetWidth) window.resizeTo( tblShow.offsetWidth + dw , hh );
		self.focus();
}

$(document).ready(function() {
	rate = function (po_num){
		$.ajax({
			url: 'apb.php?PHP_action=check_rate',
			type: 'GET',
			data: {
				PHP_rcv_date: $("#date").val(),
				PHP_cury: $("#PHP_currency"+po_num).val()
			},
			error: function(xhr) {
				alert('Ajax request 發生錯誤'+xhr);
			},
			success: function(response) {
				if ( response != 0 ) {
					$("#rate"+po_num).text(response);
					$("input[id^=PHP_uprice"+po_num+"]").each(function(i,elm) {
						if( $(elm).val() != null ){
							str = $(elm).attr("id").split("PHP_uprice");
							divi = $("#PHP_uprice"+str[1]).val() / $("#PHP_ntd_price"+str[1]).val();
							price = $("#PHP_uprices"+str[1]).val() * response ;
							$(elm).val( roundAmount5(price) );
							$("#PHP_ntd_price"+str[1]).val( $(elm).val() / divi );
							$("#price"+str[1]).val(  $("#PHP_ntd_price"+str[1]).val() * $("#PHP_qty"+str[1]).val() );
						}
					});
				} else {
					alert('沒有此匯率！');
				}
				rcv(po_num);
				invoice();
			}
		});
	};
    
    select_checkbox = function(status){
        if ( status == 'Select' ) {
            $("input[id^=PHP_checkbox]").each(function(i, elm) {
                $(elm).attr("checked",true);
            });
			invoice();
        } else {
            $("input[id^=PHP_checkbox]").each(function(i, elm) {
                $(elm).attr("checked",false);
            });
			$("input[id^=ap_oth_cost]").each(function(i,elm) {
				$(elm).attr("checked",false);
			});
            invoice();
        }
    }
});

function roundAmount5(n) {   
	var s = "" + Math.round( n * 100000 ) / 100000   
	var i = s.indexOf('.')  
	
	if ( i < 0 ) return s + ".00000"
	var t = s.substring( 0 , i + 1 ) +     
	s.substring( i + 1 , i + 6 )   
	if (i + 5 == s.length) t += "0"   
		return t   
}

function rcv(po_num){
	var apb=price= Number(0);
	$("input[id^=PHP_qty" + po_num + "]").each(function(i,elm) {
		str = $(elm).attr("id").split("PHP_qty");
		
		if( Number($("#PHP_apbed_qty"+str[1]).val()) + Number($("#PHP_qty"+str[1]).val()) <= Number($("#PHP_toleri_qty"+str[1]).val()) ){
			$("#price"+str[1]).text( roundAmount($(elm).val() * $("#PHP_uprice"+str[1]).val()));
		}else{
			alert("已付款總數量 " + Number($("#PHP_apbed_qty"+str[1]).val()) + " + 本次請款數量 " + Number($("#PHP_qty"+str[1]).val()) + 
				" => 已超過tolerance數量 " + Number($("#PHP_toleri_qty"+str[1]).val()) + "\n將用 " + (Number($("#PHP_toleri_qty"+str[1]).val()) - Number($("#PHP_apbed_qty"+str[1]).val())) + " 計算");
			$("#PHP_qty"+str[1]).val($("#PHP_toleri_qty"+str[1]).val() - Number($("#PHP_apbed_qty"+str[1]).val()));
			$("#price"+str[1]).text( roundAmount( (Number($("#PHP_toleri_qty"+str[1]).val()) - Number($("#PHP_apbed_qty"+str[1]).val())) * $("#PHP_uprice"+str[1]).val()));
		}
		price += Number($("#price"+str[1]).text());
	});
	
	$("input[id^=ap_oth_cost" + po_num + "]").each(function(i,elm) {
		if($(elm).attr("checked"))
			price += Number($(elm).val())
	});
	
	$("#amount"+po_num).val( roundAmount(price) );
	invoice();
}

function invoice(){
	var price = Number(0);
	$("input[id^=PHP_checkbox]").each(function(i,elm) {
		if( $(elm).attr("checked")){
			price += Number($("#amount" + $(elm).val()).val());
		}
	});
	
	$("input[id^=add_oth_cost]").each(function(i,elm) {
		if( $(elm).val() != '' ){
			price += Number($(elm).val());
		}
	});
	
	if ( $("#inv_num").val() != "" ) {
		$("#vat").val( Math.round(price*.05) );
	}
	
	if($("#PHP_select_currency").val()=="NTD"){
		$("#inv_amt").val( Math.round(price));
		price = price + Number($("#vat").val()) - Number($("#discount").val()) - Number($("#off_duty").val());
		$("#inv_price").val( Math.round(price));
	}else{
		$("#inv_amt").val(roundAmount(price));
		$("#inv_price").val(roundAmount(price));
	}
}

function roundAmount(n) {   
	var s = "" + Math.round( n * 100 ) / 100   
	var i = s.indexOf('.')   
	if ( i < 0 ) return s + ".00"
	var t = s.substring( 0 , i + 1 ) +     
	s.substring( i + 1 , i + 3 )   
	if (i + 2 == s.length) t += "0"   
		return t   
}

function roundAmount2(n) {   
	var s = "" + Math.round( n * 100 ) / 100   
	var i = s.indexOf('.')   
	if ( i < 0 ) return s
	var t = s.substring( 0 , i )
		return t   
}

function mask(msg){
	$.blockUI({ message: '<div><h4>' + msg + '</h4></div>'});
}

function cal_amount(po_num){
	var ttl = Number($("#inv_amt").val());
	if ($("#PHP_checkbox"+po_num).attr("checked")){
		if($("#PHP_select_currency").val()=="NTD")
			$("#inv_amt").val(Math.round( ttl + Number($("#PHP_checkbox"+po_num).val()) ));
		else
			$("#inv_amt").val(roundAmount( ttl + Number($("#PHP_checkbox"+po_num).val()) ));
	}else{
		if($("#PHP_select_currency").val()=="NTD")
			$("#inv_amt").val(Math.round( ttl - Number($("#PHP_checkbox"+po_num).val()) ));
		else
			$("#inv_amt").val(roundAmount( ttl - Number($("#PHP_checkbox"+po_num).val()) ));
	}
	invoice();
}

function change_currency(NTD){

	if(NTD==undefined){
		var currency = $("#PHP_select_currency").val();
	}else{
		$("#PHP_select_currency").val("NTD");
		var currency = "NTD";
	}
	
	$("span[id^=cury]").each(function(i,elm) {
		$(elm).text(currency);
	});
	
	$("select[id^=PHP_currency]").each(function(i,elm) {
		$(elm).val(currency).change();
	});
	invoice();
}

function cal_amt(po_num){
	var currency = $("#PHP_select_currency").val();
	var price = 0;
	$("input[id^=PHP_qty" + po_num + "]").each(function(i,elm) {
		str = $(elm).attr("id").split("PHP_qty");
		$("#PHP_uprice"+str[1]).val( roundAmount5($("#PHP_uprices"+str[1]).val() * $("#PHP_rate"+str[1]).val()) )
		//if(currency=="NTD")
		//	$("#price"+str[1]).text( roundAmount($(elm).val() * $("#PHP_uprice"+str[1]).val()));
		//else
			$("#price"+str[1]).text( roundAmount($(elm).val() * $("#PHP_uprice"+str[1]).val()));
		price += Number($("#price"+str[1]).text())
	});
	
	$("#amount" + po_num).val(price);
	invoice();
}

</script>
{/literal}
</head>
{if $goback}
<body topmargin="10" onLoad="tblresize();" />
{else}
<body onload="invoice()">
{/if}

<form METHOD="POST" name="apply_add" action="{$PHP_SELF}">
<table cellspacing=1 cellpadding=4 cols=1 width=950 bgcolor=#003300>
	<tr><td class="des" align=center height=28><b> 請款單 [ <span class=ylw10>Append&nbsp;</span>Record ]</b></td></tr>
</table>
{$msg_YES}
<table border=1 cellpadding=4 cellspacing=0 cols=1 width=950 id='tbl_msg' {if $msg_YES} style="display : block" {else}style="display : none"{/if}>
	<tr bgcolor=#ffffff> 
		<td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
		<td class=bgdy><div id='msg1'>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</div></td>
	</tr>
</table>

<table border=0 cellspacing=2 cellpadding=2 width=950 bgcolor=#FFFFFF>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
		<td class=snvy align=right bgcolor=#E9F7E8><b>請款單號 :</b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$rcv_num}</b></td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>&nbsp;付款方式 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b><input type="hidden" name="PHP_payment" value="{$dm_way}">{$dm_way}</b></td>
		<td align=right><b>付款幣別</b></td>
		<td align=left>{$currency}</td>
		<td class=snvy align=right bgcolor=#E9F7E8><b>合計金額 : </b></td>
		<td align=left class=des ><input type=text id="inv_amt" size=15 class=select value="" readonly="readonly" style="text-align:right"></td>
	</tr>
  <tr>
		<td class=snvy align=right bgcolor=#E9F7E8 nowrap><b>供應商代號 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$supl.vndr_no}</b>
		  <input type="hidden" name="PHP_sup_no" value="{$supl.vndr_no}"></td>
		<td  align=right nowrap bgcolor=#E9F7E8 class=snvy><b>請款單位 : </b></td>
		<td align=left bgcolor="#EEEEEE">
			<b>&nbsp;{$dept}
				<input type="hidden" name="PHP_dept" value="{$dept}">
				<input type="hidden" name="PHP_ship" value="{$ap.ship}">
			</b>
		</td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>請款日期 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$date}</b></td>
		<td class=snvy align=right bgcolor=#E9F7E8><b>營業稅 : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="vat" name="PHP_vat" size=15 class=select value="{$vat}" style="text-align:right" onkeyup="invoice('');this.value=this.value.replace(/[^\d]/g,'');"></td>
	</tr>
	<tr>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>供應商名稱 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$supl.supl_s_name}</b></td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>統一發票 : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="inv_num" name="PHP_inv_num" size=15 class=select value="{$inv_num}" onchange="change_currency('NTD');"></td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>發票日期 : </b></td>
		<td align=left bgcolor="#EEEEEE">
			<input name="PHP_inv_date" type="text" class="select" style="width:72px;" id="inv_date" value="" readonly="readonly" />
			<input type="hidden" id="date" value="{$date}">
			{literal}
			<script type="text/javascript">Calendar.setup({inputField:"inv_date",button:"f_trigger_c",ifFormat:"%Y-%m-%d"});</script>
			{/literal}
		</td>
		<td class=snvy align=right bgcolor=#E9F7E8><b>折讓 : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="discount" name="PHP_discount" size=15 class=select value="{$discount}" style="text-align:right" onkeyup="invoice('');this.value=this.value.replace(/[^\d]/g,'');"></td>
 </tr>
  <tr>
		<td class=snvy align=right bgcolor=#E9F7E8><b>供應商統編 : </b></td>
		<td align=left bgcolor="#EEEEEE"><b>&nbsp;{$supl.uni_no}</b><input type="hidden" name="PHP_uni_no" value="{$supl.uni_no}">	</td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>INVOICE # : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="foreign_inv_num" name="PHP_foreign_inv_num" size=15 class=select value=""></td>
		<td></td>
		<td></td>
		<td class=snvy align=right bgcolor=#E9F7E8><b>折稅 : </b></td>
		<td align=left bgcolor="#EEEEEE"><input type=text id="off_duty" name="PHP_off_duty" size=15 class=select value="{$off_duty}" style="text-align:right" onkeyup="invoice('');this.value=this.value.replace(/[^\d]/g,'');"></td>
	</tr>
  <tr>
		<td class=snvy align=right bgcolor=#E9F7E8 colspan=7><b>總合計金額 : </b></td>
		<td align=left bgcolor="#FF0000" class=des ><input type=text id="inv_price" name="PHP_inv_price" size=15 class=select value="{$inv_price}" style="text-align:right" readonly="readonly"></td>
  </tr>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
</table>

<input name="radio" type="radio" value="" Onclick="select_checkbox('Select');"/> Select All 
<input name="radio" type="radio" value="" Onclick="select_checkbox('Clear');"/> Clear All
{section name=AP_M loop=$ap}
<table cellspacing=1 cellpadding=4 cols=1 width=950 bgcolor=#003300>
    <tr>
        <td class="ylw10" align=left width=100>
            <input type="checkbox" id="PHP_checkbox{$ap[AP_M].po_num}" name="PHP_checkbox[{$ap[AP_M].po_num}]" value='{$ap[AP_M].po_num}' checked onclick="cal_amount('{$ap[AP_M].po_num}')">
            <input type="text" size=8 class=select id="amount{$ap[AP_M].po_num}" name="PHP_price[{$ap[AP_M].po_num}]" value='{$ap[AP_M].before_price}' onchange="invoice()" readonly>
            <input type="hidden" name="PHP_ap_num[{$ap[AP_M].po_num}]" value="{$ap[AP_M].ap_num}">
			<input type="hidden" name="PHP_po_num[{$ap[AP_M].po_num}]" value="{$ap[AP_M].po_num}">
        </td>
        <td class="frnt" align=left height=28><b><a href="javascript:po_show('{$ap[AP_M].ap_num}','')" style='color:yellow;'>[ {$ap[AP_M].po_num} ]</a></td>
        <td class="ylw10" align=right height=28><b>PO CURRENCY : {$ap[AP_M].currency}</b> <span id="rate{$ap[AP_M].po_num}"></span></td>
    </tr>
</table>
	
	<table border="1" cellspacing=0 cellpadding=2 width=950>	
		<tr bgcolor="#003333" height=28>
			<td width="100" class=back align="center"><b>Order #</b></td>		
			<td width="70" class=back align="center"><b>Name</b></td>
			<td width="100" class=back align="center"><b>Color / Cat.</b></td>
			<td width="40" class=back align="center"><b>Size</b></td>
			<td width="80" class=back align="center"><b>Q'ty</b></td>
			<td width="80" class=back align="center"><b>已付款<br>Q'ty</b></td>
			<td width="80" class=back align="center"><b>請款<br>Q'ty</b></td>
			<td width="90" class=back align="center"><b>Price</b></td>
			<td width="40" class=back align="center"><b>FOC</b></td>
			<td width="60" class=back align="center"><b>原幣單價<br>{$ap[AP_M].currency}</b></td>
			<td width="60" class=back align="center"><b><span id="cury{$ap[AP_M].po_num}">{$ap[AP_M].currency}</span>單價</b></td>
			<td width="40" class=back align="center"><b>匯率</b></td>
			<td width="80" class=back align="center"><b>小計</b></td>
		</tr>
		{section name=SEC loop=$ap[AP_M].ap_det} 
		<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
			<td  align="left">
			{section name=ORD loop=$ap[AP_M].ap_det[SEC].orders}
				<a href="javascript:po_bom_view('{$ap[AP_M].ap_det[SEC].orders[ORD]}','{$ap[AP_M].po_num}')" value='ord_out' style='cursor:pointer'>
				{$ap[AP_M].ap_det[SEC].orders[ORD]}&nbsp;</a><br>
			{/section}
			</td>
			<td  align="left" nowrap>
				<small><a href="javascript:{if $ap[AP_M].ap_det[SEC].mat_cat == 'l'}Show_fab{else}Show_acc{/if}('{$ap[AP_M].ap_det[SEC].mat_code}')" value='ord_out' style='cursor:pointer' title='{$ap[AP_M].ap_det[SEC].mat_code}'>{$ap[AP_M].ap_det[SEC].mat_name}</a></small>
				<input type="hidden" name="PHP_mat_code[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].mat_code}">
			</td>
			<td  align="left">
				<small>{$ap[AP_M].ap_det[SEC].color}&nbsp;</small>
				<input type="hidden" name="PHP_color[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].color}">
			</td>
			<td  align="left">
				<small>{$ap[AP_M].ap_det[SEC].size}&nbsp;</small>
				<input type="hidden" name="PHP_size[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].size}">
			</td>
			<td  align="right">{$ap[AP_M].ap_det[SEC].po_qty|number_format:"2f"}&nbsp;{$ap[AP_M].ap_det[SEC].po_unit}
				<input type="hidden" id="PHP_po_qty{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}" name="PHP_po_qty[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].po_qty}">
			</td>
			<td align="center">
				{$ap[AP_M].ap_det[SEC].apbed_qty}
				<input type="hidden" size=5 id="PHP_apbed_qty{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}" value="{$ap[AP_M].ap_det[SEC].apbed_qty}">
			</td>
			<td>
				<input type="text" size=8 class=select id="PHP_qty{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}" name="PHP_qty[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].apb_qty}" onchange="rcv('{$ap[AP_M].po_num}');">
				<input type="hidden" size=5 id="PHP_toleri_qty{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}" value="{$ap[AP_M].ap_det[SEC].toleri_qty}">
			</td>
			<td  align="right">{$ap[AP_M].fob}&nbsp;{$ap[AP_M].fob_area}<br>{$ap[AP_M].ap_det[SEC].prics|number_format:"5f"}&nbsp;/&nbsp;{$ap[AP_M].ap_det[SEC].prc_unit}</td>
			<td>
				<input type="text" size=5 class=select name="PHP_foc[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="">
			</td>
			<td>
				<input size=5 type="text" id="PHP_uprices{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}" name="PHP_uprices[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].uprice|number_format:'5f'}" readonly>
			</td>	
			<td>
				<input size=5 type="text" id="PHP_uprice{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}" name="PHP_uprice[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].uprice}" readonly>
			</td>
			<td>
				<input type="text" size=5 class=select id="PHP_rate{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}" name="PHP_rate[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].rate}" onchange="cal_amt('{$ap[AP_M].po_num}')" style="text-align:center">
			</td>
			<td  align="right">
				<span id="price{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}">{$ap[AP_M].ap_det[SEC].amount}</span>
			</td>
			<input type="hidden" id="ORI_price{$ap[AP_M].po_num}{$ap[AP_M].ap_det[SEC].i}" value="{$ap[AP_M].ap_det[SEC].ORI_price}">
			<input type="hidden" name="PHP_mat_cat[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].mat_cat}">
			<input type="hidden" name="PHP_mat_id[{$ap[AP_M].po_num}][{$ap[AP_M].ap_det[SEC].i}]" value="{$ap[AP_M].ap_det[SEC].mat_id}">
		</tr>
		{if $ap[AP_M].ap_det[SEC].ship_rmk}
		<tr>
			<td colspan=12 align="left"> <B>Remark : </B>{$ap[AP_M].ap_det[SEC].ship_rmk} &nbsp;</td>
		</tr>
		{/if}
		{/section}
	
		<!--	其他費用	-->
		{section name=COST loop=$ap[AP_M].ap_oth_cost}	
		<tr bgColor='#ffffff'>	
			<td align="left" colspan=4>
					<input type="checkbox" id="ap_oth_cost{$ap[AP_M].po_num}{$ap[AP_M].ap_oth_cost[COST].id}" name="ap_oth_cost[{$ap[AP_M].ap_oth_cost[COST].id}]" onclick="rcv('{$ap[AP_M].po_num}')" value='{$ap[AP_M].ap_oth_cost[COST].cost}'>
					<input type="hidden" name="ap_oth_cost_id[{$ap[AP_M].po_num}][{$ap[AP_M].ap_oth_cost[COST].id}]" value='{$ap[AP_M].ap_oth_cost[COST].id}'>
					&nbsp;&nbsp; {$ap[AP_M].ap_oth_cost[COST].item}			
			</td>	
			<td align="right" colspan=3>{$ap[AP_M].currency}${$ap[AP_M].ap_oth_cost[COST].cost|number_format:"2f"}</td>		
			<td align="right" colspan=6>&nbsp;</td>
		</tr>	
		{/section}
		<tr bgColor='#ffffff'>	
			<td align="left" colspan=4><b>&nbsp;&nbsp;Total</b></td>
			<td align="right"><b>{$ap[AP_M].ttl_qty|number_format:"2f"}</b></td>
			<td align="right" colspan=3><b>{$ap[AP_M].currency}${$ap[AP_M].po_total|number_format:"2f"}</b></td>		
			<td align="center">&nbsp;</td>
			<td align="right" colspan=5>&nbsp;</td>
		</tr>
		<tr bgColor='#ffffff'>	
			<td align="left" colspan=4><b>&nbsp;&nbsp;Deal Amount</b></td>	
			<td align="right" colspan=4><b>{$ap[AP_M].currency}${$ap[AP_M].dear|number_format:"2f"}</b></td>		
			<td align="center">&nbsp;</td>
			<td align="center" colspan=5>&nbsp;</td>
		</tr>
	</table>

	<table border="0" cellspacing=0 cellpadding=2 width=950>	
		<tr height=28>
			<td  align="left" colspan=4><b>&nbsp;Acceptable Tolerance : 
				{if $ap[AP_M].toler == '0|0'}0{else} + {$ap[AP_M].toleri} % {if $ap[AP_M].tolern != '0'}~ - {$ap[AP_M].tolern} % {/if}{/if}</b>
				<input type="hidden" name="PHP_toler[{$ap[AP_M].po_num}]" value="{$ap[AP_M].toler}">
			</td>
		</tr>
	</table>

	<table border=1 cellspacing=0 cellpadding=0 width=950 align=center>
		<tr bgcolor=#bbbbbb height=25>
			<td colspan=2 align=center class=nvy9><b>ADD Other Cost</b></td>
		</tr>
		<tr bgcolor=#666666 height=25>
			<td width=500 class=w10 align=center>Remark</td>
			<td width=100 class=w10 align=center>Cost</td>
		</tr>
		<tr bgcolor=#eeeeee >
			<td class=gry9 align=left>
				<input type="text" size="150" name="PHP_des[{$ap[AP_M].po_num}]" class=select>
			</td>
                    <td class=ylw9 align=center>
                        <input type="text" id="add_oth_cost{$ap[AP_M].po_num}" name="PHP_cost[{$ap[AP_M].po_num}]" class=select onkeyup="this.value=this.value.replace(/[^\d\.]/g,'');invoice()">
                    </td>
                </tr>
            </table>
            <p>
            <hr SIZE=2 WIDTH=900>
            <p>
        </td>
    </tr>
</table>

{/section}

<table border=0 cellspacing=0 cellpadding=0 cols=2 width=900>
		<tr>
			{if $back_str}
			<td valign=top width=100>
				<input type=button onClick="window.location.href='{$PHP_SELF}?PHP_action=rcvd_add_search{$back_str}'" value=" << back " class=select_e style="cursor:pointer; width=99">
			</td>
			{/if} 
				
			{if $edit_flag}
			<td align=center>
			
				<input type="hidden" name="PHP_action" value="do_po_before_add">
				<input type="hidden" name="PHP_back_str" value="{$back_str}">
				<input type=submit value="[ Append above data ]" class=select_e style="cursor:pointer; width=95%" onclick="return mask('Appending...')">
			</td>
			{/if}		
		</tr>
	</table>
</form>
<!--------- footer ---------->
{include file="footer.html"}