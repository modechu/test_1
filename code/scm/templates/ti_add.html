<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=big5">
   <title>===:::::::::: SCM 樣本輔助系統 [ 製造令 資料 ] ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
<link rel=stylesheet type="text/css" href="./css/jquery.loadmask.css" />
{literal}
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script type="text/javascript" src="./js/mask/jquery.loadmask.js"></script>
<script type="text/javascript" src="./js/jquery.blockUI.js"></script>
<script language="JavaScript"><!--

function cfm(ref,id,wi_id,back_str) {
	if ( confirm("Are you shure to delete the worksheet:[ "+ref+" ]  ??")) {
	location.href="index2.php?PHP_action=do_ti_del&id="+id+"&wi_id="+wi_id+"&item="+ref+back_str;
	} 
 }
 

  function check_word(o)
  {
	
	var maxChr = 120;	
	var nowChr = 0;
	value = o.value;
	nowChr = value.length;
//	o.value=value.replace(/[^\w\-\u4e00-\u9fa5\.\*]/ig,'');
	if (nowChr > maxChr)
	{
		alert("Error!! Input too much words.");
		o.value = value.substr(0,120);
	//	document.getElementById(id).readOnly=true;
	
			
	}
  }

function add_check()
{
	{/literal}
	{section name=REC loop=$sub_ti }
		{section name=DES loop=$sub_ti[REC].txt } 
			var inv = window.document.forms['back'].elements['PHP_detail[{$sub_ti[REC].i}][{$sub_ti[REC].txt[DES].id}]'].value;
			window.document.forms['other_ws'].elements['PHP_detail[{$sub_ti[REC].i}][{$sub_ti[REC].txt[DES].id}]'].value = inv;		
		{/section} 
	{/section} 
	{literal}		
}

function del_group(sub_name, wi_id, wi_num, back_str)
{
		if ( confirm("Are you shure to delete the worksheet:[ "+sub_name+" ]  ??")) {
			location.href="index2.php?PHP_action=do_ti_other_del&sub_name="+sub_name+"&wi_id="+wi_id+"&wi_num="+wi_num+back_str;
		} 

}
(function($){
	$(document).ready(function(){
		update2db = function(desc_id,wi_id,item_index,group_name){
			//$('body').mask('Waiting...');
			
			
			if(eval("$('#PHP_date_exist').attr('value')") == "no")
			{
				//alert("no");
				//開始比對哪一筆是沒資料的group把該筆加入資料庫
				var myPHP_sub_name = document.getElementsByName("PHP_sub_name4js");
				var myPHP_item = new Array(myPHP_sub_name.length);
				var myPHP_detail_id = new Array(myPHP_sub_name.length);
				var PHP_id = new Array(myPHP_sub_name.length);
				
				var PHP_detail = new Array(myPHP_sub_name.length);
				var PHP_item  = new Array(myPHP_sub_name.length);
				var PHP_sub_name = new Array(myPHP_sub_name.length);
				var PHP_new_ti = new Array(myPHP_sub_name.length);
				for(z=0;z < myPHP_sub_name.length;z++)
				{
					myPHP_detail_id[z] =  document.getElementsByName("PHP_detail_id_"+myPHP_sub_name[z].value);
					myPHP_item[z] =  document.getElementsByName("PHP_item_"+myPHP_sub_name[z].value);
					//這邊可以判斷是否為新的Group
					PHP_new_ti[z] = eval("$('#PHP_new_ti_"+myPHP_sub_name[z].value+"').attr('value')");//先比對是否原資料庫沒有=>PHP_new_ti 0代表DB已經存在 1代表DB不存在//證實OK
				}
				for(x=0;x < myPHP_sub_name.length;x++)
				{
					PHP_detail[x] = new Array(myPHP_item[x].length);
					PHP_item[x] = new Array(myPHP_item[x].length);
					PHP_id[x] = new Array(myPHP_item[x].length);
					for(y=0;y<myPHP_item[x].length;y++)
					{
						PHP_detail[x][y] = escape(eval("$('#PHP_detail" + myPHP_detail_id[x][y].value + "').attr('value')"));
						PHP_item[x][y] = escape(eval("$('#PHP_item" + myPHP_detail_id[x][y].value + "').attr('value')"));
						PHP_id[x][y] = myPHP_detail_id[x][y].value;
					}
					PHP_sub_name[x] = myPHP_sub_name[x].value;
				}
				var PHP_new_arr = "fromjs";
				var PHP_wi_id = eval("$('#PHP_wi_id').attr('value')");
				var PHP_new_add = eval("$('#PHP_new_add').attr('value')") ;
				var PHP_action = eval("$('#PHP_action').attr('value')");
				var PHP_back_str = eval("$('#PHP_back_str').attr('value')");
				var PHP_back_str2 = eval("$('#PHP_back_str2').attr('value')");
				var PHP_num = eval("$('#PHP_num').attr('value')");
			}
			else
			{
				eval("$('#PHP_new_add').attr('value','" + 1 + "')");
				
				var PHP_new_ti = eval("$('#PHP_new_ti" + wi_id + item_index +"').attr('value')");
				
				var PHP_sub_name = eval("$('#PHP_sub_name" + wi_id + item_index +"').attr('value')");
				var PHP_detail = eval("$('#PHP_detail" + desc_id + "').attr('value')");
				var PHP_item = eval("$('#PHP_item" + desc_id + "').attr('value')");
				
				var PHP_action = eval("$('#PHP_action').attr('value')");
				var PHP_wi_id = eval("$('#PHP_wi_id').attr('value')");
				var PHP_id = desc_id;
				var PHP_new_add = eval("$('#PHP_new_add').attr('value')") ;
				
				var PHP_back_str = eval("$('#PHP_back_str').attr('value')");
				var PHP_back_str2 = eval("$('#PHP_back_str2').attr('value')");
				var PHP_num = eval("$('#PHP_num').attr('value')");
				var PHP_new_arr = "";
			}
            if ( !confirm( 'Are you sure to update ' + PHP_sub_name + ': #[ ' +  eval("$('#PHP_item" + desc_id + "').attr('value')") + ' ]！' ) ) {
				eval("$('#PHP_new_add').attr('value','')");
				$.blockUI({ message: '<div><h3>取消中...</h3></div>'});
				$.unblockUI();
				//$('body').unmask();
                return false;
            }
			else
			{
				$.blockUI({ message: '<div><h3>儲存中...</h3></div>'});
			}
        
            
            
			var URLs="index2.php";
            
            $.ajax({
                url: URLs,
                data: {
				PHP_action: PHP_action,
				PHP_wi_id: PHP_wi_id,
				PHP_id: PHP_id,
				PHP_new_add: PHP_new_add,
				PHP_sub_name: PHP_sub_name,
				PHP_new_ti: PHP_new_ti,
				PHP_detail: PHP_detail,
				PHP_item: PHP_item,
				PHP_new_arr: PHP_new_arr,
				PHP_back_str: PHP_back_str,
				PHP_back_str2: PHP_back_str2,
				PHP_num: PHP_num
				},
                type:"POST",
                dataType:'text',
                success: function(msg){
                    //alert("Success to update "+PHP_sub_name+"["+PHP_item+"]!!");
					//location.href= msg;
          			<!-- 刪除點選的row-->
                    <!-- ------------ -->
					eval("$('#PHP_new_add').attr('value','')");
                    //$('body').unmask();
					$.unblockUI();
                    
                },
                beforeSend:function(){
                    <!--alert('資料處理中');-->
                },
                complete:function(){
                    
                },
                error:function(xhr, ajaxOptions, thrownError){ 
                    alert(xhr.status); 
                    alert(thrownError); 
                }
            });
		}
	});
})(jQuery);

-->
</script>
{/literal}

</head>

<body>
<br>
<table cellspacing=1 cellpadding=4 cols=2 width=700 bgcolor=#333333>
	<tr><td class="des" align=center height=28 width=480>[ <b><span class=ylw10> EDIT </span> Working Instruction for Order</b> : <b>{$wi.wi_num}</b> ]</td>
	<td class="des" align=center height=28 width=140>Verson :<span class=ylw10><b>{$wi.ti_rev}</span></b></td>
	</tr>
</table>
{if $msg_YES}
     <table border=1 cellpadding=4 cellspacing=0 cols=1 width=700>
      <tr bgcolor=#ffffff> 
        <td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
        <td class=bgdy>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</td>
      </tr>
     </table>
{/if}
<table border=0 cellspacing=0 cellpadding=1 width=700 bgcolor=#FFFFFF>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
    <td class=snvy align=right nowrap>Customer :</td>
    <td class=bgdy align=left><b>&nbsp;{$smpl.cust_iname}</b></td>
    <td class=snvy align=right nowrap>Department :</td>
    <td class=bgdy align=left><b>&nbsp;{$wi.dept}</b></td>
    <td class=snvy align=right nowrap>Order type :</td>
    <td class=bgdy9 align=left><b>&nbsp;{if $wi.smpl_type}{$wi.smpl_type}</b>{else}</b><UN Input>{/if}</td>
    <td class=snvy align=right nowrap><b>ETD :</b></td>
    <td class=bgdy align=left><b>&nbsp;{$wi.etd}</b></td>
  </tr>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
</table>
<table border cellspacing=0 cellpadding=2 width=700 bgcolor=#ffffff align=center>
  <tr bgcolor="#003333" height=28> 
	<td nowrap width=100 align=center class=back><b>Picture</b></td>
	<td nowrap width=100 align=center class=back><b>Order #</b></td>
	<td nowrap width=100 align=center class=back><b>style</b></td>
	<td nowrap width=150 align=center class=back><b>SIZE RANGE</b></td>
	<td nowrap width=200 align=center class=back><b>Q'ty / Unit</b></td>
  </tr>
  <tr bgcolor=#DDDDDD height=28>
	<td class=g10 align=center rowspan=2>&nbsp;
		<a href="{$wi.pic_url}" target=_black><img src="{$wi.pic_url}" name="pic" border=0 width=90></a></td>
	<td class=grn9 align=center><b>&nbsp;{$smpl.order_num}</b></td>
    <td class=grn9 align=center><b>&nbsp;{$smpl.style}</b></td>
    <td class=grn9 align=center><b>&nbsp;{$smpl.size_scale}</b></td>
    <td class=grn9 align=center><b><span class=bgdy9><b>{$total}</b></span>&nbsp;{if $wi.unit}{$wi.unit}{else}<span class=bgdy9><未輸入></span>{/if}</b></td>
  </tr>
  <tr>
	<td colspan=5 >
		<table border cellspacing=0 cellpadding=2 width=470 bgcolor=#ffffff align=center>
			{section name=USE loop=$show_breakdown}
				{$show_breakdown[USE]}
			{/section}
			{if $size_ttl}
			<TR>
				<td class=grn9 align=center bgcolor=#DDDDDD colspan="2"><b>&nbsp;G-TTL</b></td>
			{section name=USE loop=$size_ttl}
				<td class=b9 align=center bgcolor=#DDDDDD>&nbsp;<b><i>{$size_ttl[USE]|NUMBER_FORMAT}</b></td>
			{/section}
			  <td class=b9 align=right bgcolor=#DDDDDD>&nbsp;<b><i>{$g_ttl|NUMBER_FORMAT}</b></td>
			<TR>
			{/if}
		</table>
	</td>
  </tr>
</table>


	

<br>
<!-------------  Tech Instruction range 生產說明 ------------->
{if !$ti_NONE}
 <table width=700 border=1 cellspacing=1 cellpadding=1>
   <tr bgcolor=#EACEBE height=25>	  
	  <td width=90  align=center><b>Item</b></td>
	  <td width=450 colspan=2 align=center><b>Production Description</b></td>
	  <td width=110 align=center><b>Remark</b></td>
   </tr>
	{section name=DES loop=$ti} 
     <tr bgcolor=#eeeeee height=22>
     <form method=POST name=ti_edit>
		<input type="hidden" name="PHP_wi_id" value="{$wi.id}">
		<input type="hidden" name="PHP_wi_num" value="{$wi.wi_num}">
		<input type="hidden" name="PHP_id" value="{$ti[DES].id}">
		<input type="hidden" name="PHP_action" value="do_ti_edit">
		<input type="hidden" name="PHP_back_str" value="{$back_str}">
		<input type="hidden" name="PHP_back_str2" value="{$back_str2}">	  
	  <td class=snvy >{$ti[DES].item}&nbsp;</td>
	  <td class=snvy colspan=2><textarea name="PHP_detail" rows=2 cols=90 class=select onkeyUp=check_word(this)>{$ti[DES].detail}</textarea>&nbsp;</td>
	  <td class=snvy align=center>&nbsp;{if $edit_flag}
	    <input type=submit value="SAVE" class=select_e style="width:50;cursor:pointer">
			<a href="javascript:cfm('{$ti[DES].item}','{$ti[DES].id}','{$ti[DES].wi_id}','{$back_str2}')" value="刪除" style="cursor:pointer"><img src="images/del.gif" alt="刪除" border=0 valign=bottom></a>
			{/if}
		</td>
	 </tr>
	 </form>
	{/section} 
 </table>
{/if}	 
	 
<!--新版 -->	 
<form method=POST name=back>

<table width=700 border=1 cellspacing=1 cellpadding=1>
  <tr bgcolor=#EACEBE height=22>	  
	  <td width=100 class=b9 align=center><b>Item</b></td>
	  <td width=570 class=b9 align=center>Production Description</td>
	  <td width=30  class=b9 align=center>&nbsp;</td>
  </tr>	
{section name=REC loop=$sub_ti }
  <tr height=25>
	  <td colspan=2 class=snvy align=center ><B>{$sub_ti[REC].name}&nbsp;</B></td>
	  <input type="hidden" name="PHP_group_exist" value="{$sub_ti[REC].db_exist}">
  	<td class=snvy align=center>&nbsp;
  	{if $sub_ti[REC].name <> 'main'}	
  		<a href="javascript:del_group('{$sub_ti[REC].name}','{$wi.id}','{$wi.wi_num}','{$back_str2}')" value="刪除" style="cursor:pointer"><img src="images/del.gif" alt="刪除" border=0 valign=bottom></a>
  	{/if}
  	</td>
	  <input type="hidden" name="PHP_sub_name4js" value="{$sub_ti[REC].name}">
	  <input type="hidden" id="PHP_sub_name{$wi.id}{$sub_ti[REC].i}" name="PHP_sub_name[{$sub_ti[REC].i}]" value="{$sub_ti[REC].name}">
	  <input type="hidden" id="PHP_new_ti_{$sub_ti[REC].name}" name="PHP_new_ti[{$sub_ti[REC].i}]" value="{$sub_ti[REC].new_ti}">
	</tr>	
	{section name=DES loop=$sub_ti[REC].txt } 
  <tr bgcolor=#eeeeee>
	  <td class=snvy >{$sub_ti[REC].txt[DES].item}&nbsp;</td>
	  <td class=snvy ><textarea id="PHP_detail{$sub_ti[REC].txt[DES].id}" name="PHP_detail[{$sub_ti[REC].i}][{$sub_ti[REC].txt[DES].id}]" rows=4 cols=115 class=select>{$sub_ti[REC].txt[DES].detail}</textarea></td>
	  <td><input type=button value="update" onclick="update2db('{$sub_ti[REC].txt[DES].id}','{$wi.id}','{$sub_ti[REC].i}','{$sub_ti[REC].name}')" class=select_e style="cursor:pointer; width=99%"></td>	
		<input type="hidden" name="PHP_item4js[{$sub_ti[REC].i}][{$sub_ti[REC].txt[DES].id}]" value="{$sub_ti[REC].txt[DES].item}">
		<input type="hidden" id="PHP_item{$sub_ti[REC].txt[DES].id}" name="PHP_item[{$sub_ti[REC].i}][{$sub_ti[REC].txt[DES].id}]" value="{$sub_ti[REC].txt[DES].item}">
	</tr>
	{/section} 
{/section} 
</table>	

<!--------- wi data end ---------->

<table border=0 cellspacing=0 cellpadding=2 width=700 bgcolor=#ffffff align=center>
  <tr>
	<td width=200>
		<input type=button onClick="window.location.href='{$PHP_SELF}?PHP_action=ti_view&PHP_id={$wi.id}{$back_str2}&PHP_ti=1'" value=" << back to View page " class=select_e style="cursor:pointer; width=99%">
	</td>
  </tr>
  <tr>
    <td colspan=2 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
	<td width=150>
{if $back_str}
		<input type=button onClick="window.location.href='{$PHP_SELF}?PHP_action=ti_search_wi{$back_str}'" value=" << back to list " class=select_e style="cursor:pointer; width=99%">
{else}&nbsp;
{/if}
</td>

	<td >
		{if $sub_ti_new}<!--$ti_NONE && -->
			<input type="hidden" id="PHP_date_exist" name="PHP_date_exist" value="no">
		{else}
			<input type="hidden" id="PHP_date_exist" name="PHP_date_exist" value="yes">
		{/if}
		{section name=DT loop=$detail_id }
			{section name=DTS loop=$detail_id[DT] } 
		<input type="hidden" name="PHP_detail_id_{$sub_ti[DT].name}" value="{$detail_id[DT][DTS]}">
			{/section} 
		{/section}
		{section name=IT loop=$item }
			{section name=ITS loop=$item[IT] } 
		<input type="hidden" name="PHP_item_{$sub_ti[IT].name}" value="{$item[IT][ITS]}">
			{/section} 
		{/section} 
		<input type="hidden" id="PHP_wi_id" name="PHP_wi_id" value="{$wi.id}">
		<input type="hidden" id="PHP_id" name="PHP_id" value="{$ti[DES].id}">
		<input type="hidden" id="PHP_new_add" name="PHP_new_add" value="{$new_ti_non}">		
		<input type="hidden" id="PHP_action" name="PHP_action" value="do_ti_add">
		<input type="hidden" id="PHP_back_str" name="PHP_back_str" value="{$back_str}">
		<input type="hidden" id="PHP_back_str2" name="PHP_back_str2" value="{$back_str2}">	  
		<input type="hidden" id="PHP_num" name="PHP_num" value="{$wi.wi_num}">
		<input type="hidden" name="PHP_new_arr" value="">
			
		<input type=submit value='UPDATE (ALL) ABOVE RECORDS' class=select_e style="cursor:pointer; width=99%">
</td>
</table>
</form>

<br>
<table width=700 border=0 cellspacing=1 cellpadding=1>
 <tr height=22>
   <form method=POST name=other_ws>
{section name=REC loop=$sub_ti }
  <input type="hidden" name="PHP_sub_name[{$sub_ti[REC].i}]" value="{$sub_ti[REC].name}">
  <input type="hidden" name="PHP_new_ti[{$sub_ti[REC].i}]" value="{$sub_ti[REC].new_ti}">
	{section name=DES loop=$sub_ti[REC].txt } 
	<input type="hidden" name="PHP_item[{$sub_ti[REC].i}][{$sub_ti[REC].txt[DES].id}]" value="{$sub_ti[REC].txt[DES].item}">
  <input type="hidden" name="PHP_detail[{$sub_ti[REC].i}][{$sub_ti[REC].txt[DES].id}]" value="{$sub_ti[REC].txt[DES].detail}">
	{/section} 
{/section} 
		<input type="hidden" name="PHP_wi_id" value="{$wi.id}">
		<input type="hidden" name="PHP_style" value="{$smpl.style}">	
		<input type="hidden" name="PHP_wi_num" value="{$wi.wi_num}">
		<input type="hidden" name="PHP_id" value="{$ti[DES].id}">
		<input type="hidden" name="PHP_action" value="do_ti_other_add">
		<input type="hidden" name="PHP_back_str2" value="{$back_str2}">	  

	  	<td class=snvy align=right>
	  		WS GROUP NAME : <input type="txt" name="PHP_other_name" value="" MaxLength=10>	
	  	  <input type=submit value="ADD others Group" class=select_e style="width:30%;cursor:pointer" onclick=add_check()>
			</td>
	 </form>
	</tr>
</table>

<!--------- footer ---------->
{include file="footer.html"}
