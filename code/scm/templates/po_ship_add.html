<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>===:::::::::: SCM SYSTEM ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<script type="text/javascript" src="./js/build/yahoo/yahoo-min.js"></script>
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script type="text/javascript" src="./js/jquery.blockUI.js"></script>
<script type="text/javascript" src="./js/build/connection/connection-min.js"></script>
<script language="javascript" src="./js/col.js"></script>
<script language="javascript" src="./js/open_detial.js"></script>
<Script language="javascript">
  
function search_ord() {
	var url ='po_ship.php?PHP_action=po_search'; 	
	var nm = 'ordsearch';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=950,height=750 top=50, left=100');
}

function writeToAPAdd(ap_num,mat_cat,mat_id,color,size,qty,special){
	var id = '{/literal}{$po_ship.id}';{literal};
	var data_rows = document.getElementById('mat_table').rows.length - 3;	//用來判斷此筆ship是否沒資料
	var supl_inv = document.getElementById('supl_inv').value;
	window.location='po_ship.php?PHP_action=do_ship_add&PHP_id='+id+'&PHP_supl_inv='+supl_inv+'&PHP_ap_num='+ap_num+'&PHP_mat_cat='+mat_cat+'&PHP_mat_id='+mat_id+'&PHP_color='+color+'&PHP_size='+size+"&PHP_qty="+qty+"&PHP_special="+special+"&PHP_data_rows="+data_rows; 	
}

function del_mat(id,r,val,special){
	if ( confirm("Are you sure to delete ??")) {
		var i=r.parentNode.parentNode.rowIndex
		document.getElementById('mat_table').deleteRow(i)
		sUrl="po_ship.php?PHP_action=del_det_ajax&PHP_id="+id+"&PHP_special="+special;
		transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, callback, val);
		document.getElementById('span_qty').innerHTML = document.getElementById('span_qty').innerHTML - val
	}
}

function show_ship_det(po_id,special){
	var url ='po_ship.php?PHP_action=get_ship_det&PHP_po_id='+po_id+'&PHP_special='+special; 	
	var nm = 'ordsearch';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=950,height=500 top=50, left=100');
}

function ship_show(r)
{
		var ship = r.value;
		sUrl="index2.php?PHP_action=get_ship_ajax&PHP_ship="+ship;
		transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, shipback, null);
}

function ex_select(r)
{
	var ship = r.value;
	if(ship == 'Express')
	{
		document.getElementById("excmpy").style.display='block'; 
	}
}

function disabled_append(){
	$.blockUI({ message: '<div><h4>Appending...</h4></div>'});
}

var transaction;
var sUrl;
var callback = {
	success: function(o) {
		document.getElementById("tbl_msg").style.display='block';    
		var response = o.responseText;    	
		msg1.innerText  = response;
	},
	failure: function(o) {
		alert("Error：Can't get data");
	}
};

var shipback = {
	success: function(o) {
		var response = o.responseText.split("|");    	
		window.document.forms['apply_add'].elements['PHP_ship_name'].value = response[0];
		window.document.forms['apply_add'].elements['PHP_ship_attn'].value = response[4];
		window.document.forms['apply_add'].elements['PHP_ship_fax'].value  = response[3];
		window.document.forms['apply_add'].elements['PHP_ship_tel'].value  = response[2];
		window.document.forms['apply_add'].elements['PHP_ship_addr'].value = response[1];
				
	},
	failure: function(o) {
		alert("Error：Can't get data");
	}
};


$(document).ready(function(){
    select_input = function(status){
        if ( status == 'Input' ) {
            var inv = $('#supl_inv').val();
            $("input[id^=INV_]").each(function(i, elm) {
                $(elm).val(inv);
            });
        } else {
            $("input[id^=INV_]").each(function(i, elm) {
                $(elm).val('');
            });
        }
    }
});

function show_rcvd_det(po_id,ap_num)
{
	var url ="receive.php?PHP_action=recv_qty_show&PHP_id="+po_id+"&PHP_ap_num="+ap_num;
	var nm = 'rcvd';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=500,height=500 top=50, left=100');
}

</script>
{/literal}
</head>
<body>
<br>
<form METHOD="POST" name="ship_add" action="{$PHP_SELF}">
<table cellspacing=1 cellpadding=4 cols=1 width=900 bgcolor=#003300>
	<tr>
		<td class="ylw10" align=right width=200 height=28><b>material Shipping Advise</b> </td>
		<td class="des" align=center width=500 height=28> SHIP # <span class=ylw10><b>&nbsp;&nbsp;{if $po_ship.num}{$po_ship.num}{else}{$today}-x{/if}</b></span>  </td>
	</tr>
</table>
<table border=1 cellpadding=4 cellspacing=0 cols=1 width=900 id='tbl_msg' {if $msg_YES} style="display : block" {else}style="display : none"{/if}>
	<tr bgcolor=#ffffff> 
		<td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
		<td class=bgdy><div id='msg1'>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</div></td>
	</tr>
</table>
<hr SIZE=2 WIDTH=900>
<table border=1 cellspacing=0 cellpadding=0 width="900" bgcolor=#FFFFFF>
	<tr>
		<td>
			<table border=0 cellspacing=1 cellpadding=3 width="900" bgcolor=#FFFFFF>
				<tr>
					<td class=snvy align=left colspan=2><b>From :&nbsp; {$org}&nbsp;&nbsp;<input type=text name="PHP_org2" size=12 class=select value="{$po_ship.org}" >&nbsp;&nbsp; TO : &nbsp;{$dist}</b> </td>
					<td class=snvy width=160  align=left><b>Currier # : </b>&nbsp;&nbsp;
						<input type=text name="PHP_carrier" size=9 class=select value="{$po_ship.carrier}" >
					</td>
					<td class=snvy width=160  align=left><b>Ship inv# : </b>&nbsp
						<input type=text name="PHP_ship_inv" size=9 class=select value="{$po_ship.num}" >
					</td>
				</tr>
				<tr>	
					<td class=snvy width=150 align=left>
						<b>SHIP BY : </b>&nbsp;&nbsp; <b>&nbsp;{$ship_way}</b>
					</td>				
					<td class=snvy width=160  align=left><b>SHIP Date : </b>&nbsp;&nbsp;
						 <img align='top' onmousedown="javascript:Cal(document.ship_add.PHP_ship_date,1,100,50,999,0,'')" src='images/cal.gif' width="16" height="16"  align='top' style='cursor:hand'>
						<input type=text name="PHP_ship_date" size=7 class=select value="{if $po_ship.ship_date <> '0000-00-00'}{$po_ship.ship_date}{/if}" readonly >
					</td>		
					<td class=snvy width=160  align=left><b>ETA : </b>
						 <img align='top' onmousedown="javascript:Cal(document.ship_add.PHP_ship_eta,1,100,50,999,0,'')" src='images/cal.gif' width="16" height="16"  align='top' style='cursor:hand'>
						<input type=text name="PHP_ship_eta" size=7 class=select value="{if $po_ship.ship_eta <> '0000-00-00'}{$po_ship.ship_eta}{/if}" readonly >
					</td>
					<td class=snvy width=160  align=left>
						<input type=checkbox name="PHP_tw_rcv" value="1" {if $po_ship.tw_rcv} checked {/if}>
						<b>Taiwan Receiving </b>
					</td>
				</tr>
				<tr>
					<td class=snvy align=left colspan=3>
						<DIV id=excmpy style="display:none;">
							<b>Express Company  :</b>&nbsp;&nbsp;&nbsp; {$ex_cmpy}
						</DIV>	
					</td>						
				</tr>		
			</table>
		</td>
  </tr>
</table>
<hr SIZE=2 WIDTH=900>
<table border="1" cellspacing=0 cellpadding=2 width=900 id="mat_table">
	<tr>
        <td colspan=12>
            <b>Supl. invoice : </b>
            <input type="text" size=15 class=select id="supl_inv" value="{$tmp_inv}">
            <input name="radio" type="radio" value="" Onclick="select_input('Input');"/> Input All 
            <input name="radio" type="radio" value="" Onclick="select_input('Clear');"/> Clear All
        </td>
	</tr>
	<tr bgcolor="#003333" height=28>
		<td width="80" class=back align="center"><b>Invoice #</b></td>		
		<td width="90" class=back  align="center"><b>Mat. Name</b></td>
		<td width="100" class=back align="center"><b>Color</b></td>
		<td width="70" class=back align="center"><b>Order</b></td>
		<td width="70" class=back align="center"><b>P / O</b></td>
		<td width="60" class=back align="center"><b>Tolerence</b></td>
		<td width="60" class=back align="center"><b>PO Q'TY</b></td>
		<td width="70" class=back align="center"><b>Shipped Q'TY</b></td>
		<td width="70" class=back align="center"><b>Q'TY</b></td>
		<td width="60" class=back align="center"><b>Balance</b></td>
		<td width="40" class=back align="center"><b>%</b></td>
		<td width="20" class=back align="center">DEL</td>	
	</tr>
	{section name=SEC loop=$ship}
    {if $ship[SEC].ship_qty > $ship[SEC].toleri_qty}
    <tr bgcolor='#FF9291' onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#FF9291'">
    {elseif $ship[SEC].ship_qty < $ship[SEC].tolern_qty}
    <tr bgcolor='#B0AFFF' onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#B0AFFF'">
    {else}
    <tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
    {/if}
        <td align="left"><input type="text" id="INV_{$ship[SEC].id}" name="PHP_inv_num[{$ship[SEC].id}]" size=8 class=select value="{$ship[SEC].inv_num}" {if $ship[SEC].rcv_rmk <> 0} readonly {/if}>&nbsp;</td>
        <td align="left"><small>{$ship[SEC].mat_name}</small>&nbsp;</td>
        <td align="left"><small>{$ship[SEC].color}</small>&nbsp;</td>
        <td align="center" nowrap><small>
        {if $ship[SEC].special == 0}			
            {section name=ORD loop=$ship[SEC].ord_num}
                {if $smarty.section.ORD.index <> 0}<br>{/if}
                {$ship[SEC].ord_num[ORD]}
                <input type=hidden name="PHP_ord[{$ship[SEC].id}][{$ship[SEC].k[ORD]}]" value="{$ship[SEC].ord_num[ORD]}">
                <input type=hidden name="PHP_mat_cat[{$ship[SEC].id}][{$ship[SEC].k[ORD]}]" value="{$ship[SEC].mat_cat}">
                
            {/section}</small>
        {else}
            {$ship[SEC].ord_num.0}<br>
            <input type=hidden name="PHP_ord[{$ship[SEC].id}][0]" value="{$ship[SEC].ord_num}">
            <input type=hidden name="PHP_mat_cat[{$ship[SEC].id}][0]" value="{$ship[SEC].mat_cat}">	
        {/if}
        </td>
        <td align="center"><small><a href="javascript:po_show('{$ship[SEC].ap_num}','')" style='cursor:pointer'>{$ship[SEC].po_num}</a></small></td>
        <td align="right"><small>{if $ship[SEC].toler == '0|0'}0{else} + {$ship[SEC].toleri} % {if $ship[SEC].tolern != '0'}~ - {$ship[SEC].tolern} % {/if}{/if}&nbsp;</small></td>
        <td align="right"><small>{$ship[SEC].po_qty|number_format:"2f"}&nbsp;{$ship[SEC].po_unit}</small></td>
        <td align="right"><small>
            <a href="javascript:show_ship_det('{$ship[SEC].po_id}',{$ship[SEC].special})">{$ship[SEC].ship_qty|number_format:"2f"}&nbsp;</a></small>
        </td>
        <td align="right"><input type=text name="PHP_qty[{$ship[SEC].id}]" size=5 class=select value="{$ship[SEC].qty}" {if $ship[SEC].rcv_rmk == 1 || $ship[SEC].apb_rmk == 1 }readonly{/if}>&nbsp;{$ship[SEC].po_unit}</td>
        <td align="right"><small><B>{$ship[SEC].balance}</B>&nbsp;</small></td>
        <td align="right"><small>{$ship[SEC].percentage}%</small></td>
        <td align="center" bgcolor=#E7E7E7>				
            {if $ship[SEC].rcv_rmk == 1 }
                <a href="javascript:show_rcvd_det('{$ship[SEC].po_id}','{$ship[SEC].ap_num}')" style='cursor:pointer'>Rcvd.</a>
            {elseif $ship[SEC].apb_qty > 0 }
                <a href="javascript:show_apb_det('{$ship[SEC].po_id}','{$ship[SEC].ap_num}')" style='cursor:pointer'>APB.</a>
            {else}
                <input type='image' src="images/del.png"  onClick="del_mat('{$ship[SEC].id}',this,'{$ship[SEC].qty}','{$ship[SEC].special}');">	
            {/if}
            <input type=hidden name="PHP_ap_num[{$ship[SEC].id}]" value="{$ship[SEC].ap_num}">
            <input type=hidden name="PHP_ap_id[{$ship[SEC].id}]" value="{$ship[SEC].ap_id}">
            <input type=hidden name="PHP_special[{$ship[SEC].id}]" value="{$ship[SEC].special}">
            <input type=hidden name="PHP_mat_cat[{$ship[SEC].id}]" value="{$ship[SEC].mat_cat}">
            <input type=hidden name="PHP_mat_id[{$ship[SEC].id}]" value="{$ship[SEC].mat_id}">
            <input type=hidden name="PHP_color[{$ship[SEC].id}]" value="{$ship[SEC].color}">
            <input type=hidden name="PHP_size[{$ship[SEC].id}]" value="{$ship[SEC].size}">
        </td>
    </tr>	
	{/section}
	<tr>
		<td align="left" colspan="7"><B>Total</B></td>
		<td align="left">&nbsp;</td>
		<td align="right"><b>&nbsp;<span id="span_qty">{$ttl_qty}</span></b></td>
		<td align="left" colspan="3">&nbsp;</td>
	</tr>
</table>
<table width=900>
	<tr>
		<td align="left">※紅色底代表超過最大Tolerance數量  ※藍色底代表小於最小Tolerance數量  ※白色底代表符合Tolerance範圍</td>
	</tr>
</table>
<hr SIZE=2 WIDTH=900>
<table border=0 cellspacing=0 cellpadding=0 cols=2 width=900>
	<tr>
		<td>
					<input type ='button'  value ="ADD P / O Item" class=select_e2 onClick="search_ord();" style="cursor:pointer; width=95%">
		</td>
		<td width=450>
			<input type=submit value="[ Submit above records -- re-check invoice# ]" class=select_e style="cursor:pointer; width=99%" onClick="return disabled_append()">
		</td>
	</tr>
</table>
<input type=hidden name="PHP_id" value="{$po_ship.id}">
<input type=hidden name="PHP_ver" value="{$po_ship.ver}">
<input type=hidden name="PHP_num" value="{$po_ship.num}">
<input type=hidden name="PHP_back_str" value="{$back_str}">
<input type=hidden name="PHP_action" value="ship_submit">
</form>
<!--------- footer ---------->
{include file="footer.html"}