<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=big5">
   <title>===:::::::::: SCM System [ Working Instruction for Order ] ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">

</head>
{literal}
<!--<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js" ></script>  -->
<script language="javascript" src="./js/jquery.min.js"></script>
<script language="javascript" src="./js/open_detial.js"></script>
<script type="text/javascript">
             $(document).ready(function () {
                 //??速度  
                 var speed = 500;
 
                 //??的相??理事件
                 $("#divPop div").live("mouseover mouseout click", function (event) {
                     if (event.type == "mouseover") {
                         //$(this).addClass(‘highlight’);
                         $(this)[0].style.backgroundColor = '#E6F5FA';
                     }
                     if (event.type == "mouseout") {
                         //$(this).removeClass("highlight");
                         $(this)[0].style.backgroundColor = '#DDFFDD';
                     }
                     if (event.type == "click") {
                         var inID = $("#btnDDL").get(0).getAttribute("inputid");
                         //alert($(this).html());
                         $("#" + inID).val($(this).html());
                     }
                 });
                 //???生下拉??的??，後面 要? array 中?取?生??
                 //$("#divPop").append("<div>test1</div>");
                 //$("#divPop").append("<div>test2</div>");
 
                 //?定事件?理  
                 $("#btnDDL").click(function (event) {
                     //取消事件冒泡  
                     event.stopPropagation();
                     //?置?出?位置  
                     var offset = $(event.target).offset();
                     //alert($(event.target).width());
                     var inID = $(this).get(0).getAttribute("inputid");
                     //依據 input 跟 button 寬度來設定 下拉選單的寬度
                     //$("#divPop")[0].style.width = ($("#" + inID).width() + $(this).width() ) + "px";
                     //??空白?域?藏?出?  
                     $(document).click(function (event) { $("#divPop").hide(speed) });
                     //?定下拉???示的位置
                     $("#divPop").css({ top: offset.top + $(event.target).height() + 10 + "px", left: offset.right });
                     //切??出?的?示??  
                     $("#divPop").toggle(speed);
                 });
				 $("#btnSubmit").click(function (event) {
					 if(Number($("#ord_total_qty").val()) < Number($("#ord_schd_total").val()))
					 {
						//訂單只能大於排產，不能小於排產
						$("#ord_qty_allow")[0].value = 'no';
						alert("訂單總量不可低於此訂單的排產總量\r\n \t無法修改!!");
						
					 }
					 else
					 {
						//執行修改
						$("#ord_qty_allow")[0].value = 'yes';
					 }
                     
                 });
             });
			 
 
         </script>
<script>

function count_qty(ci,cj)
{
	//alert(ci+","+cj);
	//alert(window.document.forms['q'].elements['cst'+ci].value);
	//alert(window.document.q.elements['cst'+ci].value);
   	document.getElementById("tbl_msg").style.display='none';    
	var old_st=window.document.forms['q'].elements['cst'+ci].value;
	var c_qty=window.document.forms['q'].elements['ct'].value;
	//alert(old_st+","+c_qty);
	tmp = 0;
	new_st=0;
	for (j=0; j<cj; j++)
	{
		tmp=window.document.forms['q'].elements['cq'+ci+j].value;
		//alert('cq'+ci+j);
		if (tmp=='') {tmp=0;}
		new_st=parseInt(new_st)+parseInt(tmp);
	}
	var tmp_qty = new_st-old_st;
	c_qty=parseInt(c_qty)+parseInt(tmp_qty);
	
	window.document.forms['q'].elements['ct'].value = c_qty;
	window.document.forms['q'].elements['cst'+ci].value = new_st;
}

function check_qty(ci,cj,wid,num,ord_id)
{
   	document.getElementById("tbl_msg").style.display='none';    
	//now partial qty
	var c_qty=window.document.forms['q'].elements['ct'].value;
	//old partial qty
	var ord_qty=window.document.forms['q'].elements['PHP_ord_qty'].value;

	var qty_item = new Array(cj);
	var wqty_id  = new Array();
	for (i=0; i<cj; i++)
	{
		qty_item[i]=new Array(ci);
		for (j=0; j<ci; j++)
		{
			qty_item[i][j]=window.document.forms['q'].elements['cq'+i+j].value;
		}
		wqty_id[i]=window.document.forms['q'].elements['cid'+i].value;		
	}
	//alert(window.document.forms['q'].elements['PHP_ord_id'].value);
	//alert(ord_id);//訂單id
	//alert(num);//訂單號
	//測試，查看陣列內容
	/*for(i=0; i<cj; i++)
	{
		for (j=0; j<ci; j++)
		{
			alert(qty_item[i][j]);
		}
		alert(wqty_id[i]);
	}*/
	//將目前數字加總
	
	//將最下面的判斷是改寫
	
	//alert(window.document.forms['q'].elements['PHP_ord_schd_total'].value);//排產數量
	//alert(window.document.forms['q'].elements['PHP_ord_total_qty'].value);//此訂單總數量
	var ord_ie = window.document.forms['q'].elements['PHP_ord_ie'].value;//訂單IE
	var ord_schd_total = window.document.forms['q'].elements['PHP_ord_schd_total'].value;
	var old_ord_total = window.document.forms['q'].elements['PHP_ord_total_qty'].value;
	//alert(old_ord_total);
	//alert(ord_qty);
	//alert(c_qty);
	var new_ord_total =(Number(old_ord_total) - Number(ord_qty)) + Number(c_qty);//訂單'新'總數量
	var partial_mks = window.document.forms['q'].elements['PHP_this_partial_mks'].value;//交期
	if (new_ord_total < ord_schd_total )
	{
		//新訂單的總產量不可低於已經排產總數量
		//alert("訂單總數量不可低於\r\n此訂單的排產總數量\r\n無法儲存!!");
		alert("Message: The qty of schedule are exceed partial!!\r\nOrder: ["+num+"]\r\n"+"Schedule Qty:"+ord_schd_total+"\r\n"+"Partial Qty:"+new_ord_total);//The qty in schedule are exceed in partial.
	}
	else
	{
		//直接執行儲存
		if(confirm("Are you sure to revise ["+num+"]??\t\nOrig Qty: "+old_ord_total+"\t\nRevised Qty:"+new_ord_total))
		{
			location.href="wi.php?PHP_action=edit_color_qty&PHP_wqty_id="+wqty_id+"&PHP_qty_item="+qty_item+"&PHP_wi_id="+wid+"&PHP_ord_id="+ord_id+"&PHP_ord_qty="+ord_qty+"&PHP_ord_num="+num+"&PHP_ord_new_qty="+new_ord_total+"&PHP_ord_ie="+ord_ie+"&PHP_partial_mks="+partial_mks+"&PHP_partial_new_total="+c_qty+{/literal}"{$back_str2}"{literal};
			alert("Revised!!");
		}
		else
		{
			alert("Don't Revise!!");
		}
		
		//location.href += "&PHP_ord_new_qty="+new_ord_total+"&PHP_ord_ie="+ord_ie+"&PHP_partial_mks="+partial_mks+"&PHP_partial_new_total="+c_qty;
		//location.href += {/literal}"{$back_str2}"{literal};
	}
	//for(i=0;i<sizeof(qty_item))
	//alert(sizeof(qty_item[]));
	//先將order qty 與partial qty存入資料庫
	//再來比較
	/*if (c_qty == ord_qty && ord_qty > 0)
	{
		alert("order qty = partial sum");
		location.href="wi.php?PHP_action=edit_color_qty&PHP_wqty_id="+wqty_id+"&PHP_qty_item="+qty_item+"&PHP_wi_id="+wid+"&PHP_ord_id="+ord_id+"&PHP_ord_qty="+ord_qty+"&PHP_ord_num="+num+{/literal}"{$back_str2}"{literal};
	}else{
		alert("order qty != partial sum");
    	document.getElementById("tbl_msg").style.display='block';   
    	if (ord_qty <= 0) 
    	{
			msg1.innerText  = 'Qyt Must > 0  !!';
		}else{
			msg1.innerText  = 'Order qty not match. Please check again!!';
		}
	}*/

}
function update_order_qty(url)
{
	//url="wi.php?PHP_action=update_ie_su_cm;
		var nm = 'test';
	 window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=800,height=600 top=50, left=100');
}
</script>
 
{/literal}
<body>
<br>
<form METHOD="POST" name="q">
<input type="hidden" id="ord_schd_total" name="PHP_ord_schd_total" value="{$order_schedule_qty}">
<input type="hidden" id="ord_total_qty" name="PHP_ord_total_qty"  value="{$order_total_qty}">
<input type="hidden" name="PHP_ord_ie" value="{$smpl.ie1}">
<input type="hidden" id="this_partial_mks" name="PHP_this_partial_mks" value="{$partial_mks}">
<table cellspacing=1 cellpadding=4 cols=2 width=700 bgcolor=#333333>
	<tr><td class="des" align=center height=28 width=320>[ <b><span class=ylw10>EDIT Q'TY </span> for Order W / I</b> : <b>{$wi.wi_num}</b>]</td>
	<td class="ylw10" align=center height=28 width=100>{if $wi.status >= 1}<b>[ {literal}SUBMIT{/literal} ]{else}[{literal} UN SUBMIT{/literal} ]{/if}</span></b></td>
	<td class="des" align=center height=28 width=100>Version :<span class=ylw10><b>{$wi.revise}</b></span></td>
	<td class="des" align=center width=140>{if $wi.status == 1 && $edit_non <> 1 && $edit_flag}
			<a href="javascript:cfm_revise('{$wi.wi_num}','{$wi.id}','{$wi.status}','{$back_str}','{$back_str2}')" value='revise' style='cursor:pointer'>
			<img src='./images/revise21.jpg' border=0 ALT="REVISE ORDER"></a>
	   {else}
		&nbsp;
	   {/if}
	  </td>
	</tr>
</table>
{if $msg_YES}
     <table border=1 cellpadding=4 cellspacing=0 cols=1 width=700>
      <tr bgcolor=#ffffff> 
        <td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
        <td class=bgdy>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</td>
      </tr>
     </table>
{/if}

     <table border=1 cellpadding=4 cellspacing=0 cols=1 width=700 id='tbl_msg' style="display : none">
      <tr bgcolor=#ffffff> 
        <td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
        <td class=bgdy><div id='msg1'></div></td>
      </tr>
     </table>
     
<table border=0 cellspacing=0 cellpadding=1 width=700 bgcolor=#FFFFFF>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
    <td class=snvy align=right nowrap>Customer :</td>
    <td class=bgdy align=left><b>&nbsp;{$smpl.cust_iname}</b></td>
    <td class=snvy align=right nowrap>Department :</td>
    <td class=bgdy align=left><b>&nbsp;{$wi.dept}</b></td>
    <td class=snvy align=right nowrap><b>ETD :</b></td>
    <td class=bgdy align=left><b>&nbsp;{$wi.etd}</b></td>
    <td nowrap width=10 align=center class=back>
    {if $wi.status >= 1}
    <a href="index2.php?PHP_action=wi_print&PHP_id={$wi.wi_num}" target="_blank">
			<img src="./images/print9.gif" border=0 alt="PDF: SAVE/PRINT"></a>
			{else}&nbsp;{/if}
	</td>
  </tr>
  </tr>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
</table>
<table border cellspacing=0 cellpadding=3 width=700 bgcolor=#ffffff align=center>
  <tr bgcolor="#003333" height=28> 
	<td nowrap align=center class=back><b>Picture</b></td>
	<td nowrap align=center class=back><b>Order #</b></td>
	<td nowrap align=center class=back><b>style</b></td>
	<td nowrap align=center class=back><b>SIZE RANGE</b></td>
	<td nowrap align=center class=back><b>Q'ty / Unit</b></td>
  </tr>
  <tr bgcolor=#DDDDDD height=28>
	<td class=g10 align=center rowspan=2>&nbsp;
		<input type="image" src="{$wi.pic_url}" name="pic" width=100 border="0" onclick='window.open2("{$wi.pic_url}","","height=640,width=480")'>
	</td>
	<td class=grn9 align=center>
	  <a href="javascript:Show_ord('{$wi.smpl_id}','{$wi.style_code}')" value='ord_out' style='cursor:pointer'>
	<b>&nbsp;{$smpl.order_num}</b></a></td>
    <td class=grn9 align=center><b>&nbsp;{$smpl.style}</b></td>
    <td class=grn9 align=center><b>&nbsp;{$smpl.size_scale}</b></td>
    <td class=grn9 align=center>
		<b>
			<span class=bgdy9>
				<input type=label size=3 name=ct value='{$total}' style="text-align:center;" readonly>
			</span>
			&nbsp;
			{if $wi.unit}{$wi.unit}{else}
				<span class=bgdy9><UnInput></span>
			{/if}
			( Order : <input type='text' name="PHP_ord_qty" size=3 class=select value="{$smpl.qty}" style="text-align:center;" readonly> {$wi.unit} )
			<!--這邊要改成動態-->
			<!--<input type=button value="Edit Order Qty" class=select_e style="cursor:pointer; width=99%" onclick="check_qty();">-->
			
		</b>
		<br/>
	{if $total <> $smpl.qty}
	<input type=button value="[  Update Order Q'TY  ]" class=select_e style="cursor:pointer; width=99%" onclick=update_order_qty("wi.php?PHP_action=update_ie_su_cm")>
		<!--<div style="padding:10 0 0 0">
		<form METHOD="POST" name="update_qty">
			<table border=1 cellpadding=3 cellspacing=1>
			
			<input type="hidden" name="PHP_action" value="Revise_partial_qty">
			<input type="hidden" name="PHP_ord_id" value="{$smpl.id}">
			<input type="hidden" name="PHP_ord_num" value="{$smpl.order_num}">
			<input type="hidden" name="PHP_ord_ie" value="{$smpl.ie1}">
			<input type="hidden" name="back_PHP_id" value="{$back_PHP_id}">
			<input type="hidden" id="this_partial_mks" name="PHP_this_partial_mks" value="{$partial_mks}">
			<input type="hidden" id="this_partial_total" name="PHP_this_partial_total" value="{$total}">
			<input type="hidden" id="ord_total_qty" name="PHP_ord_total_qty"  value="{$order_total_qty}">
			<input type="hidden" id="ord_schd_total" name="PHP_ord_schd_total" value="{$order_schedule_qty}">
			<input type="hidden" id="ord_qty_allow" name="PHP_ord_qty_allow" value="no">
			
			<input type="submit" id="btnSubmit" value="update" class=select style="width:230;height:30;cursor:pointer" >

			</table>
		</form>
		</div>-->
	{/if}
	</td>
  </tr>
  <tr>
	<td colspan=5 >
		<table border cellspacing=0 cellpadding=2 width=470 bgcolor=#ffffff align=center>
			{$show_breakdown}
		</table>
	</td>
  </tr>
</table>

<table border=0 cellspacing=0 cellpadding=2 width=690 bgcolor=#ffffff align=center>

  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
	<tr>
	<td>
		<input type=button value="[  SAVE & RETURN to Submit  ]" class=select_e style="cursor:pointer; width=99%" onclick=check_qty('{$i}','{$j}','{$wi.id}','{$smpl.order_num}','{$smpl.id}')>

	</td>
  </tr>

</table>
</form>
<!-------------  material range ------------->
<br>
    <table width=700 border=0 cellspacing=1 cellpadding=2>
     <tr bgcolor=#333333 height=28>
	  <td width=130 class=ylw9 align=center><b>Fabirc #</b></td>
	  <td width=150 class=ylw9 align=center><b>Fabric Name</b></td>
	  <td width=200 class=ylw9 align=center><b>Placement</b></td>
	  <td width=70 class=ylw9 align=center><b>consump.</b></td>
	  <td width=50 class=ylw9 align=center><b>Unit</b></td>
     </tr>

	{if $lots_NONE}  
	  <tr>
		<td colspan=6 align=center class=ssign><br>NO Fabric data!<br><br>
	  </tr>
	{/if}

	{section name=USE loop=$lots_use} 
     <tr bgcolor=#eeeeee height=28>
	  <td width=90 class=snvy align=center nowrap><a href="javascript:Show_fab('{$lots_use[USE].lots_code}')" value='ord_out' style='cursor:pointer'>{$lots_use[USE].lots_code}&nbsp;</a></td>
	  <td class=snvy >{$lots_use[USE].lots_name}&nbsp;</td>
	  <td class=snvy >{$lots_use[USE].use_for}&nbsp;</td>
	  <td class=snvy align=center>{$lots_use[USE].est_1}&nbsp;</td>
	  <td class=snvy align=center>{$lots_use[USE].unit}&nbsp;</td>
	 </tr>
	{/section} 
	 
    </table>
<!------------------------------------------------>
<!-------------  accessories range ------------->
    <table width=700 border=0 cellspacing=1 cellpadding=2>
     <tr bgcolor=#333333 height=28>
	  <td width=130 class=ylw9 align=center><b>Accessory #</b></td>
	  <td width=150 class=ylw9 align=center><b>ACC. Name</b></td>
	  <td width=200 class=ylw9 align=center><b>Placement</b></td>
	  <td width=70 class=ylw9 align=center><b>consump.</b></td>
	  <td width=50 class=ylw9 align=center><b>Unit</b></td>
     </tr>

	{if $acc_NONE}  
	  <tr>
		<td colspan=6 align=center class=ssign><br>NO Accessory data!<br><br>
		<input type="hidden" name="PHP_acc_est" value="">
	  </tr>
	{/if}

	{section name=USE loop=$acc_use} 
     <tr bgcolor=#eeeeee height=28>
	  <td width=90 class=snvy align=center nowrap><a href="javascript:Show_acc('{$acc_use[USE].acc_code}')" value='ord_out' style='cursor:pointer'>{$acc_use[USE].acc_code}&nbsp;</a></td>
	  <td class=snvy >{$acc_use[USE].acc_name}&nbsp;</td>
	  <td class=snvy >{$acc_use[USE].use_for}&nbsp;</td>
	  <td class=snvy align=center>{$acc_use[USE].est_1}&nbsp;</td>
	  <td class=snvy align=center>{$acc_use[USE].unit}&nbsp;</td>
	 </tr>
	{/section} 
  <tr>
    <td colspan=6 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
 </table>
    <table width=700 border=0 cellspacing=1 cellpadding=2>
      <tr bgcolor=#ffffff height=28>
        <td class=gry9 align=center>
        <font color=black>Open: </font><u>{$wi.creator}</u>&nbsp;&nbsp;<u>{$wi.open_date}</u>&nbsp;&nbsp;&nbsp;&nbsp;
        <font color=black>Last Update : </font><u>{if $wi.updator}{$wi.updator}{else}[ None ]{/if}</u>&nbsp;&nbsp;<u>{$wi.last_update}</u>&nbsp;&nbsp;&nbsp;&nbsp;
        <font color=black>{literal}Submit: {/literal}</font><u>{if $wi.confirmer}{$wi.confirmer}{else}[ None ]{/if}</u>&nbsp;&nbsp;<u>{$wi.cfm_date}</u>
        </td>
      </tr>
    </table>
    <!--------- wi data end ---------->

{include file="footer.html"}
