<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>===:::::::::: SCM System ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<script language="javascript" src="./js/col.js"></script>
<script type="text/javascript" src="./js/build/yahoo/yahoo-min.js"></script>
<script type="text/javascript" src="./js/build/connection/connection-min.js"></script>
<script language="javascript" src="./js/date.js"></script>
<script language="javascript" src="./js/open_detial.js"></script>
<Script language="javascript">

function list(item,cat){
	var gofile ='index2.php?PHP_action=show_supplier_search&PHP_item='+item+'&PHP_cat='+cat;	
	style=window.open2(gofile,'supplier','toolbar=no,location=no,directories=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width="800",height=500, top=100, left=150');
}

function add_sup(item,cat){
	var gofile ='index2.php?PHP_action=show_supplier_add&PHP_item='+item+'&PHP_cat='+cat;	
	style=window.open2(gofile,'supplier','toolbar=no,location=no,directories=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width="800",height=500, top=100, left=150');
}
 
function writeToSupItemlList(vndr_no,supl_s_name,supl_cat,item) {
	var i=0;
	window.document.forms['aply_wi'].elements[item].value = vndr_no;
}

function creat_ap(wi_num,price_name,ven_name,eta_name,qty_name,item,back_str,unit,mat_code,color_name,pa_num,mat_id){
	var vendor = window.document.forms['aply_wi'].elements[ven_name].value;
	var today = GetTodayDate();
	var eta = window.document.forms['aply_wi'].elements[eta_name].value;
	var qty = window.document.forms['aply_wi'].elements[qty_name].value;
	var pa = window.document.forms['aply_wi'].elements['PHP_pa_num'].value;
	var price = window.document.forms['aply_wi'].elements[price_name].value;
	var sup = window.document.forms['aply_wi'].elements['ap_supl'].value;
	var color = window.document.forms['aply_wi'].elements[color_name].value;

	if (sup != vendor && sup != '')
	{
			if ( !confirm("Are you sure to change supplier for this Material")) {
				return;
			} 
	}
/*	
	if (eta < today)
	{
		alert("ETD must > Today");
		return;
	}
*/	 	
	if (vendor =='' && sup == '')
	{
		alert("Please Fill Supplier");
		return;
	} 	
	
	//lc='po.php?PHP_action=apply_special_add&PHP_wi_num='+wi_num+'&PHP_qty='+qty+"&PHP_vendor="+vendor+"&PHP_eta="+eta+"&PHP_item="+item+"&PHP_unit="+unit+"&PHP_mat_code="+mat_code+"&PHP_color="+color+"&PHP_ap_num="+pa_num+"&PHP_mat_id="+mat_id+"&PHP_sup="+sup+"&PHP_price="+price; 
	lc='po.php?PHP_action=apply_special_add&PHP_wi_num='+wi_num+'&PHP_qty='+qty+'&PHP_vendor='+vendor+'&PHP_eta='+eta+'&PHP_item='+item+'&PHP_unit='+unit+'&PHP_mat_code='+mat_code+'&PHP_ap_num='+pa_num+'&PHP_mat_id='+mat_id;
	//alert(lc);
	window.location= lc;
}

function creat_ap_ajx(wi_num,price_name,ven_name,eta_name,qty_name,item,back_str,unit,mat_code,color,pa_num,mat_id){
	var today = GetTodayDate();
	var vendor = window.document.forms['aply_wi'].elements[ven_name].value;
	var eta = window.document.forms['aply_wi'].elements[eta_name].value;
	var qty = window.document.forms['aply_wi'].elements[qty_name].value;
	var pa = window.document.forms['aply_wi'].elements['PHP_pa_num'].value;
	var price = window.document.forms['aply_wi'].elements[price_name].value;
	var sup = window.document.forms['aply_wi'].elements['ap_supl'].value;

	if (sup != vendor && sup != '')
	{
			if ( !confirm("Are you sure to change supplier for this Material")) {
				return;
			} 
	}
	if (eta < today)
	{
		alert("ETD must > Today");
		return;
	} 	
	sUrl='index2.php?PHP_action=apply_special_add_ajax&PHP_wi_num='+wi_num+'&PHP_qty='+qty+"&PHP_vendor="+vendor+"&PHP_eta="+eta+"&PHP_item="+item+"&PHP_unit="+unit+"&PHP_mat_code="+mat_code+"&PHP_color="+color+"&PHP_ap_num="+pa_num+"&PHP_mat_id="+mat_id+"&PHP_sup="+sup+"&PHP_price="+price+"&PHP_revise={/literal}{$revise}{literal}";	
	transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, addback, null);

}

function del_mat(ap_num,ap_id,mat_id,mat_cat,mat_code,r){
	if ( confirm("Are you sure to delete Material : [ "+mat_code+" ]??")) {
		var i=r.parentNode.parentNode.rowIndex
		document.getElementById('mat_table').deleteRow(i)
		sUrl="index2.php?PHP_action=del_ap_det_ajax&PHP_id="+ap_id+"&PHP_ap_num="+ap_num+"&PHP_mat_id="+mat_id+"&PHP_mat_cat=&PHP_mat_code="+mat_code;
		transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, callback, null);
	} 
}

function fab_ex_add(wi_num,item){
		window.location='index2.php?PHP_action=apply_ext_add&PHP_wi_num='+wi_num+'&PHP_item='+item+"&PHP_revise={/literal}{$revise}{literal}"; 	
}
function check_add(ap_num,back_str,revise)
{
	var tab = document.getElementById("mat_table");
	var rows = tab.rows.length ;
	if(rows == 2)
	{
		if ( confirm("NO Purchase Item!! \r\r This Purchase will not be continue !\r\rBe sure this is OK for you!")) {
			window.location="po.php?PHP_action=do_apply_del&PHP_ap_num="+ap_num;
		} 	
	}else{
			window.location="index2.php?PHP_action=do_apply_spc_add1&PHP_ap_num="+ap_num+"&PHP_back_str="+back_str+"&PHP_revise="+revise;

	}
}
</script>
<script>
var transaction;
var sUrl;
var callback = {
	success: function(o) {
		document.getElementById("tbl_msg").style.display='block';    
		var response = o.responseText;    	
		msg1.innerText  = response; 	
	},
	failure: function(o) {
		alert("Error：Can't get data");
	}
};

var addback = {
	success: function(o) {
		document.getElementById("tbl_msg").style.display='block';    
		var response = o.responseText.split("|");   
//		window.document.forms['aply_wi'].elements['PHP_pa_num'].value = response[0];
//		window.document.forms['aply_wi'].elements['PHP_ap_num'].value = response[0];
		msg1.innerText  = response[1]; 
		r=mat_table.insertRow();
		r.insertCell().innerText	= response[2];
		r.insertCell().innerText	= response[3];
		r.insertCell().innerText	= response[4];
		r.insertCell().innerHTML	= "<P align=right>"+response[5]+" "+response[6]+"</P>";
		r.insertCell().innerHTML	= "<P align=right>"+response[7]+"</P>";
		r.insertCell().innerHTML	= "<center>"+response[8]+"</center>";
		r.insertCell().innerHTML	= response[9];
	},
	failure: function(o) {
		alert("Error：Can't get data");
	}
};

function search_ord(dept,cust,cat) {
	var url ='po.php?PHP_action=po_ex_add_search&PHP_dept='+dept+'&PHP_cust='+cust+"&PHP_item="+cat; 	
	var nm = 'ordsearch';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=800,height=700 top=50, left=100');
}
</script>
{/literal}
</head>

<body>
<form method=POST name=aply_wi>
<input type=hidden name='ap_supl'  value='{$ap.sup_code}'>
	
<br>
<table cellspacing=1 cellpadding=4 cols=2 width="800" bgcolor=#2E5E73>
	<tr>
		<td class="des" align=center height=28 ><b>[ STEP 2. --  NEW <span class=ylw10>Extra Purchase</span> ORDER : <span class=ylw10><b>POXX-XXXX</b></span> {if $ap.ap_num} &nbsp;&nbsp; Supplier : <span class=ylw10><b>{$ap.s_name}</b></span>{/if}  ]</b></td>
	</tr>
</table>
<table border=1 cellpadding=4 cellspacing=0 cols=1 width="800" id='tbl_msg' {if $msg_YES} style="display : block" {else}style="display : none"{/if}>
	<tr bgcolor=#ffffff> 
		<td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
		<td class=bgdy><div id='msg1'>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</div></td>
	</tr>
</table>
<table border=0 cellspacing=0 cellpadding=1 width="800" bgcolor=#FFFFFF>
	<tr>
		<td colspan=9 class=frnt align=center><hr size=2 width=98%></td>
	</tr>
	<tr>
		<td class=snvy align=right nowrap>Customer :</td>
		<td class=bgdy align=left><b>&nbsp;{$smpl.cust_iname}</b></td>
		<td class=snvy align=right nowrap>Department :</td>
		<td class=bgdy align=left><b>&nbsp;{$wi.dept}</b></td>
		<td class=snvy align=right nowrap><b>ETD :</b></td>
		<td class=bgdy align=left><b>&nbsp;{$wi.etd}</b></td>
	</tr>
	<tr>
		<td colspan=9 class=frnt align=center><hr size=2 width=98%></td>
	</tr>
</table>
<table border cellspacing=0 cellpadding=3 width="800" bgcolor=#ffffff align=center>
	<tr bgcolor="#003333" height=28> 
		<td nowrap width=100 align=center class=back><b>Picture</b></td>
		<td nowrap width=100 align=center class=back><b>Order #</b></td>
		<td nowrap width=100 align=center class=back><b>style</b></td>
		<td nowrap width=150 align=center class=back><b>SIZE RANGE</b></td>
		<td nowrap width=200 align=center class=back><b>Q'ty / Unit</b></td>
	</tr>
	<tr bgcolor=#DDDDDD height=28>
		<td class=g10 align=center rowspan=2>&nbsp;
			<input type="image" src="{$wi.pic_url}" name="pic" width=100 border="0" onclick='window.open2("{$wi.pic_url}","","height=640,width=480")'>
		</td>
		<td class=grn9 align=center>
		<a href="javascript:Show_ord('{$wi.smpl_id}','{$wi.style_code}')" value='ord_out' style='cursor:pointer'>
		<b>&nbsp;{$smpl.order_num}</b></a></td>
		<td class=grn9 align=center><b>&nbsp;{$smpl.style}</b></td>
		<td class=grn9 align=center><b>&nbsp;{$smpl.size_scale}</b></td>
		<td class=grn9 align=center><b><span class=bgdy9><b>{$total|number_format}</b></span>&nbsp;{if $wi.unit}{$wi.unit}{else}<span class=bgdy9><未輸入></span>{/if}</b></td>
	</tr>
	<tr>
		<td colspan=5 >
			<table border cellspacing=0 cellpadding=2 width=98% bgcolor=#ffffff align=center>
				{$show_breakdown}
			</table>
		</td>
	</tr>
</table>
<br>
<!-------------  請購table ------------->
<table border="1" cellspacing=0 cellpadding=2 width="800" id="mat_table">	
	<tr bgcolor="#003333" height=28>
		<td colspan=8 class=back align="center"><b>NEW Purchase Detial</b></td>
	</tr>
	<tr bgcolor="#003333" height=28>
		<td width="90" class=back align="center"><b>Order#</b></td>
		<td width="180" class=back align="center"><b>Materiel #</b></td>		
		<td width="170" class=back align="center"><b>Color/Cat.</b></td>
		<td width="120"  class=back align="center"><b>Q'ty</b></td>
		<td width="20"  class=back align="center">&nbsp;</td>
	</tr>

	{section name=SEC loop=$ap_det} 
	<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
		<td  align="left" nowrap>{$ap_det[SEC].ord_num}&nbsp;</td>
		<td  align="left" nowrap>{$ap_det[SEC].mat_code}&nbsp;</td>
		<td  align="left">{$ap_det[SEC].color}&nbsp;</td>
		<td  align="right">{$ap_det[SEC].ap_qty|number_format:"2f"}&nbsp;{$ap_det[SEC].unit}</td>
	  <td  align="left" >				
  	<input type='image' src="images/del.png"  onClick="del_mat('{$ap.ap_num}','{$ap_det[SEC].id}','{$ap_det[SEC].bom_id}','{$ap_det[SEC].mat_cat}','{$ap_det[SEC].mat_code}',this);">	
		</td>
	</tr>	
	{/section}
</table>

<!-------------  BOM table ------------->
<!-------------  主料 bom ------------->
<hr size=2 width="800" align=center>

<input type=hidden name="PHP_pa_num" value="{$pa_num}">
<table width="800" border=1 cellspacing=1 cellpadding=1>
	<tr>
		<td>
			<table width="800" border=1 cellspacing=0 cellpadding=1>
				<!------- 主料 bom  Title --------- -->
				{if $mat_cate == 'l'}
				<tr bgcolor=#D5D5BE>
					<td class=b9 align=center><b>Fabirc #</b></td>
					<td class=b9 align=center><b><small>BOM Q'TY</small></b></td>
					<td class=b9 align=center><b><small>Purchased</small></b></td>
					<td class=b9 align=center><b>Color/cat.</b></td>
					<td class=b9 align=center><b>Supplier</b></td>
					<td class=b9 align=center><b>Q'ty</b></td>
					<td class=b9 align=center><b>Select</b></td>
				</tr>
				<!-------  BOM 主料記錄 --------- -->
				{section name=BOM loop=$bom_lots_list} 
				{if $mat_code == $bom_lots_list[BOM].lots_code }
				<tr onmouseover="bgColor='#F9E2BB'" onmouseout="bgColor='#ffffff'">
					<td class=b9 align=left nowrap>&nbsp;<a href="javascript:Show_fab('{$bom_lots_list[BOM].lots_code}')" value='ord_out' style='cursor:pointer'><small>{$bom_lots_list[BOM].lots_code}</small></a></td>
					<td class=b7 align=right><small>{$bom_lots_list[BOM].total|number_format:"2f"}&nbsp;{$bom_lots_list[BOM].unit}</small></td>
					<td class=b9 align=right>{if $bom_lots_list[BOM].po.qty > 0}<small>{$bom_lots_list[BOM].po.qty|number_format:"2f"}&nbsp;{$bom_lots_list[BOM].po.unit}</small>{else}&nbsp;{/if}</td>
					<td class=b9 align=left><small>&nbsp;{$bom_lots_list[BOM].color}</small></td>
					<td class=snvy align=right rowspan=2>&nbsp;
						<input type=text name="PHP_lots_v{$bom_lots_list[BOM].id}" size=12 class=select value="{$bom_lots_list[BOM].vendor1}" readonly>&nbsp;
						<img src="./images/icoSearch.gif" alt="Supplier" onClick="list('PHP_lots_v{$bom_lots_list[BOM].id}','FABRIC');" style="cursor:pointer" >
						<img src="./images/add.gif" alt="Supplier ADD" onClick="add_sup('PHP_lots_v{$bom_lots_list[BOM].id}','FABRIC');" style="cursor:pointer">
					</td>
					<input type=hidden name="PHP_lots_eta{$bom_lots_list[BOM].id}"  value="{$bom_lots_list[BOM].eta}">
					<input type=hidden name="PHP_lots_up{$bom_lots_list[BOM].id}"   value="{$bom_lots_list[BOM].price1}">
					<td class=snvy align=center rowspan=2 valign=top><input type=text name="PHP_lots_qty{$bom_lots_list[BOM].id}" size=4 class=select value="" style=text-align:center>&nbsp;</td>
					<td class=snvy align=center rowspan=2 valign=top>
						<input type=button class=select value="ADD" onclick={if $pa_num == ''}creat_ap{else}creat_ap{/if}('{$wi.wi_num}','PHP_lots_up{$bom_lots_list[BOM].id}','PHP_lots_v{$bom_lots_list[BOM].id}','PHP_lots_eta{$bom_lots_list[BOM].id}','PHP_lots_qty{$bom_lots_list[BOM].id}','lots','{$back_str}','{$bom_lots_list[BOM].unit}','{$bom_lots_list[BOM].lots_code}','PHP_lots_color{$bom_lots_list[BOM].id}','{$pa_num}','{$bom_lots_list[BOM].id}')>&nbsp;				
						<input type=hidden name="PHP_lots_color{$bom_lots_list[BOM].id}" value="{$bom_lots_list[BOM].color}">
					</td>
				</tr>
				<tr onmouseover="bgColor='#F9E2BB'" onmouseout="bgColor='#ffffff'">
					<td colspan=4 class=b7 align=left>&nbsp;{$bom_lots_list[BOM].use_for}</td>
				</tr>
				{/if}
				{/section}
				{/if}
				
				<!------- 副料 bom  Title --------- -->
				{if $mat_cate == 'a'}
				<tr bgcolor=#D5D5BE>
					<td class=b9 align=center><b>Accessory #</b></td>
					<td class=b9 align=center><b><small>BOM Q'TY</small></b></td>
					<td class=b9 align=center><b><small>Purchased</small></b></td>
					<td class=b9 align=center><b>Color/cat.</b></td>
					<td class=b9 align=center><b>Supplier</b></td>
					<td class=b9 align=center><b>Q'ty</b></td>
					<td class=b9 align=center><b>Select</b></td>
				</tr>
				<!-------  end  Title --------- -->

				<!-------  BOM 副料記錄 --------- -->
				{section name=BOM loop=$bom_acc_list} 
				{if $mat_code == $bom_acc_list[BOM].acc_code }
				<tr onmouseover="bgColor='#D4E0F7'" onmouseout="bgColor='#ffffff'">
					<td class=b9 align=left nowrap>&nbsp;<a href="javascript:Show_acc('{$bom_acc_list[BOM].acc_code}')" value='ord_out' style='cursor:pointer'><small>{$bom_acc_list[BOM].acc_code}</small></a></td>
					<td class=b7 align=right><small>{$bom_acc_list[BOM].total|number_format:"2f"}&nbsp;{$bom_acc_list[BOM].unit}</small></td>
					<td class=b9 align=right>{if $bom_acc_list[BOM].po.qty > 0}<small>{$bom_acc_list[BOM].po.qty|number_format:"2f"}&nbsp;{$bom_acc_list[BOM].po.unit}</small>{else}&nbsp;{/if}</td>
					<td class=b9 align=left><small>&nbsp;{$bom_acc_list[BOM].color}</small></td>
					<td class=snvy align=right rowspan=2>&nbsp;
						<input type=text name="PHP_acc_v{$bom_acc_list[BOM].id}" size=12 class=select value="{$bom_acc_list[BOM].vendor1}" readonly>&nbsp;
						<img src="./images/icoSearch.gif" alt="Supplier" onClick="list('PHP_acc_v{$bom_acc_list[BOM].id}','ACCESSORY');" style="cursor:pointer">
						<img src="./images/add.gif" alt="Supplier ADD" onClick="add_sup('PHP_acc_v{$bom_acc_list[BOM].id}','ACCESSORY');" style="cursor:pointer">
					</td>
					<input type=hidden name="PHP_acc_eta{$bom_acc_list[BOM].id}" value="{$bom_acc_list[BOM].eta}" >
					<input type=hidden name="PHP_acc_up{$bom_acc_list[BOM].id}"  value="{$bom_acc_list[BOM].price1}" >
					<td class=snvy align=center rowspan=2 valign=top>
						<input type=text name="PHP_acc_qty{$bom_acc_list[BOM].id}" size=3 class=select value="">&nbsp;
					</td>
					<td class=snvy align=center rowspan=2 valign=top>
						<input type=button class=select value="ADD" onclick={if $pa_num == ''}creat_ap{else}creat_ap{/if}('{$wi.wi_num}','PHP_acc_up{$bom_acc_list[BOM].id}','PHP_acc_v{$bom_acc_list[BOM].id}','PHP_acc_eta{$bom_acc_list[BOM].id}','PHP_acc_qty{$bom_acc_list[BOM].id}','acc','{$back_str}','{$bom_acc_list[BOM].unit}','{$bom_acc_list[BOM].acc_code}','PHP_acc_color{$bom_acc_list[BOM].id}','{$pa_num}','{$bom_acc_list[BOM].id}')>&nbsp;
						<input type=hidden name="PHP_acc_color{$bom_acc_list[BOM].id}" value="{$bom_acc_list[BOM].acc_code}">
					</td>
				</tr>
				<tr onmouseover="bgColor='#D4E0F7'" onmouseout="bgColor='#ffffff'">
				<td class=b7 align=left colspan=4><small>&nbsp;{$bom_acc_list[BOM].use_for}</small></td>
				</tr>
				{/if}
				{/section}
				{/if}
			</table>
		</td>
	</tr>
</table>

<table border=0 cellspacing=0 cellpadding=2 width="800" bgcolor=#ffffff align=center>
	<tr>
		<td colspan=3 class=frnt align=center><hr size=2 width=98%></td>
	</tr>
	<tr>
		{if $back_str && $edit_non <> 1}
		<td>
			<input type=button onClick="window.location.href='index2.php?PHP_action=apply_wi_view&PHP_bk={$back_str}&PHP_id={$wi.id}'" value=" << go back " class=select_e style="cursor:pointer; width=99%">
		</td>
		{else}
		<td>
			<input type ='button'  value ="ADD another Item (Same Supplier)" class=select_e2 onClick="search_ord('{$wi.dept}','{$wi.cust}','{$mat_cate}','{$mat_code}');" style="cursor:pointer; width=99%">
		</td>
		
		<td>
		{if $add_flag || $add_flag}
		{if $apply.status < 1 || $apply.status == 5 }
 		<input type="hidden" name="PHP_action" value="do_apply_spc_add1">
		<input type="hidden" name="PHP_ap_num" value="{$pa_num}">
		<input type="hidden" name="PHP_back_str" value="{$back_str}">
		<input type="hidden" name="PHP_revise" value="{$revise}">
		<input type=button value="[  Update Above Records  ]" class=select_e style="cursor:pointer; width=99%" onclick=check_add('{$ap.ap_num}','{$back_str}','{$revise}')>
		{/if}
		{/if}
		{/if}
		</td>	
	</tr>
</table>
</form>
{include file="footer.html"}