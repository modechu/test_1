<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=big5">
   <title>===:::::::::: SCM 樣本輔助系統 [ 製造令 資料 ] ::::::::::===</title>
   <link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<style>
#Layer1 {
	position:absolute;
	width:421px;
	height:708px;
	left:0px;
	top:0px;
	z-index:1;
}
</style>
<script type="text/javascript"
        src="./js/build/yahoo/yahoo-min.js"></script>
<script type="text/javascript"
        src="./js/build/connection/connection-min.js"></script>
<script language="javascript" src="./js/open_detial.js"></script>      
<script language="javascript" src="./js/jquery.js"></script> 
<script language="JavaScript"><!--
var t_line;
var c_num;
	
var transaction;
  var sUrl;
  var callback = {
    success: function(o) {
    var response = o.responseText.split("|");
    var divrep=response[0];
    	
    document.getElementById("msg_show").style.display='block';
    m_div1.innerText  = divrep; 
//  alert(divrep);

    },
    failure: function(o) {
      alert("Error：Can't get data");
    }
  };
  
  var addback = {
    success: function(o) {
    var response = o.responseText.split("|");
    var divrep=response[0];
    	
    document.getElementById("msg_show").style.display='block';
    m_div1.innerText  = divrep; 

		r=bom_table.insertRow(t_line);
		r.insertCell().innerText	= response[1];
		r.insertCell().innerHTML	= response[2];
		r.insertCell().innerHTML	= response[3];
		r.insertCell().innerHTML	= response[4];
		r.insertCell().innerHTML	= response[5];
		r.insertCell().innerHTML	= response[6];
		var j = 8;
		for (i=0; i<response[7]; i++){
			r.insertCell().innerHTML	= response[j];
			j++;
		}
		for (i=response[7]; i<c_num; i++){
			r.insertCell().innerHTML	= '';
			j++;
		}
		r.insertCell().innerHTML	= response[j];
		alert("here");
    },
    failure: function(o) {
      alert("Error：Can't get data");
    }
  };
  
        
function cfm_del_ajx(bom_id,wi_id,mat_code,mat,r) {
	//alert(bom_id+"\n"+wi_id+"\n"+mat_code+"\n"+mat);
	if ( confirm("aDeleting record will permanent deteleted；Can't reversion anymore !\r\rPlease check again \r\rAre you sure delete this record :["+mat_code+"]??")) {
		eval("$('#Layer1').css('left','" + (event.clientX/3) + "px')");
		eval("$('#Layer1').css('top','" + (event.clientY+document.body.scrollTop) + "px')");
		document.getElementById("layer1").style.display='block';
		var i=r.parentNode.parentNode.rowIndex
		document.getElementById('bom_table').deleteRow(i)
		sUrl="bom.php?PHP_action=do_bom_del_ajx&PHP_bom_id="+bom_id+"&PHP_id="+wi_id+"&mat_code="+mat_code+"&PHP_mat="+mat+"{/literal}{$back_str2}"{literal};
		transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, callback, null);
  	}
	document.getElementById("layer1").style.display='none';
 }

$(document).ready(function(){
	var ord="{/literal}{$wi.wi_num}{literal}";
	
	if ( ord == 'DTH14-0570' || ord == 'DTH14-0542'){
	} else {
		show_color(-1);
	}
	
	mat_id = '';
	size = '';
	row_index = 0;
	num_checkbox = 0;
	des = '';
	now_tdid = $('#color_table tr:eq(0) td:eq(0)').get(0).id;
	pre_tdid = '';
	$('#color_table tr:eq(0) td:eq(0)').children().css('cursor','');//將第一筆ETD變成無作用
	eval("$('#" + now_tdid + "').removeClass('ylw9').toggleClass('trk')");
		
	cfm_add = function (){
		
		eval("$('#Layer1').css('left','" + (event.clientX/3) + "px')");
		eval("$('#Layer1').css('top','" + (event.clientY+document.body.scrollTop) + "px')");
		document.getElementById("layer1").style.display='block';
		//alert("X軸"+event.clientX/3 + "\nY軸" + (event.clientY+document.body.scrollTop));
		//var wi_id = $('#PHP_id').val();
		var mat = this.mat;
		var qty = '';
		var o_qty = '';
		var qty2 = '';
		var ck = '';
		var color = '';
		var T1 = '';
		var T2 = '';
		var T3 = '';
		var tr_content = '';
		
		for (i=0; i<this.num_checkbox; i++){
			// alert("wi_id="+wi_id+" mat_id="+mat_id+" num_colors="+color+" mat="+mat+" size="+size+" des="+des);
			if (mat == "lots"){
				T1 = "window.document.forms.edit.PHP_bom_qty"+this.mat_id+"_"+i+".checked";
				T2 = "window.document.forms.edit.PHP_bom_qty"+this.mat_id+"_"+i+".value";
				T3 = "window.document.forms.edit.PHP_bom_o_qty"+this.mat_id+"_"+i+".value";
			}else{
				T1 = "window.document.forms.acc_edit.PHP_bom_qty"+this.mat_id+"_"+i+".checked";
				//T1 = "$('#PHP_bom_qty"+this.mat_id+"_"+i+"').attr('checked')";
				T2 = "window.document.forms.acc_edit.PHP_bom_qty"+this.mat_id+"_"+i+".value";
				T3 = "window.document.forms.acc_edit.PHP_bom_o_qty"+this.mat_id+"_"+i+".value";
				//當主副料欄位有size時，PHP_bom_qty12345xXL_0會加上size的值
				// alert(T1 + "\n" + T2);
			}
			// alert(T1 + "\n" + T2);
			if (eval(T1)){
				ck = '1';
				
				qty = qty + eval(T2) + ',';
				o_qty = o_qty + eval(T3) + ',';
				//qty[i] = eval(T2);
				
				if(eval(T2) == 0)
				{
					alert("Please choice allocation of this materiel [colorway]!\r\rIf there is no colorway or q'ty data，\rPlease update this data on [W I] first !");
					return;
				}
			} else {
				qty = qty + '0' + ',';
				o_qty = o_qty + '0' + ',';
				//qty[i] = '';
			}
		}
		
		qty=qty.substr(0,qty.length-1);
		o_qty=o_qty.substr(0,o_qty.length-1);
		//alert(o_qty);
		if (ck == ''){
			alert("Please choice allocation of this materiel [colorway]!\r\rIf there is no colorway or q'ty data，\rPlease update this data on [W I] first !");
			document.getElementById("layer1").style.display='none';
			return;
		}
		if (mat == "lots"){
			color = eval("window.document.forms.edit.PHP_lots_color_"+mat_id+".value");
		} else {
			color = eval("window.document.forms.acc_edit.PHP_acc_color_"+mat_id+".value");
		}
	
		$.ajax({
			url: 'bom.php?PHP_action=do_bom_add',
			type: 'GET',
			data: {
				PHP_mat: this.mat,
				PHP_mat_use_id: this.mat_id,
				PHP_color: escape(color),
				PHP_qty: qty,
				PHP_o_qty: o_qty,
				//PHP_size: (this.size).replace("_","."),
				PHP_size: this.size,
				PHP_size_des: this.des,
				PHP_wi_id: {/literal}"{$wi.id}"+"{$back_str2}"{literal}
			},
			error: function(xhr) {
				alert('ajax error');
			},
			success: function(response) {
				var num_cell = document.all.bom_table.rows(0).cells.length;
				var num_colspan = 0;
				
				qty2 = qty.split(",");
			
				tr_content = "$('#bom_table tr:eq("+(row_index-1)+")').after(\"" ; 
					
				if (mat=="lots"){
					tr_content += "<tr onmouseover=bgColor='#FBFBCA' onmouseout=bgColor='#ffffff'>"
								+ "<td style='display:none' class=b9 nowrap align=left><a href=javascript:Show_fab('" + eval("$.trim($('#bom_table tr:eq(" +(row_index-1)+") td:eq(0)').text())") + "')>" + eval("$('#bom_table tr:eq(" +(row_index-1)+") td:eq(0)').text()") + "</a></td>"
								+ "<td class=b9 align=left><a href=javascript:Show_fab('" + eval("$.trim($('#bom_table tr:eq(" +(row_index-1)+") td:eq(0)').text())") + "')>" + eval("$('#bom_table tr:eq(" +(row_index-1)+") td:eq(1)').text()") +"</a></td>";
				}else{
					tr_content += "<tr onmouseover=bgColor='#D4E0F7' onmouseout=bgColor='#ffffff'>"
								+ "<td style='display:none' class=b9 nowrap align=left><a href=javascript:Show_acc('" + eval("$.trim($('#bom_table tr:eq(" +(row_index-1)+") td:eq(0)').text())") + "')>" + eval("$('#bom_table tr:eq(" +(row_index-1)+") td:eq(0)').text()") + "</a></td>"
								+ "<td class=b9 align=left><a href=javascript:Show_acc('" + eval("$.trim($('#bom_table tr:eq(" +(row_index-1)+") td:eq(0)').text())") + "')>" + eval("$('#bom_table tr:eq(" +(row_index-1)+") td:eq(1)').text()") +"</a></td>";
				}
				tr_content += 
					"<td class=b9 align=left>" + eval("$('#bom_table tr:eq(" +(row_index-1)+") td:eq(2)').text()").replace(/\"/ig,'\\\"') + "</td>" +
					"<td class=b9 align=right>" + eval("$('#bom_table tr:eq(" +(row_index-1)+") td:eq(3)').text()") + "</td>" +
					"<td class=b9 align=center>" + color + "</td>" +
					"<td class=b9 align=center>" + eval("$('#bom_table tr:eq(" +(row_index-1)+") td:eq(5)').text()") + "</td>" +
					"<td class=b9 align=center width=0 bgcolor=#666666></td>";
				for (i=0; i<num_checkbox; i++){//判斷td colspan值
					if (num_checkbox == 1){
						for(i=7; i<num_cell-1; i++){
							if (eval("$('#bom_table tr:eq(0) td:eq(" + i + ")').css('display')") != 'none')
								num_colspan++;
						}
						tr_content+="<td class=grn9 colspan=" +num_colspan+" align=center><b>" + qty2[0] + "</b></td>";
					}
					else{
						tr_content+="<td class=grn9 align=center><b>" + qty2[i] + "</b></td>";
					}
				}
				
				tr_content += "<td class=b9 align=center width=1><input type='image' src='images/del.png' onclick=cfm_del_ajx('" + response + "','" + {/literal}"{$wi.id}"{literal} + "','" + eval("$.trim($('#bom_table tr:eq(" +(row_index)+") td:eq(0)').text())") + "','"+mat+"',this)>&nbsp;</td>";
				
				tr_content+="</tr>\")";
				//alert(tr_content);
				//return;
				eval(tr_content);
				
				for (i=7; i<num_cell-1; i++){
					if (eval("$('#bom_table tr:eq(" +(row_index-1)+") td:eq(" + i + ")').css('display')") == 'none')
						eval("$('#bom_table tr:eq(" +row_index+") td:eq(" + i + ")').css('display','none')");
				}
				clear();
			}
		});
	
	};
	
	clear = function(){ //清除checkbox及input
		//$(":text").val('');
		document.getElementById("layer1").style.display='none';
		eval("$(\"#bom_table tr:eq(" + (this.row_index-1) + ") td input[type='checkbox']\").attr('checked',false)");
		//$(":checkbox").attr("checked",false);
	}
	
	get_num= function(r,mat_id,size,num_checkbox,mat,des){
		this.size = size;
		//size == '' ? this.mat_id = mat_id : this.mat_id = mat_id + "x" + (this.size=size);
		size == '' ? this.mat_id = mat_id : this.mat_id = mat_id + "x" + (this.size=size.replace(".","_"));
		this.row_index = r.parentNode.parentNode.parentNode.rowIndex+1;
		this.num_checkbox = num_checkbox;
		this.mat = mat;
		this.des = des;
		cfm_add();
	}
	
	function show_color(tdid2int,etd){
		var tdid = new Array();
		var begin_arr = new Array();
		var num_row = document.all.bom_table.rows.length;
		var color_num_row = document.all.color_table.rows.length;
		var num_cell = document.all.bom_table.rows(0).cells.length;
		var hit = new Array();
		var hit_time = 1;
		var begin_row = 0;
		var end_row = 0;
		var str = '';
		var begin_field = 0;
		var all_num_color = 0;
		var display_style = '';
		var active_colspan = 0;
		var p=n=0;
		var flag=$('#PHP_flag').val();
		hit[0] = 0;
				
		for (i=0 ; i<color_num_row ; i++){//比對color_table的第一行
			str = eval("$('#color_table tr:eq(" + i + ") td:eq(0)').text()");
			if (str.search("ETD")=="1"){
				begin_row = i+1;
				begin_arr[hit_time] = begin_row;
			}
			if (str.search("TOTAL")=="0") {
				end_row = i;
				hit[hit_time] = end_row - begin_row;
				hit_time++;
			}
		}

		for(x=0;x<hit.length;x++){all_num_color+=hit[x];} //計算所有顏色的筆數
		/*
		if(all_num_color==10){
            $('#color_table').css('display','none');
			return;
        }
		*/
		if(tdid2int==-1){ //初始值，只顯示第一筆ETD記錄
			begin_field=hit[1];
			if (hit_time<3) {//只有一筆ETD資料時，直接顯示
				//return;
			} 
			var tmpnum = begin_field;
			
			for(j=2;j<hit_time;j++){//color_table
				for(k=begin_arr[j];k<=(begin_arr[j]+hit[j]);k++){
					eval("$('#color_table tr:eq(" + k + ")').css('display','none')");
				}
			}
			
			while(tmpnum < all_num_color){//bom_table 先隱藏整行
				eval("$('#bom_table td:nth-child("+ (tmpnum+8+1) + ")').css('display','none')");
				tmpnum++;
			}
			
			eval("$('#bom_table td:nth-child(1)').css('display','none')"); //將mat_code整行隱藏(也會隱藏了 qty列)
			//alert(all_num_color);
			for(j=0;j<num_row;j++){
				
				//alert("A:"+document.all.bom_table.rows(j).cells.length );
				//alert("B:"+all_num_color);
				//alert(flag);
				if (document.all.bom_table.rows(j).cells.length == all_num_color)
				{
					//當一般欄位的欄位數與顏色數量的欄位數相同時，執行此區塊
					if(flag=='admin')
					{
						if($('#bom_table tr:eq(' + j + ')').attr('name') == 'color_qty_title')
						{
							eval("$('#bom_table tr:eq(" + j + ") td:eq(0)').css('display','block')");//上面隱藏mat_code時，也把qty列第一筆隱藏了，所以要再顯示
							tmpnum = begin_field;//欄位算法從1開始
							
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (tmpnum) + ")').css('display','none')");
								tmpnum++;
							}
						}
						else
						{
							//colspan
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').attr('colspan','" + begin_field + "')");
						}
					}
					else
					{
						
						if($('#bom_table tr:eq(' + j + ')').attr('name') == 'color_qty_title')
						{
							eval("$('#bom_table tr:eq(" + j + ") td:eq(0)').css('display','block')");//上面隱藏mat_code時，也把qty列第一筆隱藏了，所以要再顯示
							tmpnum = begin_field;//欄位算法從1開始
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (tmpnum) + ")').css('display','none')");
								tmpnum++;
							}
						}
						else
						{
							//colspan
							eval("$('#bom_table tr:eq(" + j + ") td:eq(7)').attr('colspan','" + begin_field + "')");
						}
					}
					
				
				}
				else
				{
					//當一般欄位的欄位數與顏色數量的欄位數不同時，執行此區塊
					if(flag=='admin')
					{
						if(document.all.bom_table.rows(j).cells.length == (8+1+1))
						{
							//colspan
							tmpnum = begin_field;
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').attr('colspan','" + tmpnum + "')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (9) + ")').css('display','block')");
						}
						else
						{
							tmpnum = begin_field;
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (8+tmpnum)+ ")').css('display','none')");
								tmpnum++;
							}
							eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (8+(all_num_color)+1) + ")').css('display','block')");
						}

					}
					else
					{
						//alert("user");
						if(document.all.bom_table.rows(j).cells.length == (7+1+1))
						{
							//colspan部分
							eval("$('#bom_table tr:eq(" + j + ") td:eq(7)').attr('colspan','" + begin_field + "')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').css('display','block')");
						}
						else
						{
							tmpnum = begin_field;
							//alert(tmpnum);
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								//alert(tmpnum)
								eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (7 + Number(tmpnum)) + ")').css('display','none')");
								tmpnum++;
							}
							eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (7 + Number(all_num_color)) + ")').css('display','block')");//秀出最後的編輯圖片
							
						}
					}
					
					
				}
				
			}

		} else if(tdid2int==-99){
			
			var allitem = 0;
			while(allitem < all_num_color){//bom_table 先顯示全部
				if(flag=='admin')
				{
					eval("$('#bom_table td:nth-child("+ (9+allitem+1) + ")').css('display','block')");
				}
				else
				{
					eval("$('#bom_table td:nth-child("+ (8+allitem+1) + ")').css('display','block')");
				}
				allitem++;
			}
			for(j=0;j<num_row;j++){	
				if (document.all.bom_table.rows(j).cells.length == all_num_color){
					//bom的欄位數與顏色相同者，執行此區塊
					if($('#bom_table tr:eq(' + j + ')').attr('name') == 'color_qty_title')
					{
						allitem = 1;
						eval("$('#bom_table tr:eq(" + j + ") td:eq(0)').css('display','block')");
						while(allitem < all_num_color){//隱藏bom_table的colorway
							eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (allitem) + ")').css('display','block')");
							allitem++;
						}
					}
					else {
						
						if(flag=='admin')
						{
							//alert(flag);
							//alert(all_num_color);
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').attr('colspan','" + all_num_color + "')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').css('display','block')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(9)').css('display','block')");
						}
						else
						{
							
							eval("$('#bom_table tr:eq(" + j + ") td:eq(7)').attr('colspan','" + all_num_color + "')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(7)').css('display','block')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').css('display','block')");
						}
					}				
				}
				else
				{
					//alert("test");
					if(flag=='admin')
					{
						//colspan
						//alert("admin");
						//alert(flag);
						//eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').attr('colspan'," + all_num_color + ")");
						if(document.all.bom_table.rows(j).cells.length == (8+1+1))
						{
							//colspan
							//alert(all_num_color);
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').attr('colspan','" + all_num_color + "')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').css('display','block')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(9)').css('display','block')");
						}
						else
						{
							allitem = 1;
							while(allitem <= all_num_color){//隱藏bom_table的colorway
							eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (7+allitem) + ")').css('display','block')");
							//eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (7+allitem) + ")').attr('colspan','1')");
							allitem++;
							}
						}
					}
					else
					{
						if(document.all.bom_table.rows(j).cells.length == (7+1+1))
						{
							//colspan
							//alert(all_num_color);
							
							eval("$('#bom_table tr:eq(" + j + ") td:eq(7)').attr('colspan','" + all_num_color + "')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(7)').css('display','block')");
							eval("$('#bom_table tr:eq(" + j + ") td:eq(8)').css('display','block')");
						}
						else
						{
							
							allitem = 1;
							while(allitem <= all_num_color){//隱藏bom_table的colorway
							eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (6+allitem) + ")').css('display','block')");
							//eval("$('#bom_table tr:eq(" + j + ") td:eq(" + (7+allitem) + ")').attr('colspan','1')");
							allitem++;
							}
						}
						
					}
					
				}
				
			}

			
		} else{
			//alert("test");
			p = pre_tdid.split('_');
			p = parseInt(p[1]);
			n = now_tdid.split('_');
			n = parseInt(n[1]);
			
			for(x=begin_arr[p+1];x<=(begin_arr[p+1]+hit[p+1]);x++){//隱藏上筆color_table記錄
				eval("$('#color_table tr:eq(" + x + ")').css('display','none')");
			}
			for(x=begin_arr[n+1];x<=(begin_arr[n+1]+hit[n+1]);x++){//顯示當筆color_table記錄
				eval("$('#color_table tr:eq(" + x + ")').css('display','block')");
			}
			all_num_color = begin_field = 0;
			for(x=0;x<hit.length;x++){all_num_color+=hit[x];} //計算所有顏色的筆數
			for(x=0;x<Number(tdid2int);x++){begin_field+=hit[x+1];} //計算從第幾欄開始隱藏
						//alert(begin_field);
			tmpnum = 0;
			while(tmpnum < all_num_color){//bom_table隱藏全部
				eval("$('#bom_table td:nth-child("+ (tmpnum+8+1) + ")').css('display','none')");
				tmpnum++;
			}
			
			tmpnum = 0;
			while(tmpnum < hit[Number(tdid2int)+1]){//顯示該筆記錄(一整行顯示))
				eval("$('#bom_table td:nth-child("+ (begin_field+8+1+tmpnum) + ")').css('display','block')");//nth-child的index是從1開始
				tmpnum++;
			}
			for (x=0; x<num_row; x++){
				//重點在於切換時colspan的value,及呈現欄位對不對
			
				//alert("A:"+document.all.bom_table.rows(x).cells.length );
				//alert("B:"+all_num_color);
				//alert(flag);
				if (document.all.bom_table.rows(x).cells.length == all_num_color)
				{
					//當一般欄位的欄位數與顏色數量的欄位數相同時，執行此區塊
					//alert(flag);
					if(flag=='admin')
					{
						if($('#bom_table tr:eq(' + x + ')').attr('name') == 'color_qty_title')
						{
							eval("$('#bom_table tr:eq(" + x + ") td:eq(0)').css('display','block')");//上面隱藏mat_code時，也把qty列第一筆隱藏了，所以要再顯示
							tmpnum = 0;//欄位算法從1開始
							
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (tmpnum) + ")').css('display','block')");
								tmpnum++;
							}
							tmpnum = 0;
							while(tmpnum < begin_field){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (tmpnum) + ")').css('display','none')");
								tmpnum++;
							}
							
							//begin_field//從第幾各顏色開始
							//hit[Number(tdid2int)+1]//該partial有幾個顏色
							
							tmpnum = begin_field+hit[Number(tdid2int)+1];
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (tmpnum) + ")').css('display','none')");
								tmpnum++;
							}
						}
						else
						{
							//colspan
							//alert(hit[Number(tdid2int)+1]);
							eval("$('#bom_table tr:eq(" + x + ") td:eq(8)').attr('colspan','" + hit[Number(tdid2int)+1] + "')");
							eval("$('#bom_table tr:eq(" + x + ") td:eq(8)').css('display','block')");
							eval("$('#bom_table tr:eq(" + x + ") td:eq(9)').css('display','block')");
							/*
							eval("$('#bom_table tr:eq(" + x + ") td:eq(8)').attr('colspan','" + begin_field + "')");
							*/
						}
					}
					else
					{
						//alert(eval("$('#bom_table tr:eq(" + x + ") ').attr('name')"));
						if($('#bom_table tr:eq(' + x + ')').attr('name') == 'color_qty_title')
						{
							//alert(begin_field);
							eval("$('#bom_table tr:eq(" + x + ") td:eq(0)').css('display','block')");//上面隱藏mat_code時，也把qty列第一筆隱藏了，所以要再顯示
							tmpnum = 0;//欄位算法從1開始
							
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (tmpnum) + ")').css('display','block')");
								tmpnum++;
							}
							tmpnum = 0;
							while(tmpnum < begin_field){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (tmpnum) + ")').css('display','none')");
								tmpnum++;
							}
							
							//begin_field//從第幾各顏色開始
							//hit[Number(tdid2int)+1]//該partial有幾個顏色
							
							tmpnum = begin_field+hit[Number(tdid2int)+1];
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (tmpnum) + ")').css('display','none')");
								tmpnum++;
							}
							
						}
						else
						{
							//colspan
							eval("$('#bom_table tr:eq(" + x + ") td:eq(7)').attr('colspan','" + hit[Number(tdid2int)+1] + "')");
							eval("$('#bom_table tr:eq(" + x + ") td:eq(7)').css('display','block')");
							eval("$('#bom_table tr:eq(" + x + ") td:eq(8)').css('display','block')");
						}
					}
					
				
				}
				else
				{
					//當一般欄位的欄位數與顏色數量的欄位數不同時，執行此區塊
					if(flag=='admin')
					{
						if(document.all.bom_table.rows(x).cells.length == (8+1+1))
						{
							//colspan部分
							
							eval("$('#bom_table tr:eq(" + x + ") td:eq(8)').attr('colspan','" + hit[Number(tdid2int)+1] + "')");
							eval("$('#bom_table tr:eq(" + x + ") td:eq(8)').css('display','block')");
							eval("$('#bom_table tr:eq(" + x + ") td:eq(9)').css('display','block')");
						}
						else
						{
						
							tmpnum = 0;
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								if(tmpnum < begin_field || tmpnum >= (begin_field+hit[Number(tdid2int)+1]))
								{
									eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (8+tmpnum) + ")').css('display','none')");
								}
								else
								{
									eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (8+tmpnum) + ")').css('display','block')");
								}
								tmpnum++;
							}
						
							
							
							eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (8 + Number(all_num_color)) + ")').css('display','block')");//秀出最後的編輯圖片
							
						}

					}
					else
					{
						//alert("user");
						if(document.all.bom_table.rows(x).cells.length == (7+1+1))
						{
							//colspan部分
							
							eval("$('#bom_table tr:eq(" + x + ") td:eq(7)').attr('colspan','" + hit[Number(tdid2int)+1] + "')");
							eval("$('#bom_table tr:eq(" + x + ") td:eq(8)').css('display','block')");
						}
						else
						{
						
							tmpnum = 0;
							while(tmpnum < all_num_color){//隱藏bom_table的colorway
								if(tmpnum < begin_field || tmpnum >= (begin_field+hit[Number(tdid2int)+1]))
								{
									eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (7+tmpnum) + ")').css('display','none')");
								}
								else
								{
									eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (7+tmpnum) + ")').css('display','block')");
								}
								tmpnum++;
							}
						
							
							
							eval("$('#bom_table tr:eq(" + x + ") td:eq(" + (7 + Number(all_num_color)) + ")').css('display','block')");//秀出最後的編輯圖片
							
						}
					}
					
					
				}
				
			}
			
		}
	}
	
	$("#table_display").live('click',function(){
		//alert("Handler for .click() called.");
		//alert($("#color_table")[0].style.display);
		
		if($("#color_table")[0].style.display == 'none')
		{
			//判斷為display none此時要重新呈現，並切會為舊模式
			//alert($("#color_table")[0].style.display);
			$("#color_table")[0].style.display="block";
			$('#display_menu tr:eq(0) td:eq(0)').text('隱藏(Hide)') ;
			$('#display_menu tr:eq(0) td:eq(0)').css("style='writing-mode:tb-rl;'");
			//alert(eval("$('#menu_num').attr('value')"));
			show_color(eval("$('#menu_num').attr('value')"));
		}
		else
		{
			//判斷非display none此時要將menu隱藏，並切會為新模式
			$("#color_table")[0].style.display="none";
			$('#display_menu tr:eq(0) td:eq(0)').text('顯示(Show)');
			$('#display_menu tr:eq(0) td:eq(0)').css("style='writing-mode:tb-rl;'");
			//alert("show");
			show_color(-99);
		}
	});
	
	$('td.ylw9').live('mousedown',function(){
		//morial新增
		<!-- var etd = $('.ylw9_' + $(this).attr('id')).val();-->
		<!-- $('#this_etd').val(etd); -->
		
		if (($(this).children().text()).search("ETD")==-1) return;
		var tdid = new Array();
		var tdid2int = '';
		pre_tdid = now_tdid;
		//now_tdid = $(this).parent().get(0).id;
		now_tdid = $(this).attr('id');
		//alert(now_tdid);
		if(pre_tdid==now_tdid) return;//避免隱藏二次

		eval("$('#" + pre_tdid + "').children().css('cursor','pointer')");//上一筆記錄
		eval("$('#" + pre_tdid + "').removeClass('trk').toggleClass('ylw9')");
		eval("$('#" + now_tdid + "').children().css('cursor','')");//當筆記錄
		eval("$('#" + now_tdid + "').removeClass('ylw9').toggleClass('trk')");
		//tdid = ($(this).parent().get(0).id).split('_');
		
		tdid = now_tdid.split('_');
		tdid2int = parseInt(tdid[1]);
		
		eval("$('#menu_num').attr('value','" + Number(tdid2int) + "')");
		
		show_color(tdid2int);
	});
});

function cfm_del(bom_id,wi_id,mat_code,mat) {
	
	if ( confirm("Deleting record will permanent deteleted；Can't reversion anymore !\r\rPlease check again \r\rAre you sure delete this record :["+mat_code+"]??")) {
		location.href="index2.php?PHP_action=do_bom_del&PHP_bom_id="+bom_id+"&PHP_id="+wi_id+"&mat_code="+mat_code+"&PHP_mat="+mat+"{/literal}{$back_str2}"{literal};
	} 
 }

 function file_del(file_name,table,id,wi_id,file_name,back_str)
 {
		if ( confirm("Are you shure to delete this file  ??")) {
			location.href="bom.php?PHP_action=do_bom_file_del&PHP_id="+id+"&PHP_talbe="+table+"&PHP_wi_id="+wi_id+back_str+"&PHP_file_name="+file_name;
		} 
 
 }
 
function overTip(boxObj,data) {
	boxObj.style.visibility = "visible";
	if(event.clientX + boxObj.offsetWidth > document.body.offsetWidth - 40 ){
		boxObj.style.left = event.clientX + document.body.scrollLeft - boxObj.offsetWidth - 26 + 'px';
	} else {
		boxObj.style.left = event.clientX + document.body.scrollLeft + 6 + 'px';
	}
	if(event.clientY + boxObj.offsetHeight > document.body.offsetHeight - 20 ){
		boxObj.style.top = event.clientY + document.body.scrollTop - boxObj.offsetHeight - 20 + 'px';
	} else {
		boxObj.style.top = event.clientY + document.body.scrollTop - 20 + 'px';
	}
	boxObj.innerHTML=data;
}
function outTip(boxObj){
	boxObj.style.visibility = "hidden";
}

-->
</script>
{/literal}

</head>

<body>
<div id='preview' style="position:absolute;z-index:1;visibility:hidden;background-color:#fff;border:1px solid #000;padding:3px;"></div>
<div id="Layer1" style="display : none"><img src="./images/ajpk.gif" border=0 width=20%></div>
<br>
{if $admin_flag}
<input type="hidden" id="PHP_flag" value="admin">
{else}
<input type="hidden" id="PHP_flag" value="user">
{/if}
<div style="position: absolute; top: expression(this.offsetParent.scrollTop); left: 720px; z-index:100">
<!--<div style="position:fixed;_position:absolute;right:0;top:expression(this.offsetParent.scrollTop);">-->

		<input type="hidden" id="menu_num" value="-1">
		<table border cellspacing=0 cellpadding=2 width=30 height=99 bgcolor=#ffffff  id="display_menu" align="right">
			<tr>
				<!--選單切換-->
				<td id="table_display" class=grn9 align=center bgcolor=#DDDDDD  style="writing-mode:tb-rl;cursor:pointer;">隱藏(Hide)</td>
			</tr>
		</table>
		<table border cellspacing=0 cellpadding=2 width=470 bgcolor=#ffffff id="color_table" align="right">
			{section name=USE loop=$show_breakdown}
				{$show_breakdown[USE]}
			{/section}
			{if $size_ttl}
			<TR>
				<td class=grn9 align=center bgcolor=#DDDDDD colspan=2><b>&nbsp;G-TTL</b></td>
			{section name=USE loop=$size_ttl}
				<td class=b9 align=center bgcolor=#DDDDDD>&nbsp;<b><i>{$size_ttl[USE]|NUMBER_FORMAT}</b></td>
			{/section}
			  <td class=b9 align=right bgcolor=#DDDDDD>&nbsp;<b><i>{$g_ttl|NUMBER_FORMAT}</b></td>
			<TR>
			{/if}
		</table>
</div>

<div align="left">
<table cellspacing=1 cellpadding=4 cols=2 width=700 bgcolor=#2E5E73>
	<tr><td class="des" align=center height=28 width=340>[ <b><span class=ylw10> EDIT </span>BOM for Order</b> - <b>{$wi.wi_num}</b> ]</td>
	<td class="ylw10" align=center height=28 width=140>{if $wi.status == 2}<b>[ {literal}SUBMIT{/literal} ]{elseif $wi.status == 1}[{literal}UN SUBMIT{/literal} ]{/if}</span></b></td>
	<td class="des" align=center height=28 width=140>Version :<span class=ylw10><b>{$wi.bom_rev}</span></b></td>
	<td>
	{if $add_flag && $wi.status > 10}
			<a href="{$PHP_SELF}?PHP_action=bom_copy&PHP_id={$wi.id}&PHP_style_code={$wi.style_code}&PHP_bom_cust={$wi.cust}{$back_str2}"  style="cursor:pointer"><img src="images/copy_ws.jpg" alt="Copy BOM " border=0 valign=bottom></a>
	{/if}
	</td>
	</tr>
</table>
     <table border=1 cellpadding=4 cellspacing=0 cols=1 width=700 id=msg_show {if $msg_YES}style="display : block" {else}style="display : none" {/if}>
      <tr bgcolor=#ffffff> 
        <td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
        <td class=bgdy><div id='m_div1'>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</div></td>
      </tr>
     </table>

<table border=0 cellspacing=0 cellpadding=1 width=700 bgcolor=#FFFFFF>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
    <td class=snvy align=right nowrap>Customer :</td>
    <td class=bgdy align=left><b>&nbsp;{$smpl.cust_iname}</b></td>
    <td class=snvy align=right nowrap>Department :</td>
    <td class=bgdy align=left><b>&nbsp;{$wi.dept}</b></td>
    <td class=snvy align=right nowrap><b>ETD :</b></td>
    <td class=bgdy align=left><b>&nbsp;{$wi.etd}</b></td>
  </tr>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
</table>

<table border cellspacing=0 cellpadding=3 width=700 bgcolor=#ffffff>
  <tr bgcolor="#003333" height=24> 
	<td nowrap width=100 align=center class=back><b>Picture</b></td>
	<td nowrap width=100 align=center class=back><b>Order #</b></td>
	<td nowrap width=100 align=center class=back><b>style</b></td>
	<td nowrap width=150 align=center class=back><b>SIZE RANGE</b></td>
	<td nowrap width=200 align=center class=back><b>Q'ty / Unit</b></td>
  </tr>
  <tr bgcolor=#DDDDDD height=24>
	<td class=g10 align=center rowspan=2>&nbsp;
		<a href="{$wi.pic_url}" target=_black><img src="{$wi.pic_url}" name="pic" border=0 width=90></a></td>
	<td class=grn9 align=center><b>&nbsp;{$smpl.order_num}</b></td>
    <td class=grn9 align=center><b>&nbsp;{$smpl.style}</b></td>
    <td class=grn9 align=center><b>&nbsp;{$smpl.size_scale}</b></td>
    <td class=grn9 align=center><b><span class=bgdy9><b>{$total}</b></span>&nbsp;pc</b></td>
  </tr>
  <tr>
	<td colspan=5 >
		<table border cellspacing=0 cellpadding=2 width=470 bgcolor=#ffffff id="color_table2">
			{section name=USE loop=$show_breakdown}
				{$show_breakdown[USE]}
			{/section}
			{if $size_ttl}
			<TR>
				<td class=grn9 align=center bgcolor=#DDDDDD colspan=2><b>&nbsp;G-TTL</b></td>
			{section name=USE loop=$size_ttl}
				<td class=b9 align=center bgcolor=#DDDDDD>&nbsp;<b><i>{$size_ttl[USE]|NUMBER_FORMAT}</b></td>
			{/section}
			  <td class=b9 align=right bgcolor=#DDDDDD>&nbsp;<b><i>{$g_ttl|NUMBER_FORMAT}</b></td>
			<TR>
			{/if}
		</table>
	</td>
  </tr>
</table>

<!-------------  BOM table ------------->
<!-------------  主料 ------------->
<hr size=2 width=700 align="left">
<table width=700 border=1 cellspacing=1 cellpadding=1>
<form method=POST name='edit'>
   <tr><td>
	<table width=700 border=0 cellspacing=1 cellpadding=1 id="bom_table">
	<!-------   Title --------- -->
	 <tr bgcolor=#C4C3AE>
	    <td width=80 	class=b9 rowspan=2 align=center><b>Fabric #</b></td>
	    <td width=90 	class=b9 rowspan=2 align=center><b>Fabric Name</b></td>
	    <td width=120 class=b9 rowspan=2 align=center><b>Placement</b></td>
	    <td width=60 	class=b9 rowspan=2 align=center><b>consump.</b></td>
		{if $admin_flag}<td width=60 	class=b9 rowspan=2 align=center><b>Consume</b></td>{/if}
	 	  <td width=70	class=b9 rowspan=2 align=center><b>Color/cat.</b></td>
	 	  <td width=10	class=b9 rowspan=2 align=center><small>size</small></td>
			<td width=0	class=b9 rowspan=2 align=center   bgcolor=#666666></td>
	{if $colors_NONE}
		<td class=bgdy9 align=center >NO Colorway data</td>
		<tr><td class=bgdy9 align=center >NO Q'ty</td>
	{else}
	<!--
	{section name=NAME loop=$partial} 
		<td class=grn9 align=center colspan={$partial[NAME].size}>ETD : <b>&nbsp;{$partial[NAME].etd}</b></td>
	{/section} 
-->	
	{section name=NAME loop=$color} 
		<td class=grn9 align=center value={$color[NAME].name} onmouseover="overTip(preview,$(this).val())" onmouseout="outTip(preview)"><b>&nbsp;{$color[NAME].name|substr:0:1}</b></td>
	{/section} 
		<td class=b9 align=center rowspan=2 width=1>&nbsp;</td>
	</tr>		
	 <tr bgcolor=#C9CCC9 name='color_qty_title'>
	{section name=QTY loop=$color} 
		<td class=b9 align=center><b>{$color[QTY].qty}</b>&nbsp;{if $wi.unit}{$wi.unit}{else}<span class=bgdy9> ??</span>{/if}</b></td>
	{/section} 

	{/if}
	 </tr>
	<!-------  end  Title 

	 <tr>
		<td width=100% colspan={$total_fields} style="background-image: url('images/2line.gif'); background-repeat: repeat-x" height=3>
	 </tr>
--------- -->
	{if $lots_NONE}  
	  <tr>
		<tr><td class=bgdy9 align=center colspan={$total_fields} height=30>This wi hasn't any Fabric data!</td></tr>
	  </tr>
	{else}


	<!-------  BOM 主料記錄 --------- -->
	{section name=BOM loop=$bom_lots_list} 
	{if $bom_lots_list[BOM].change == 1}
	 <tr>
		<td width=100% colspan={$total_fields} style="background-image: url('images/2line.gif'); background-repeat: repeat-x" height=3>
	 </tr>
	 {/if}
	<tr {$bom_lots_list[BOM].tr}>
		<td class=b9 align=left nowrap>&nbsp;<a href="javascript:Show_fab('{$bom_lots_list[BOM].lots_code}')" value='ord_out' style='cursor:pointer'>{$bom_lots_list[BOM].lots_code}</a></td>
		<td class=b9 align=left>&nbsp;<a href="javascript:Show_fab('{$bom_lots_list[BOM].lots_code}')" value='ord_out' style='cursor:pointer'>{$bom_lots_list[BOM].lots_name}</a></td>
		<td class=b9 align=left>&nbsp;{$bom_lots_list[BOM].use_for}</td>
		<td class=b9 align=right>{$bom_lots_list[BOM].est_1}&nbsp;{$bom_lots_list[BOM].unit}</td>
		{if $admin_flag}
			{if $bom_lots_list[BOM].change == 1}
				<td class=b7 align=right>
			{else}
			
				
				{if $bom_lots_list[BOM].over_marker == 1}
					<td class=b7 align=right style="color:red">
				{else}
					<td class=b7 align=right>
				{/if}
				{if $bom_lots_list[BOM].length_total == 0}
					&nbsp;
				{else}
					{$bom_lots_list[BOM].length_total}&nbsp;{$bom_lots_list[BOM].unit}
				{/if}
				
				
				
			{/if}
			
			
			
				</td>
		{/if}
		
		<td class=b9 align=center>&nbsp;{if $bom_lots_list[BOM].est_1 > 0}{$bom_lots_list[BOM].color}{/if}</td>
		<td class=b9 align=center>{$bom_lots_list[BOM].size}&nbsp;</td>
		<td class=b9 align=center width=0 bgcolor=#666666></td>
		{$bom_lots_list[BOM].list}
		<td class=b9 align=center width=1>{if $bom_lots_list[BOM].est_1 > 0 && $bom_lots_list[BOM].ap_mark == ''}{$bom_lots_list[BOM].remark}{/if}</td>
	</tr>

	{/section}
	<!------- end BOM 主料記錄 --------- -->
	
	{/if}

<!--	</table>	-->
	 <tr>
		<td width=100% colspan={$total_fields} style="background-image: url('images/2line.gif'); background-repeat: repeat-x" height=5>
	 </tr>
</form>
<form method=POST name='acc_edit'>
<!-------------  副料 ------------->
<!--	<table width=700 border=0 cellspacing=1 cellpadding=1>	-->
	<!-------   Title --------- -->
	 <tr bgcolor=#C4C3AE>
	    <td class=b9 align=center rowspan=2><b>Accessory #</b></td>
	    <td class=b9 align=center rowspan=2><b>ACC. Name</b></td>
	    <td class=b9 align=center	rowspan=2 ><b>Placement</b></td>
	    <td class=b9 align=center rowspan=2><b>consump.</b></td>
		{if $admin_flag}<td class=b9 align=center rowspan=2 ><b></b></td>{/if}
			
			<td class=b9 align=center rowspan=2 width=100><b>Color/cat.</b></td>
			<td class=b9 align=center rowspan=2 width=10><small>size</small></td>
			<td class=b9 align=center rowspan=2 width=0 bgcolor=#666666></td>
	{if $colors_NONE}
		<td class=bgdy9 align=center >NO Colorway</td>
	  <tr><td class=bgdy9 align=center >NO Q'ty</td>
	{else}
<!--	
	{section name=NAME loop=$partial} 
		<td class=grn9 align=center colspan={$partial[NAME].size}>ETD : <b>&nbsp;{$partial[NAME].etd}</b></td>
	{/section} 
	-->
	{section name=NAME loop=$color} 
		<td class=grn9 align=center value={$color[NAME].name} onmouseover="overTip(preview,$(this).val())" onmouseout="outTip(preview)"><b>&nbsp;{$color[NAME].name|substr:0:1}</b></td>
	{/section}
		<td class=b9 align=center rowspan=3 width=1>&nbsp</td>
	</tr>		

	 <tr bgcolor=#C9CCC9 id='acc_test' name='color_qty_title'>
	{section name=QTY loop=$color} 
		<td class=b9 align=center><b>{$color[QTY].qty}</b>&nbsp;{if $wi.unit}{$wi.unit}{else}<span class=bgdy9> ??</span>{/if}</b></td>
	{/section} 

	{/if}
	 </tr>
	<!-------  end  Title --------- -->

	 <tr>
		<td width=100% colspan={$total_fields} style="background-image: url('images/2line.gif'); background-repeat: repeat-x" height=3>
	 </tr>

	{if $acc_NONE}  
	  <tr>
		<tr><td class=bgdy9 align=center colspan={$total_fields} height=30>This wi hasn't any accessory data!</td></tr>
	  </tr>
	{else}

	<!-------  BOM 副料記錄 --------- -->
	{section name=BOM loop=$bom_acc_list} 

	{if $bom_acc_list[BOM].change == 1}
	 <tr>
		<td width=100% colspan={$total_fields} style="background-image: url('images/2line.gif'); background-repeat: repeat-x" height=3>
	 </tr>
	 {/if}

	 <tr {$bom_acc_list[BOM].tr}>
		<td class=b9 align=left nowrap>&nbsp;<a href="javascript:Show_acc('{$bom_acc_list[BOM].acc_code}')" value='ord_out' style='cursor:pointer'>{$bom_acc_list[BOM].acc_code}</a></td>
		<td class=b9 align=left>&nbsp;<a href="javascript:Show_acc('{$bom_acc_list[BOM].acc_code}')" value='ord_out' style='cursor:pointer'>{$bom_acc_list[BOM].acc_name}</a></td>
		<td class=b9 align=left>&nbsp;{$bom_acc_list[BOM].acc_use}</td>
		<td class=b9 align=right>{$bom_acc_list[BOM].est_1}&nbsp;{$bom_acc_list[BOM].unit}</td>
		{if $admin_flag}<td class=b9 align=center >&nbsp;</td>{/if}
		<td class=b9 align=center>&nbsp;{if $bom_acc_list[BOM].est_1 > 0}{$bom_acc_list[BOM].color}{/if}</td>
		<td class=b9 align=center>{$bom_acc_list[BOM].size}&nbsp;</td>
		<td class=b9 align=center width=0 bgcolor=#666666></td>
		{$bom_acc_list[BOM].list}
		<td class=b9 align=center width=1>{if $bom_acc_list[BOM].est_1 > 0 && $bom_acc_list[BOM].ap_mark == ''}{$bom_acc_list[BOM].remark}{/if}&nbsp;</td>
	</tr>
	{/section}
	<!------- end BOM 副料記錄 --------- -->
	{/if}

	</table>
</form>

   </td></tr>
</table>

<!--
	 <table width=710 border=1 cellspacing=1 cellpadding=1>
	 <tr bgcolor=#EACEBE height=25>	 
	    <td width=70 align=center><b>Dowload</b></td>	
	 	<td width=300 align=center><b>File name</b></td>
	 	<td width=300 align=center><b>Descript</b></td>
		<td width=30 align=center><b>DEL</b></td>
	 	
	 	</td>
	 </tr>
	 {if $done[0].id}
		 {section name=SEC loop=$done}
	 <tr>	
		<td align=center valign=top>
		<a href="download.php?fname={$done[SEC].file_name}&fdir=bom_file" title="{$done[SEC].file_name}" ><img src='./images/file2.gif' border=0 ALT="download pattern"></a>
		</td>  	
		<td class=snvy >{$done[SEC].file_name}</td>
		<td class=snvy>{$done[SEC].file_des}</td>
		<td class=snvy>&nbsp;
			{if $add_flag}
			<a href="javascript:file_del('{$done[SEC].file_name}','bom_file_det','{$done[SEC].id}','{$wi.id}','{$done[SEC].file_name}','{$back_str2}')" value="刪除" style="cursor:pointer"><img src="images/del.gif" alt="刪除" border=0 valign=bottom></a>
			{/if}
			</td>
     </tr>
       {/section}
     {/if}
     <tr>
     	<td colspan=4>
   <form method=POST name=pattn enctype="multipart/form-data">    
  	<input type="hidden" name="PHP_action" value="upload_bom_file">
		<input type="hidden" name="PHP_num" value="{$wi.wi_num}">
		<input type = "hidden" name = "max_size" value="100000">
		<input type="hidden" name="PHP_id" value="{$wi.id}">&nbsp;		
		<input type='file' name='PHP_pttn' size=20 class=select>&nbsp;&nbsp;
		Descript : &nbsp;
		<input type='text' name='PHP_desp' size=40 class=select >&nbsp;&nbsp;
		<input type='submit' value='upload'>
		</form>
		</td>
	 </tr>
  </table>
-->
<table border=0 cellspacing=0 cellpadding=2 width=690 bgcolor=#ffffff>
  <tr>
    <td colspan=8 class=frnt align=center><hr size=2 width=98%></td>
  </tr>
  <tr>
	<td colspan=2><form method=POST name=back>

		<input type=button onClick="window.location.href='{$PHP_SELF}?PHP_action=bom_search_wi'" value=" << go back " class=select_e style="cursor:pointer; width=99%"></form>

	</td></form>
	
<td><form method=POST name=back>

	<input type=button onClick="window.location.href='{$PHP_SELF}?PHP_action=bom_view&PHP_id={$wi.id}'" value=" BOM VIEW" class=select_e style="cursor:pointer; width=99%"></form>
													              

	</td></form>
  </tr>
</table>
</div>

<!--------- footer ---------->
{include file="footer.html"}

