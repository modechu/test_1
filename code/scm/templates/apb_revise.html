<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=big5">
   <title>===:::::::::: 積物料輔助系統 [ 驗收 資料 ] ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<script language="javascript" src="./js/open_detial.js"></script>
<script type="text/javascript" src="./js/jquery.min.js"></script>
<Script language="javascript">
function aply_revise(id,rcv_num,back_str,version) {
	var loc;
	loc='apply_revise';
	if ( confirm("are you sure to REVISE Receive:#[ "+rcv_num+" ] ?\r\rEvery Revise event will cancel entire process had done !\rAnd restart the apply procedure from beginning Again !\r\rBe sure this is OK for you!")) {
		location.href="apb.php?PHP_action=rcvd_revise&PHP_rcv_num="+rcv_num+bakc_str+"&PHP_id="+id+"&PHP_ver="+version;
	} 
}
function Show_batch_cost(id)
{
	 var url ='index2.php?PHP_action=ord_batch_cost&PHP_bom_num='+id; 	
	 var nm = 'Sworking';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=800,height=600 top=50, left=100');
}

function rcv(){
	var po = Number(0);
	var rcvd = Number(0);
	var apb = Number(0);
	var price = Number(0);
	
	$("input[id^=no]").each(function(i,elm) {
		po += Number($("#po_s"+$(elm).val()).val());
		rcvd += Number($("#rcvd_s"+$(elm).val()).val());
		apb += Number($("#apb_s"+$(elm).val()).val());
	});
	$("#po_sum").html( roundAmount(po) );
	$("#rcvd_sum").html( roundAmount(rcvd) );
	$("#apb_sum").html( roundAmount(apb) );
}

function roundAmount(n) {   
	var s = "" + Math.round( n * 100 ) / 100   
	var i = s.indexOf('.')   
	if ( i < 0 ) return s + ".00"
	var t = s.substring( 0 , i + 1 ) +     
	s.substring( i + 1 , i + 3 )   
	if (i + 2 == s.length) t += "0"   
		return t   
} 



function formatFloat(num, pos){
	// 第一個參數num是帶有小數的變數，
	// 第二個參數pos是要取小數後的幾位數。
	var size = Math.pow(10, pos);
	return Math.round(num * size) / size;
}

function thun(v){//在千位數插入逗號
	x = Math.round(v)
	var tmp=eval('""+x').length        
	if(tmp>3&&tmp<7) {
		tmp=eval('""+x').substring(0,tmp-3)+","+eval('""+x').substring(tmp-3,tmp)
		return tmp
	}
	return x
}

</script>
{/literal}
</head>
<body topmargin="10" onLoad="rcv();" bgcolor="#003C77" background="images/vline-515.jpg" ><form METHOD="POST" name="supl_add" action="{$PHP_SELF}">
<br>
<table cellspacing=1 cellpadding=4 cols=1 width=900 bgcolor=#003300>
	<tr>
	<td class="des" align=center width=150>{if $apb.status ==0}<b>Waiting for submit</b>{/if}{if $apb.status ==2}<b>Submitted</b>{/if}</td>
	<td class="des" align=center width=400>Receiving&nbsp; # <span class=ylw10><b>{$apb.rcv_num}</b></span>  Record </td>
		<td class="des" align=center>
	   {if $apb.status == 2 && $back_str && $edit_flag}
			<a href="javascript:aply_revise('{$apb.id}','{$apb.rcv_num}','{$back_str}','{$apb.version}')" value='revise' style='cursor:pointer'>
			<img src='./images/revise21.jpg' border=0 ALT="REVISE"></a>
	   {/if}
	  </td>
		<td class="ylw10" align=center height=28> {if $apb.version <> 0}<span class=sign_b>Version</span> <b>{$apb.version}</b>{else}&nbsp;{/if} </td>
	</tr>
</table>

{if $msg_YES}
     <table border=1 cellpadding=4 cellspacing=0 cols=1 width=900>
      <tr bgcolor=#ffffff> 
        <td width=90 class=gry10 align=center><img src="images/alert.gif" border=0></td>
        <td class=bgdy>{section name=SEC_MSG loop=$msg} {$msg[SEC_MSG]}<br>{/section}</td>
      </tr>
     </table>
{/if}
<hr SIZE=2 WIDTH=900>
<table border=0 cellspacing=1 cellpadding=4 width=900 bgcolor=#FFFFFF>
  <input type="hidden" name="PHP_chkacc_no2" value="{$apb.rcv_num}">
  <tr>
    <td class=snvy align=right bgcolor=#E9F7E8><b>驗收單號 : </b></td>
    <td align=left bgcolor="#EEEEEE"  class=b9><b>&nbsp;{$apb.rcv_num}</b></td>
    <td class=snvy align=right bgcolor=#E9F7E8 nowrap><b>供應商代號 : </b></td>
    <td align=left bgcolor="#EEEEEE"  class=b9><b>&nbsp;{$apb.sup_no}</b></td>
    <td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>供應商名稱 : </b></td>
    <td align=left bgcolor="#EEEEEE"  class=b9><b>&nbsp;{$apb.s_name}</b></td>
    <td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>發票或收據號碼 : </b></td>
    <td align=left bgcolor="#EEEEEE"  class=b9><b>&nbsp;{$apb.inv_num}</b></td>
  </tr>
  <tr>
    <td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>請購單位 : </b></td>
    <td align=left bgcolor="#EEEEEE"><b>{$apb.dept}
      <input type="hidden" name="PHP_dept" value="{$dept}">
          <input type="hidden" name="PHP_ship" value="{$ship}">
    </b>　</td>
    <td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>請購日期 : </b></td>
    <td align=left bgcolor="#EEEEEE"><b>{$apb.po_apv_date}</b></td>
    <td align=right nowrap bgcolor=#E9F7E8 class=snvy><b>收料日期 : </b></td>
    <td align=left bgcolor="#EEEEEE" class=b9 ><b>&nbsp;{if $apb.inv_date != '0000-00-00'}{$apb.inv_date}{/if}</b></td>
		<td align=right nowrap bgcolor=#E9F7E8 class=snvy></td>
    <td align=left bgcolor="#EEEEEE" class=b9 ></td>
  </tr>
  <tr>
    <td class=snvy align=right bgcolor=#E9F7E8><b>折讓 : </b></td>
    <td align=left bgcolor="#EEEEEE">&nbsp;{if $apb.discount != '0.00'}{$apb.discount}{/if}</td>
    <td class=snvy align=right bgcolor=#E9F7E8><b>折稅 : </b></td>
    <td align=left bgcolor="#EEEEEE">&nbsp;{if $apb.off_duty != '0.00'}{$apb.off_duty}{/if}</td>
    <td class=snvy align=right bgcolor=#E9F7E8><b>加值稅 : </b></td>
    <td align=left bgcolor="#EEEEEE">&nbsp;{if $apb.vat != '0.00'}{$apb.vat}{/if}</td>
    <td class=snvy  align=right bgcolor=#E9F7E8><b>總合計金額 : </b></td>
    <td align=left bgcolor="#FF0000" class=des ><b>&nbsp;{if $apb.inv_price != '0.00'}{$apb.inv_price|number_format}{/if}</b></td>
  </tr>	
  <tr>
    <td class=snvy  align=right ></td>
    <td class=ssign    align=left colspan=7>&nbsp;{if $apb.ann_num}({$apb.ann_num}){/if}</td>
  </tr>
</table>
<hr SIZE=2 WIDTH=900>
<table width="900" border=0 cellpadding=6 cellspacing=0 id="table2">
  <tr>
    <td align=right nowrap  bgcolor=#DBC9F2 class=snvy><b>PO # :</b></td>
    <td align=left nowrap bgcolor=#DBC9F2><b>&nbsp;<a href="javascript:po_show('{$apb.ap_num}','')" value='ord_out' style='cursor:pointer'>{$apb.po_num}</a></b></td>
    <td align=right nowrap  bgcolor=#DBC9F2 class=snvy><b>Receiver : </b></td>
    <td align=left nowrap bgcolor=#DBC9F2><b>&nbsp;{$apb.rcv_dept}　</b></td>
    <td align=right nowrap bgcolor=#DBC9F2><b>Tolerance : </b></td>
    <td align=left nowrap bgcolor=#DBC9F2><b>&nbsp;{if $apb.toler == '0|0'}0{else} + {$apb.toleri} % {if $apb.tolern != '0'}~ - {$apb.tolern} % {/if}{/if}</b></td>
    <td align=right nowrap  bgcolor=#DBC9F2 class=snvy><b>Currency : </b></td>
    <td align=left nowrap bgcolor=#DBC9F2><b>{$apb.currency}　</b></td>
  </tr>
  <input type="hidden" name="PHP_pur_no" value="{$ap.po_num}">
</table>
<hr SIZE=2 WIDTH=900>
<table border="1" cellspacing=0 cellpadding=3 width="900" id="table1">	
	<tr bgcolor="#584E5C" height=30>
		<td cellpadding=2 class=back align="center" nowrap><b>Order #</b></td>	
		<td cellpadding=2 class=back align="center" nowrap><b>Material #</b></td>	
		<td cellpadding=2 class=back align="center" nowrap><b>Color/cat</b></td>
		<td cellpadding=2 class=back align="center" nowrap><b>ETA</b></td>
		<td cellpadding=2 class=back align="center" nowrap><b>P / O<br>Q'ty</b></td>
		<td cellpadding=2 class=back align="center" nowrap><b>Rcvd.<br>Q'ty</b></td>
		<td cellpadding=2 class=back align="center" nowrap><b>Apb<br>Q'ty</b></td>
    <td cellpadding=2 class=back align="center" nowrap><b>原幣單價<br>({$apb.currency})</b></td>
    <td cellpadding=2 class=back align="center" nowrap><b>台幣單價</b></td>
<!--
		<td cellpadding=2 width="100" class=back align="center"><b>RCVD. &nbsp;&nbsp;&nbsp;Q'ty</b></td>		
		<td cellpadding=2 width="100" class=back align="center"><b>UN-Rcvd. Q'ty</b></td>
-->		
		
	</tr>
{section name=CHK_D loop=$apb_det} 
	<input type="hidden" id="no" value="{$apb_det[CHK_D].i}">
	<input type="hidden" id="po_s{$apb_det[CHK_D].i}" value="{$apb_det[CHK_D].po_qty}">
	<input type="hidden" id="rcvd_s{$apb_det[CHK_D].i}" value="{$apb_det[CHK_D].rcv_qty}">
	<input type="hidden" id="apb_s{$apb_det[CHK_D].i}" value="{$apb_det[CHK_D].qty}">
	<input type="hidden" id="PHP_uprice{$apb_det[CHK_D].i}" value="{$apb_det[CHK_D].uprice}" >
	<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'" bgColor='#ffffff'>
		<td  align="center" nowrap>
 	  	{section name=AP loop=$apb_det[CHK_D].order}
 	  	<a href="javascript:po_bom_view('{$apb_det[CHK_D].order[AP]}','x')" style='cursor:pointer'>{$apb_det[CHK_D].order[AP]}</a>&nbsp;<br>
 	  	{/section}
		</td>
		<td align="center" nowrap>			
			<a href="javascript:{if $apb_det[CHK_D].mat_cat == 'l'}Show_fab{else}Show_acc{/if}('{$apb_det[CHK_D].mat_code}')" value='ord_out' style='cursor:pointer'>{$apb_det[CHK_D].mat_code}</a>
		</td>
		<td cellpadding=2 align="center">{$apb_det[CHK_D].color}</td>
		<td cellpadding=2 align="center">{$apb_det[CHK_D].po_eta}</td>
		<td cellpadding=2 align="right" nowrap>{$apb_det[CHK_D].po_qty|number_format:"2f"} {$apb_det[CHK_D].unit}</td>
		<td align="right" nowrap>{$apb_det[CHK_D].rcv_qty|number_format:"2f"} {$apb_det[CHK_D].unit}</td>	
		<td cellpadding=2 align="right" nowrap>{$apb_det[CHK_D].qty|number_format:"2f"} {$apb_det[CHK_D].unit}</td>
    <td align="right" nowrap>{$apb_det[CHK_D].uprices}</td>
    <td align="right" nowrap>{$apb_det[CHK_D].uprice}</td>	
<!--
		<td cellpadding=2 align="right">{$apb_det[CHK_D].rcv_qty} {$apb_det[CHK_D].unit}</td>
		<td cellpadding=2 align="right">{$apb_det[CHK_D].un_qty} {$apb_det[CHK_D].unit}</td>
-->
	</tr>
{/section}
	<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'" bgColor='#ffffff'>
		<td colspan=4 align="center">合計</td>	
		<td cellpadding=2 align="right"><b><span id="po_sum">po_sum</span></b></td>
    <td cellpadding=2 align="right"><b><span id="rcvd_sum">rcvd_sum</span></b></td>
    <td cellpadding=2 align="right"><b><span id="apb_sum">apb_sum</span></b></td>	
		<td cellpadding=2 align="center">&nbsp;</td>
    <td cellpadding=2 align="right">&nbsp;</td>
	</tr>
</table>
<br>

{if $mark[0].r_mk}
<table border=1 cellspacing=0 cellpadding=2 width="900">
	<tr>
		<td  width="700" align="center" bgcolor="#B49FBE" colspan=2>備註</td>
	</tr>
{section name=MARK loop=$mark}
{if $mark[MARK].r_mk}
	<tr height=30>		
		<td  bgcolor="#E0E0E0" width="10">{$mark[MARK].i}</td>
		<td  bgcolor="#E0E0E0" width="450">{$mark[MARK].r_mk}</td>							             
	</tr>
	<input type="hidden" name="PHP_r_mk_i" value={$mark[MARK].i}>
{/if}
{/section}
</table>
{/if}
<input type="hidden" name="PHP_chkacc_user" value={$user}>
<input type="hidden" name="PHP_chkacc_date" value={$dates}>
<br>
<table border=0 cellspacing=0 cellpadding=2 width=900>
<tr>
<td WIDTH=360 align=right><font size=1 >Submit : </font> </td>
<td WIDTH=120 align=left><font size=1 >{if $apb.rcv_sub_user}{$apb.rcv_sub_user} / {$apb.rcv_sub_date}{/if}&nbsp;</font></td>
<td WIDTH=100 align=right><font size=1 >經辦：</font></td>
<td WIDTH=120 align=left><font size=1 >{$apb.rcv_user} / {$apb.rcv_date}&nbsp;</font></td>
</tr>
</table>
<br>

</form>


<!--------- footer ---------->
{include file="footer.html"}
