<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=big5">
<title>===:::::::::: SCM System ::::::::::===</title>
<link rel=stylesheet type="text/css" href="./bom.css">
{literal}
<style type="text/css">@import url(js/calendar/skins/aqua/theme.css);.outline {
	border :1px solid #CCCCCC;
	padding:3px 7px 3px 7px;
	background-color:#FFFFFF;
	color:#000000;
	margin:3px  !important;
	cursor:pointer;
}</style>
<script type="text/javascript" src="./js/calendar/calendar.js"></script>
<script type="text/javascript" src="./js/calendar/lang/calendar-en.js"></script>
<script type="text/javascript" src="./js/calendar/calendar-setup.js"></script>
<script type="text/javascript" src="./js/jquery.min.js"></script>
<script language="javascript" src="./js/open_detial.js"></script>
<script type="text/javascript" src="./js/build/yahoo/yahoo-min.js"></script>
<script type="text/javascript" src="./js/build/connection/connection-min.js"></script>
<script type="text/javascript" src="./js/jquery.blockUI.js"></script>
<Script language="javascript">

$(document).ready(function() {

	$("#pi_b_edit").click(function(){
		$("#pi_edit").css('display','inline');
		$("#pi_view").css('display','none');
	});
	
	$("#pi_b_update").click(function(){
		$("#pi_edit").css('display','none');
		$("#pi_view").css('display','inline');
		pi_update();
	});
	
    pi_update = function(po_num){

		$.blockUI({ message: '<div><br><h4>Waiting...</h4></div>'});
        
        var pi = $("#PHP_pi").val();
        
        $.ajax({
            url: "po.php?PHP_action=pi_add",
            type: 'POST',
			data: {
				po_num: $("#po_num").val(),
				pi: $("#PHP_pi").val()
			},
            success: function(msg){
                if ( msg == 'ok' ) {
					$("#pi_v_font").html($("#PHP_pi").val());
					$.blockUI({ message: '<div><br><h4>Successfully update PI# '+$("#PHP_pi").val()+' ...</h4></div>'});
					setTimeout(function(){ $.unblockUI(); }, 1200);
                } else {
                    alert('error!!');
                }
            },
            error:function(xhr, ajaxOptions, thrownError){ 
                alert(xhr.status); 
                alert(thrownError); 
				$.unblockUI();
				$.blockUI({ message: '<div><br><h4>'+xhr.status+thrownError+'</h4></div>'});
            }
        });
    }
	
	
});

var transaction;
var sUrl;	

function aply_revise(aply_num,bakc_str,special,id,rev,po_num) {
	var loc;

	loc='apply_revise';
	if ( confirm("are you sure to REVISE P/O :#[ "+po_num+" ] ?\r\rEvery Revise event will cancel entire process had done !\rAnd restart the apply procedure from beginning Again !\r\rBe sure this is OK for you!")) {
		// cgiget="{/literal} {$cgistr_get}{literal}&cgino={/literal}{$start_no}{literal}&cgi_1={/literal}{$cgi.dept}{literal}&cgi_2={/literal}{$cgi.order_num}{literal}&cgi_3={/literal}{$cgi.cust}{literal}&cgi_4={/literal}{$cgi.ref}{literal}&cgi_5={/literal}{$cgi.factory}{literal}";
		location.href="po.php?PHP_action="+loc+"&PHP_aply_num="+aply_num+"&PHP_back="+bakc_str+"&PHP_revise=1&PHP_id="+id+"&PHP_rev_time="+rev;
	} 
}

function del_po(ap_num,back_str,po_num) {
	var loc;

	loc='apply_revise';
	if ( confirm("are you sure to DELETE P/O :#[ "+po_num+" ] ?")) {
		window.location="po.php?PHP_action=do_apply_del&PHP_ap_num="+ap_num+"&PHP_back="+back_str;
	} 
}


function del_po_apv(ap_num,back_str,po_num) {
	var loc;

	loc='apply_revise';
	if ( confirm("Deleting "+po_num+"  must write Exceptional report. \r\r Are you sure to DELETE P/O :#[ "+po_num+" ] ?")) {
		window.location="po.php?PHP_action=do_po_apv_del&PHP_status=12&PHP_ap_num="+ap_num+"&PHP_back="+back_str;
	} 
}

function cfm_ajx(id,r){
	var i=r.parentNode.parentNode.rowIndex;
	document.getElementById('mater_table').deleteRow(i);	  

	sUrl = "po.php?PHP_action=log_del_ajx&PHP_id="+id;
	transaction = YAHOO.util.Connect.asyncRequest('GET', sUrl, delback, null);
}

var delback = {
    success: function(o) {
        document.getElementById("tbl_msg").style.display='block';    
        var response = o.responseText.split("|");
        var divrep=response[0];
        msg1.innerText  = divrep;
    },failure: function(o) {
        alert("Error：Can't get data");
    }
};

function check(obj){
    var obj;
    var max=127;
    obj.value=obj.value.substring(0,max);
}  

function special_chk(spec)
{
	if(spec == 1) alert('採購單將併異常報告一起列印');
}

function tblresize() {
	var dh = 110;
	var dw = 60;
	var hh = tblShow.offsetHeight + dh;
	if ( hh > screen.height - dh )
		hh = screen.height - dh ;
  if (tblShow.offsetWidth) window.resizeTo( tblShow.offsetWidth + dw , hh );
		self.focus();
}

function rechk(num){
    if ( !confirm("are you sure to REOPEN P/O :#[ "+num+" ] ?")) {
		return false;
	} 
}

function etd_edit(id,ap_num,po_spare,special)
{
	$.ajax({
		url: 'po.php?PHP_action=po_etd_edit',
		type: 'GET',
		data: {
			PHP_ap_num: ap_num,
			PHP_po_spare: po_spare,
			PHP_etd: $("#PHP_etd"+id).val(),
			PHP_special : special
		},
		error: function(xhr) {
			alert('Ajax request 發生錯誤'+xhr);
		},
		success: function(response) {
			$('#etd_text'+id).text($('#PHP_etd'+id).val());
			$('#etd_text'+id).css('display','inline');;
			$('#add_img'+id).css('display','inline');
			$('#etd_div'+id).css('display','none');
		}
	});
}
function search_ship(ship_id) {
 
	var url ="po_ship.php?PHP_action=ship_view&PHP_id=" + ship_id;

	var nm = 'ship_search';
	window.open2(url,nm,'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=1000,height=670, top=20, left=20');
}
</script>
{/literal}
</head>
{if $goback}
<body topmargin="10" onLoad="tblresize();" />
{else}
<body>
{/if}
<table id="tblShow">
<tr><td>


{if $ap.special  == 0 || $ap.special  == 1}
<table border="1" cellspacing=0 cellpadding=2 width=900 id="table2">	
	<tr bgcolor="#003333" height=28>
		<td class=back align="center"><b>Order #</b></td>		
		<td width="90" class=back align="center"><b>Name</b></td>
		<td width="160" class=back align="center"><b>Color / Cat.</b></td>
		<!-- <td width="70" class=back align="center"><b>Size</b></td> -->
		<td width="70"  class=back align="center"><b>Tolerance</b></td>
		<td width="100" class=back align="center"><b>Q'ty</b></td>
		<td width="100" class=back align="center"><b>ETD</b></td>		
		<td width="80" class=back align="center" nowrap><b>Ship NO#</b></td>
		<td width="150"  class=back align="left"><b>Ship Q'ty</b></td>
		<td width="80" class=back align="center"><b>Total</b></td>
		<td width="80" class=back align="center"><b>%</b></td>
		
	</tr>
	{section name=SEC loop=$ap_det2} 
	
	{if $ap_det2[SEC].qty_different > $ap.toleri}
		<tr bgcolor='#FF9291' onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#FF9291'">
	{elseif $ap_det2[SEC].qty_different < $ap.tolern}
		{if $ap_det2[SEC].qty_different eq -100}
			<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
		{else}
			<tr bgcolor='#B0AFFF' onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#B0AFFF'">
		{/if}
	{else}
		<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
	{/if}
		<td align="left" nowrap>
 	  	{section name=AP loop=$ap_det2[SEC].orders}
	  	<a href="javascript:po_bom_view('{$ap_det2[SEC].orders[AP]}','{$ap.po_num}')" value='ord_out' style='cursor:pointer'>{$ap_det2[SEC].orders[AP]}</a><br>
 	  	{/section}
		</td>
		<td  align="left" nowrap>
			<a href="javascript:{if $ap_det2[SEC].mat_cat == 'l'}Show_fab{else}Show_acc{/if}('{$ap_det2[SEC].mat_code}')" value='ord_out' style='cursor:pointer' title='{$ap_det2[SEC].mat_code}'>{$ap_det2[SEC].mat_name}</a>
		</td>
		<td  align="left">{$ap_det2[SEC].color}&nbsp;</td>
		<!-- <td  align="center">{$ap_det2[SEC].size}&nbsp;</td> -->
		{if $ap.toleri == ''}
			{if $ap.tolern ==''}
				<td  align="right"> 0%</td>
			{else}
				<td  align="right">{$ap.tolern}%</td>
			{/if}
		
		{else}
			{if $ap.tolern ==''}
			<td  align="right">+{$ap.toleri}%</td>
			{else}
			<td  align="right">+{$ap.toleri}%<br>{$ap.tolern}%</td>
			{/if}
		{/if}
		
		<!-- <td  align="right">{$ap_det2[SEC].range} %</td> -->
		
		
		<td  align="right">{$ap_det2[SEC].po_qty|number_format:"2f"}&nbsp;{$ap_det2[SEC].po_unit}</td>
		<td  align="center" nowrap>
			<span id="etd_text{$ap_det2[SEC].id}">{if $ap_det2[SEC].po_eta == '0000-00-00'}{$ap_det2[SEC].eta}{else}{$ap_det2[SEC].po_eta}{/if}</span>
			{if $add_flag}
			<!-- <span id="add_img{$ap_det2[SEC].id}" style="cursor:hand" onClick="document.getElementById('etd_text{$ap_det2[SEC].id}').style.display='none';this.style.display='none';document.getElementById('etd_div{$ap_det2[SEC].id}').style.display='inline'">
				&nbsp;&nbsp;<img src="images/Add.gif" alt="Edit" border=0 valign="bottom" style="display:none">
			</span> -->
			<div id="etd_div{$ap_det2[SEC].id}" style="display:none;">
				<input type="text" size="8" id="PHP_etd{$ap_det2[SEC].id}" class="select" value="{if $ap_det2[SEC].po_eta == '0000-00-00'}{$ap_det2[SEC].eta}{else}{$ap_det2[SEC].po_eta}{/if}">
				<input type=button onClick="etd_edit('{$ap_det2[SEC].id}','{$ap.ap_num}','{$ap_det2[SEC].po_spare}',0)" value="update" class=select_e style="cursor:pointer">&nbsp;
			</div>
			<!-- {literal}
			<script type="text/javascript">Calendar.setup({inputField:"PHP_etd{/literal}{$ap_det2[SEC].id}{literal}",button:"f_trigger_c",ifFormat:"%Y-%m-%d"});</script>
			{/literal} -->
			{/if}
		</td>
		<!--要判斷是否為多組資料-->
		
		<td  align="left" nowrap>
		{section name=ship_index loop=$ap_det2[SEC].ship_num} 	
			<a href="javascript:search_ship('{$ap_det2[SEC].ship_id[ship_index]}')" value='ord_out' style='cursor:pointer'>{$ap_det2[SEC].ship_num[ship_index]}</a> <br>
		{/section}
		{if $ap_det2[SEC].my_row eq -1}
			&nbsp;
		{/if}
		</td>
		
		<td  align="left">
		
		{foreach from=$ap_det2[SEC].ship_qty item=qty key=myindex}
		{if $ap_det2[SEC].my_row eq $myindex}
			{$qty}
		{else}
			{$qty}<br>
		{/if}
		{/foreach}
		{if $ap_det2[SEC].my_row eq -1}
			&nbsp;
		{/if}

		</td>
		<!---------------------------------------------------------------->
		<td  align="center">{$ap_det2[SEC].ship_qty_total}</td>
		<!-- <td  align="right">{$ap.fob}&nbsp;{$ap.fob_area}<br>{$ap_det2[SEC].prics|number_format:"5f"}&nbsp;/&nbsp;{$ap_det2[SEC].prc_unit}</td>
		<td  align="right">{$ap_det2[SEC].amount|number_format:"2f"}</td> -->

		<td  align="center"> 
		{if $ap_det2[SEC].qty_different eq -100}
			0%
		{else}
			{$ap_det2[SEC].qty_different}%
		{/if}
		<!-- {$ap_det2[SEC].qty_different}% -->		
		</td>
	</tr>	
	<tr>
	{if $ap_det2[SEC].ship_rmk !=''}
	<td align="center" bgcolor="#C4FAD8"><font color="#FF0000" ><b>Remark</b></font></td>
	<td  align="left" colspan='9' bgcolor="#C4FAD8">{$ap_det2[SEC].ship_rmk}</td>
	{/if}
	</tr>
	{/section}

{else}
<table border="1" cellspacing=0 cellpadding=2 width=900 id="table2">	
	<tr bgcolor="#003333" height=28>	
		<td width="110" class=back align="center"><b>Order</b></td>	
		<td width="90" class=back align="center"><b>Name</b></td>		
		<td width="160" class=back align="center"><b>Color/Cat.</b></td>
		<td width="60"  class=back align="center"><b>Tolerance(%)</b></td>
		<td width="100"  class=back align="center"><b>Q'ty</b></td>
		<td width="100"  class=back align="center"><b>ETD</b></td>		
		<td width="80" class=back align="center"><b>Ship NO#</b></td>
		<td width="150"  class=back align="center"><b>Ship Q'ty</b></td>
		<td width="80" class=back align="center"><b>Total</b></td>
		<td width="80" class=back align="center"><b>%</b></td>
		
	</tr>
	{section name=SEC loop=$ap_spec2} 
	
	{if $ap_spec2[SEC].qty_different > $ap.toleri}
		<tr bgcolor='#FF9291' onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#FF9291'">
	{elseif $ap_spec2[SEC].qty_different < $ap.tolern}
		{if $ap_spec2[SEC].qty_different eq -100}
			<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
		{else}
			<tr bgcolor='#B0AFFF' onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#B0AFFF'">
		{/if}
	{else}
		<tr onMouseOver="bgColor='#FCF4A4'" onMouseOut="bgColor='#ffffff'">
	{/if}
		<td  align="left">			
	  	<a href="javascript:po_bom_view('{$ap_spec2[SEC].ord_num}','{$ap.po_num}')" value='ord_out' style='cursor:pointer'>
 	  	{$ap_spec2[SEC].ord_num}&nbsp;</a>
		</td>	
		<td  align="left" nowrap >			
			<a href="javascript:{if $ap_spec2[SEC].mat_cat == 'l'}Show_fab{else}Show_acc{/if}('{$ap_spec2[SEC].mat_code}')" value='ord_out' style='cursor:pointer'>{$ap_spec2[SEC].mat_code}</a>
		</td>
		<td align="left">{$ap_spec2[SEC].color}&nbsp;</td>
		
		{if $ap.toleri == ''}
			{if $ap.tolern ==''}
				<td  align="right"> 0%</td>
			{else}
				<td  align="right">{$ap.tolern}%</td>
			{/if}
		
		{else}
			{if $ap.tolern ==''}
			<td  align="right">+{$ap.toleri}%</td>
			{else}
			<td  align="right">+{$ap.toleri}%<br>{$ap.tolern}%</td>
			{/if}
		{/if}
		
		<td align="right">{$ap_spec2[SEC].po_qty|number_format:"2f"}&nbsp;{$ap_spec2[SEC].po_unit}</td>
		<td align="center" nowrap >
			<span id="etd_text{$ap_spec2[SEC].id}">{if $ap_spec2[SEC].po_eta == '0000-00-00'}{$ap_spec2[SEC].eta}{else}{$ap_spec2[SEC].po_eta}{/if}</span>
			<div id="etd_div{$ap_spec2[SEC].id}" style="display:none;">
				<input type="text" size="8" id="PHP_etd{$ap_spec2[SEC].id}" class="select" value="{if $ap_spec2[SEC].po_eta == '0000-00-00'}{$ap_spec2[SEC].eta}{else}{$ap_spec2[SEC].po_eta}{/if}">
				<input type=button onClick="etd_edit('{$ap_spec2[SEC].id}','{$ap.ap_num}','{$ap_spec2[SEC].po_spare}',1)" value="update" class=select_e style="cursor:pointer">&nbsp;
			</div>
		</td>		
		
		<td  align="left" nowrap>
		{section name=ship_index loop=$ap_spec2[SEC].ship_num} 	
			<a href="javascript:search_ship('{$ap_spec2[SEC].ship_id[ship_index]}')" value='ord_out' style='cursor:pointer'>{$ap_spec2[SEC].ship_num[ship_index]}</a> <br>
		{/section}
		{if $ap_spec2[SEC].my_row eq -1}
			&nbsp;
		{/if}
		</td>
		
		<td  align="left">
		{foreach from=$ap_spec2[SEC].ship_qty item=qty key=myindex}
		{if $ap_spec2[SEC].my_row eq $myindex}
			{$qty}
		{else}
			{$qty}<br>
		{/if}
		{/foreach}

		&nbsp;</td>
		<td  align="center">{$ap_spec2[SEC].ship_qty_total}</td>
		
		<td  align="center"> 
		{if $ap_spec2[SEC].qty_different eq -100}
			0%
		{else}
			{$ap_spec2[SEC].qty_different}%
		{/if}
		</td>
	</tr>	
	<tr>
	{if $ap_spec2[SEC].ship_rmk !=''}
	<td align="center" bgcolor="#C4FAD8"><font color="#FF0000" ><b>Remark</b></font></td>
	<td  align="left" colspan='9' bgcolor="#C4FAD8">{$ap_spec2[SEC].ship_rmk}</td>
	{/if}
	</tr>
	{/section}

{/if}

</table>
{if $update_msg!=''}
	<div align="left"><font color="#FF0000" ><b>{$update_msg}</b></font></div>
{/if}
<form METHOD="GET" name="apply_add" action="{$PHP_SELF}">
		<input type="hidden" name="PHP_action" value="po_ship_rmk">
		<input type="hidden" name="PHP_id" value="{$ap.id}">
		<input type="hidden" name="PHP_aply_num" value="{$ap.ap_num}">
		<input type="hidden" name="PHP_po_num" value="{$ap.po_num}">
		<input type="hidden" name="PHP_back_str" value="{$back2ship_det}">
		<input type=submit value="[ SHIP REMARK ]" class=select_e style="cursor:pointer; width=40%">
</form>
{if $add_flag && $ap.status != 12 && $ap.status >= 0}
<!---------- sample logs form   -->
<!--<table border=1 cellspacing=0 cellpadding=0 width=900 align=center>
<form method=POST name=smpl_logs>
	<tr bgcolor=#bbbbbb height=25>
		<td colspan=3 align=center class=nvy9><b>Adding  Remark</b></td>
	</tr>
	<tr bgcolor=#666666 height=25>
		<td width=70 class=w10 align=center>Item</td>
		<td width=450 class=w10 align=center>Remark</td>
		<td width=70 class=w10 align=center>&nbsp;</td>
	</tr>
	<tr bgcolor=#eeeeee >
		<td class=gry9 align=center>{$rmk_item}</td>
		<td class=gry9 align=left>
			<textarea name="PHP_des" rows=2 cols=100 class=select onBlur=check(this)>{$smpl_log.des}</textarea>
			<BR><SMALL>DOCUMENT : INSIDE ; Remark,Packing : OUTSIDE</SMALL>
		</td>
		<td class=ylw9 align=center valign=center>
		<input type=submit value="save" class=select_e style="cursor:pointer; width=55; height=35" onClick=this.width=0;></td>
		<input type="hidden" name="PHP_action" value="do_apply_logs_add">
		<input type="hidden" name="PHP_back_str" value="{$back_str}">
		<input type="hidden" name="PHP_aply_num" value="{$ap.ap_num}">
		<input type="hidden" name="PHP_id" value="{$ap.id}">
	<!--		<input type="hidden" name="PHP_back_str" value="{$back_str2}">    -->
	<!--</tr>
</form>
</table>
<br>-->
{/if}

<!-- <hr SIZE=2 WIDTH=900> -->
<table border=0 cellspacing=0 cellpadding=0 cols=2 width=900>
  {if $goback}
  <tr>
    <td class="back" align=center> 
      <input type="button" value=" <<  back "  onClick="window.history.go(-1);" class=select_e style="width:100%; cursor:pointer" >
    </td>
  </tr>
  {/if}

</table>
</td>
</tr>
</table> 
<!--------- footer ---------->
{include file="footer.html"}